---
title: "PheWAS Analyses Oct/Nov 2022"
author: "Sarah Paul"
output:
  pdf_document: default
  pdf: default
  word_document: default
  html_document:
    df_print: paged
---


## Libraries, functions
```{r}
library(data.table)
library(lmerTest)
library(lme4)
library(readxl)
library(dplyr)
library(ggplot2)
library(reshape2)
library(ggrepel)
library(forcats)
library(ggsci)
library(RColorBrewer)
library(optimx)
library(minqa)
library(dfoptim)
library(survey)
library(lavaan.survey)
library(Polychrome)
library(scales)
library(ggnewscale)
library(ggpubr)
library(gplots)
library(ggforce)
library(remotes)
library(ggh4x)
library(tidyr)
library(psych)
#Functions that help
#Nabs warnings from a loop
withWarnings <- function(expr) {
  myWarnings <- NULL
  wHandler <- function(w) {
    myWarnings <<- c(myWarnings, list(w))
    invokeRestart("muffleWarning")
  }
  val <- withCallingHandlers(expr, warning = wHandler)
  list(value = val, warnings = myWarnings)
} 

set.seed(10)
```

#### READING IN DATA
```{r}
PheWAS_baseline <- read_excel("FINAL_PHEWAS_BASELINE_n5556_10.23.22.xlsx")

PheWAS_baseline$site_id <- ifelse(PheWAS_baseline$site_id == 22, 21, PheWAS_baseline$site_id)
PheWAS_baseline[PheWAS_baseline == "NA"] <- NA
PheWAS_baseline[PheWAS_baseline == ""] <- NA

which(colnames(PheWAS_baseline) == "tlfb_tob")
PheWAS_baseline[,c(1:4,20,671:1289)] <- lapply(PheWAS_baseline[,c(1:4,20,671:1289)],as.factor)
PheWAS_baseline[,c(5:19,21:670)] <- lapply(PheWAS_baseline[,c(5:19,21:670)],as.numeric)

PheWAS_baseline <- PheWAS_baseline %>%
  mutate_if(is.numeric, scale)

PheWAS_baseline <- as.data.frame(PheWAS_baseline)

## moving continuous items with issues to the end of the continuous section
PheWAS_baseline <- PheWAS_baseline %>%
  relocate(reshist_state_immigrant_factor, .after = "birth_weight_oz_comb") %>%
  relocate(pds_f4_p, .after = "reshist_state_immigrant_factor") %>%
  relocate(pds_f4_2_y, .after = "pds_f4_p") %>%
  relocate(pds_m4_y, .after = "pds_f4_2_y") %>%
  relocate(pds_m5_y, .after = "pds_m4_y") %>%
  relocate(pds_m5_p, .after = "pds_m5_y") %>% 
  relocate(pds_m4_p, .after = "pds_m5_p") %>% 
  relocate(pds_p_ss_female_category_2, .after = "pds_m4_p") %>%
  relocate(pds_p_ss_male_category_2, .after = "pds_p_ss_female_category_2") %>%
  relocate(pds_y_ss_female_category_2, .after = "pds_p_ss_male_category_2") %>%
  relocate(pds_y_ss_male_cat_2, .after = "pds_y_ss_female_category_2") %>%
  relocate(medhx_6m_times, .after = "pds_y_ss_male_cat_2") %>%
  relocate(medhx_6n_notes, .after = "medhx_6m_times") %>%
  relocate(medhx_6p_notes, .after = "medhx_6n_notes")  

attach(PheWAS_baseline)

```

#### BASELINE COMPULSIVE PRS ####
```{r}
# CONTINUOUS VARIALBES AS OUTCOME
First <- 21 
Last <- 656
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  print(i)
  #******CHANGE*******add your covariates, build your LMER ADD SEX VARIABLE and do for each interview age to equation (8/26/22)
  LMEOut <- withWarnings( a <- lmer(PheWAS_baseline[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5))))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_baseline)[i]
  Warn[i] <- LMEOut$warnings
}

#Store results in a dataframe
Results <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results) <- c("Variable", "Beta", "STE", "Pval")

# reshist, pds, medhx variables - running these separately from the for loop, as they required me to take out some covariates - e.g., the puberty questions were for particular sexes, so taking out sex as a covariate

reshist_state_immigrant_factor_mod1 <- lmer(reshist_state_immigrant_factor ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_f4_p_mod1 <- lmer(pds_f4_p ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_f4_2_y_mod1 <- lmer(pds_f4_2_y ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m4_y_mod1 <- lmer(pds_m4_y ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m5_y_mod1 <- lmer(pds_m5_y ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m5_p_mod1 <- lmer(pds_m5_p ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m4_p_mod1 <- lmer(pds_m4_p ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_p_ss_female_category_2_mod1 <- lmer(pds_p_ss_female_category_2 ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_p_ss_male_category_2_mod1 <- lmer(pds_p_ss_male_category_2 ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_y_ss_female_category_2_mod1 <- lmer(pds_y_ss_female_category_2 ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_y_ss_male_cat_2_mod1 <- lmer(pds_y_ss_male_cat_2 ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

medhx_6m_times_mod1 <- lmer(medhx_6m_times ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

medhx_6n_notes_mod1 <- lmer(medhx_6n_notes ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

medhx_6p_notes_mod1 <- lmer(medhx_6p_notes ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)
which(colnames(PheWAS_baseline) == "medhx_6p_notes")




## merging the results from the above models 
Variable <- colnames(PheWAS_baseline[657:670])
Beta <- c(coef(summary(reshist_state_immigrant_factor_mod1))[2,1], coef(summary(pds_f4_p_mod1))[2,1], coef(summary(pds_m5_y_mod1))[2,1], coef(summary(pds_f4_2_y_mod1))[2,1], coef(summary(pds_m4_y_mod1))[2,1], coef(summary(pds_m5_p_mod1))[2,1],coef(summary(pds_m4_p_mod1))[2,1],
          coef(summary(pds_p_ss_female_category_2_mod1))[2,1], coef(summary(pds_p_ss_male_category_2_mod1))[2,1], coef(summary(pds_y_ss_female_category_2_mod1))[2,1], coef(summary(pds_y_ss_male_cat_2_mod1))[2,1], coef(summary(medhx_6m_times_mod1))[2,1], coef(summary(medhx_6n_notes_mod1))[2,1], coef(summary(medhx_6p_notes_mod1))[2,1])
coef(summary(reshist_state_immigrant_factor_mod1))[2,2]
coef(summary(reshist_state_immigrant_factor_mod1))[2,5]
STE <- c(coef(summary(reshist_state_immigrant_factor_mod1))[2,2], coef(summary(pds_f4_p_mod1))[2,2], coef(summary(pds_f4_2_y_mod1))[2,2], coef(summary(pds_m4_y_mod1))[2,2], coef(summary(pds_m5_y_mod1))[2,2], coef(summary(pds_m5_p_mod1))[2,2], coef(summary(pds_m4_p_mod1))[2,2], coef(summary(pds_p_ss_female_category_2_mod1))[2,2], coef(summary(pds_p_ss_male_category_2_mod1))[2,2], coef(summary(pds_y_ss_female_category_2_mod1))[2,2], coef(summary(pds_y_ss_male_cat_2_mod1))[2,2], coef(summary(medhx_6m_times_mod1))[2,2], coef(summary(medhx_6n_notes_mod1))[2,2], coef(summary(medhx_6p_notes_mod1))[2,2])
Pval <- c(coef(summary(reshist_state_immigrant_factor_mod1))[2,5], coef(summary(pds_f4_p_mod1))[2,5], coef(summary(pds_f4_2_y_mod1))[2,5], coef(summary(pds_m4_y_mod1))[2,5], coef(summary(pds_m5_y_mod1))[2,5],coef(summary(pds_m5_p_mod1))[2,5], coef(summary(pds_m4_p_mod1))[2,5], coef(summary(pds_p_ss_female_category_2_mod1))[2,5], coef(summary(pds_p_ss_male_category_2_mod1))[2,5], coef(summary(pds_y_ss_female_category_2_mod1))[2,5], coef(summary(pds_y_ss_male_cat_2_mod1))[2,5], coef(summary(medhx_6m_times_mod1))[2,5], coef(summary(medhx_6n_notes_mod1))[2,5], coef(summary(medhx_6p_notes_mod1))[2,5])
Resultsb <- cbind(Variable, Beta, STE, Pval)

# merging with the other results
Results_cont <- rbind(Results, Resultsb)

## CATEGORICAL VARABIALES AS OUTCOME (calling for categorical variables)
First <- 671
Last <- 1289
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- glmer(PheWAS_baseline[,i] ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id) + (1|rel_family_id), family = "binomial", nAGQ = 0, control = glmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5))))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(PheWAS_baseline)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_cat) <- c("Variable", "Beta", "STE", "Pval")

# merge
Results <- rbind(Results_cont, Results_cat)
# 2 tiers of FDR correction
Results$FDR <- p.adjust(Results$Pval, method="fdr")
Results$Bonferroni <- p.adjust(Results$Pval, method = "bonferroni")
#Write out results
fwrite(Results, "Compulsive_results_base_11_6.csv")
```

#### BASELINE Psychotic PRS ####
```{r}
# CONTINUOUS VARIALBES AS OUTCOME
First <- 21 
Last <- 656
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  print(i)
  #******CHANGE*******add your covariates, build your LMER ADD SEX VARIABLE and do for each interview age to equation (8/26/22)
  LMEOut <- withWarnings( a <- lmer(PheWAS_baseline[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5))))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_baseline)[i]
  Warn[i] <- LMEOut$warnings
}

#Store results in a dataframe
Results2 <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results2) <- c("Variable", "Beta", "STE", "Pval")

# reshist, pds, medhx variables - running these separately from the for loop, as they required me to take out some covariates - e.g., the puberty questions were for particular sexes, so taking out sex as a covariate

reshist_state_immigrant_factor_mod2 <- lmer(reshist_state_immigrant_factor ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_f4_p_mod2 <- lmer(pds_f4_p ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_f4_2_y_mod2 <- lmer(pds_f4_2_y ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m4_y_mod2 <- lmer(pds_m4_y ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m5_y_mod2 <- lmer(pds_m5_y ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m5_p_mod2 <- lmer(pds_m5_p ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m4_p_mod2 <- lmer(pds_m4_p ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_p_ss_female_category_2_mod2 <- lmer(pds_p_ss_female_category_2 ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_p_ss_male_category_2_mod2 <- lmer(pds_p_ss_male_category_2 ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_y_ss_female_category_2_mod2 <- lmer(pds_y_ss_female_category_2 ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_y_ss_male_cat_2_mod2 <- lmer(pds_y_ss_male_cat_2 ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

medhx_6m_times_mod2 <- lmer(medhx_6m_times ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

medhx_6n_notes_mod2 <- lmer(medhx_6n_notes ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

medhx_6p_notes_mod2 <- lmer(medhx_6p_notes ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)
which(colnames(PheWAS_baseline) == "medhx_6p_notes")




## merging the results from the above models 
Variable <- colnames(PheWAS_baseline[657:670])

Beta <- c(coef(summary(reshist_state_immigrant_factor_mod2))[2,1], coef(summary(pds_f4_p_mod2))[2,1], coef(summary(pds_m5_y_mod2))[2,1], coef(summary(pds_f4_2_y_mod2))[2,1], coef(summary(pds_m4_y_mod2))[2,1], coef(summary(pds_m5_p_mod2))[2,1],coef(summary(pds_m4_p_mod2))[2,1],coef(summary(pds_p_ss_female_category_2_mod2))[2,1], coef(summary(pds_p_ss_male_category_2_mod2))[2,1], coef(summary(pds_y_ss_female_category_2_mod2))[2,1], coef(summary(pds_y_ss_male_cat_2_mod2))[2,1], coef(summary(medhx_6m_times_mod2))[2,1], coef(summary(medhx_6n_notes_mod2))[2,1], coef(summary(medhx_6p_notes_mod2))[2,1])

STE <- c(coef(summary(reshist_state_immigrant_factor_mod2))[2,2], coef(summary(pds_f4_p_mod2))[2,2], coef(summary(pds_f4_2_y_mod2))[2,2], coef(summary(pds_m4_y_mod2))[2,2], coef(summary(pds_m5_y_mod2))[2,2], coef(summary(pds_m5_p_mod2))[2,2], coef(summary(pds_m4_p_mod2))[2,2], coef(summary(pds_p_ss_female_category_2_mod2))[2,2], coef(summary(pds_p_ss_male_category_2_mod2))[2,2], coef(summary(pds_y_ss_female_category_2_mod2))[2,2], coef(summary(pds_y_ss_male_cat_2_mod2))[2,2], coef(summary(medhx_6m_times_mod2))[2,2], coef(summary(medhx_6n_notes_mod2))[2,2], coef(summary(medhx_6p_notes_mod2))[2,2])

Pval <- c(coef(summary(reshist_state_immigrant_factor_mod2))[2,5], coef(summary(pds_f4_p_mod2))[2,5], coef(summary(pds_f4_2_y_mod2))[2,5], coef(summary(pds_m4_y_mod2))[2,5], coef(summary(pds_m5_y_mod2))[2,5],coef(summary(pds_m5_p_mod2))[2,5], coef(summary(pds_m4_p_mod2))[2,5], coef(summary(pds_p_ss_female_category_2_mod2))[2,5], coef(summary(pds_p_ss_male_category_2_mod2))[2,5], coef(summary(pds_y_ss_female_category_2_mod2))[2,5], coef(summary(pds_y_ss_male_cat_2_mod2))[2,5], coef(summary(medhx_6m_times_mod2))[2,5], coef(summary(medhx_6n_notes_mod2))[2,5], coef(summary(medhx_6p_notes_mod2))[2,5])

Results2b <- cbind(Variable, Beta, STE, Pval)

# merging with the other results
Results2_cont <- rbind(Results2, Results2b)

table(PheWAS_baseline$cash_choice_task)

## CATEGORICAL VARABIALES AS OUTCOME (calling for categorical variables)
First <- 671
Last <- 1289
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- glmer(PheWAS_baseline[,i] ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id) + (1|rel_family_id), family = "binomial", nAGQ = 0, control = glmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5))))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(PheWAS_baseline)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results2_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results2_cat) <- c("Variable", "Beta", "STE", "Pval")

# merge
Results2 <- rbind(Results2_cont, Results2_cat)
# 2 tiers of FDR correction
Results2$FDR <- p.adjust(Results2$Pval, method="fdr")
Results2$Bonferroni <- p.adjust(Results2$Pval, method = "bonferroni")
#Write out results
fwrite(Results2, "Psychotic_results_base_11_6.csv")
```

#### BASELINE Neurodev PRS ####
```{r}
# CONTINUOUS VARIALBES AS OUTCOME
First <- 21 
Last <- 656
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  print(i)
  #******CHANGE*******add your covariates, build your LMER ADD SEX VARIABLE and do for each interview age to equation (8/26/22)
  LMEOut <- withWarnings( a <- lmer(PheWAS_baseline[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5))))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_baseline)[i]
  Warn[i] <- LMEOut$warnings
}

#Store results in a dataframe
Results3 <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results3) <- c("Variable", "Beta", "STE", "Pval")

# reshist, pds, medhx variables - running these separately from the for loop, as they required me to take out some covariates - e.g., the puberty questions were for particular sexes, so taking out sex as a covariate

reshist_state_immigrant_factor_mod3 <- lmer(reshist_state_immigrant_factor ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_f4_p_mod3 <- lmer(pds_f4_p ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_f4_2_y_mod3 <- lmer(pds_f4_2_y ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m4_y_mod3 <- lmer(pds_m4_y ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m5_y_mod3 <- lmer(pds_m5_y ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m5_p_mod3 <- lmer(pds_m5_p ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m4_p_mod3 <- lmer(pds_m4_p ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_p_ss_female_category_2_mod3 <- lmer(pds_p_ss_female_category_2 ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_p_ss_male_category_2_mod3 <- lmer(pds_p_ss_male_category_2 ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_y_ss_female_category_2_mod3 <- lmer(pds_y_ss_female_category_2 ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_y_ss_male_cat_2_mod3 <- lmer(pds_y_ss_male_cat_2 ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

medhx_6m_times_mod3 <- lmer(medhx_6m_times ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

medhx_6n_notes_mod3 <- lmer(medhx_6n_notes ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

medhx_6p_notes_mod3 <- lmer(medhx_6p_notes ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)
which(colnames(PheWAS_baseline) == "medhx_6p_notes")




## merging the results from the above models 
Variable <- colnames(PheWAS_baseline[657:670])

Beta <- c(coef(summary(reshist_state_immigrant_factor_mod3))[2,1], coef(summary(pds_f4_p_mod3))[2,1], coef(summary(pds_m5_y_mod3))[2,1], coef(summary(pds_f4_2_y_mod3))[2,1], coef(summary(pds_m4_y_mod3))[2,1], coef(summary(pds_m5_p_mod3))[2,1],coef(summary(pds_m4_p_mod3))[2,1],coef(summary(pds_p_ss_female_category_2_mod3))[2,1], coef(summary(pds_p_ss_male_category_2_mod3))[2,1], coef(summary(pds_y_ss_female_category_2_mod3))[2,1], coef(summary(pds_y_ss_male_cat_2_mod3))[2,1], coef(summary(medhx_6m_times_mod3))[2,1], coef(summary(medhx_6n_notes_mod3))[2,1], coef(summary(medhx_6p_notes_mod3))[2,1])

STE <- c(coef(summary(reshist_state_immigrant_factor_mod3))[2,2], coef(summary(pds_f4_p_mod3))[2,2], coef(summary(pds_f4_2_y_mod3))[2,2], coef(summary(pds_m4_y_mod3))[2,2], coef(summary(pds_m5_y_mod3))[2,2], coef(summary(pds_m5_p_mod3))[2,2], coef(summary(pds_m4_p_mod3))[2,2], coef(summary(pds_p_ss_female_category_2_mod3))[2,2], coef(summary(pds_p_ss_male_category_2_mod3))[2,2], coef(summary(pds_y_ss_female_category_2_mod3))[2,2], coef(summary(pds_y_ss_male_cat_2_mod3))[2,2], coef(summary(medhx_6m_times_mod3))[2,2], coef(summary(medhx_6n_notes_mod3))[2,2], coef(summary(medhx_6p_notes_mod3))[2,2])

Pval <- c(coef(summary(reshist_state_immigrant_factor_mod3))[2,5], coef(summary(pds_f4_p_mod3))[2,5], coef(summary(pds_f4_2_y_mod3))[2,5], coef(summary(pds_m4_y_mod3))[2,5], coef(summary(pds_m5_y_mod3))[2,5],coef(summary(pds_m5_p_mod3))[2,5], coef(summary(pds_m4_p_mod3))[2,5], coef(summary(pds_p_ss_female_category_2_mod3))[2,5], coef(summary(pds_p_ss_male_category_2_mod3))[2,5], coef(summary(pds_y_ss_female_category_2_mod3))[2,5], coef(summary(pds_y_ss_male_cat_2_mod3))[2,5], coef(summary(medhx_6m_times_mod3))[2,5], coef(summary(medhx_6n_notes_mod3))[2,5], coef(summary(medhx_6p_notes_mod3))[2,5])

Results3b <- cbind(Variable, Beta, STE, Pval)

# merging with the other results
Results3_cont <- rbind(Results3, Results3b)

## CATEGORICAL VARABIALES AS OUTCOME (calling for categorical variables)
First <- 671
Last <- 1289
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- glmer(PheWAS_baseline[,i] ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id) + (1|rel_family_id), family = "binomial", nAGQ = 0, control = glmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5))))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(PheWAS_baseline)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results3_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results3_cat) <- c("Variable", "Beta", "STE", "Pval")

# merge
Results3 <- rbind(Results3_cont, Results3_cat)
# 2 tiers of FDR correction
Results3$FDR <- p.adjust(Results3$Pval, method="fdr")
Results3$Bonferroni <- p.adjust(Results3$Pval, method = "bonferroni")
#Write out results
fwrite(Results3, "Neurodev_results_base_11_6.csv")
```

#### BASELINE Internalizing PRS ####
```{r}
# CONTINUOUS VARIALBES AS OUTCOME
First <- 21 
Last <- 656
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  print(i)
  #******CHANGE*******add your covariates, build your LMER ADD SEX VARIABLE and do for each interview age to equation (8/26/22)
  LMEOut <- withWarnings( a <- lmer(PheWAS_baseline[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5))))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_baseline)[i]
  Warn[i] <- LMEOut$warnings
}

#Store results in a dataframe
Results4 <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results4) <- c("Variable", "Beta", "STE", "Pval")

# reshist, pds, medhx variables - running these separately from the for loop, as they required me to take out some covariates - e.g., the puberty questions were for particular sexes, so taking out sex as a covariate

reshist_state_immigrant_factor_mod4 <- lmer(reshist_state_immigrant_factor ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_f4_p_mod4 <- lmer(pds_f4_p ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_f4_2_y_mod4 <- lmer(pds_f4_2_y ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m4_y_mod4 <- lmer(pds_m4_y ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m5_y_mod4 <- lmer(pds_m5_y ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m5_p_mod4 <- lmer(pds_m5_p ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_m4_p_mod4 <- lmer(pds_m4_p ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_p_ss_female_category_2_mod4 <- lmer(pds_p_ss_female_category_2 ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_p_ss_male_category_2_mod4 <- lmer(pds_p_ss_male_category_2 ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_y_ss_female_category_2_mod4 <- lmer(pds_y_ss_female_category_2 ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

pds_y_ss_male_cat_2_mod4 <- lmer(pds_y_ss_male_cat_2 ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|site_id) + (1|rel_family_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

medhx_6m_times_mod4 <- lmer(medhx_6m_times ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

medhx_6n_notes_mod4 <- lmer(medhx_6n_notes ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)

medhx_6p_notes_mod4 <- lmer(medhx_6p_notes ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|site_id), control = lmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5)), data = PheWAS_baseline)
which(colnames(PheWAS_baseline) == "medhx_6p_notes")




## merging the results from the above models 
Variable <- colnames(PheWAS_baseline[657:670])

Beta <- c(coef(summary(reshist_state_immigrant_factor_mod4))[2,1], coef(summary(pds_f4_p_mod4))[2,1], coef(summary(pds_m5_y_mod4))[2,1], coef(summary(pds_f4_2_y_mod4))[2,1], coef(summary(pds_m4_y_mod4))[2,1], coef(summary(pds_m5_p_mod4))[2,1],coef(summary(pds_m4_p_mod4))[2,1],coef(summary(pds_p_ss_female_category_2_mod4))[2,1], coef(summary(pds_p_ss_male_category_2_mod4))[2,1], coef(summary(pds_y_ss_female_category_2_mod4))[2,1], coef(summary(pds_y_ss_male_cat_2_mod4))[2,1], coef(summary(medhx_6m_times_mod4))[2,1], coef(summary(medhx_6n_notes_mod4))[2,1], coef(summary(medhx_6p_notes_mod4))[2,1])

STE <- c(coef(summary(reshist_state_immigrant_factor_mod4))[2,2], coef(summary(pds_f4_p_mod4))[2,2], coef(summary(pds_f4_2_y_mod4))[2,2], coef(summary(pds_m4_y_mod4))[2,2], coef(summary(pds_m5_y_mod4))[2,2], coef(summary(pds_m5_p_mod4))[2,2], coef(summary(pds_m4_p_mod4))[2,2], coef(summary(pds_p_ss_female_category_2_mod4))[2,2], coef(summary(pds_p_ss_male_category_2_mod4))[2,2], coef(summary(pds_y_ss_female_category_2_mod4))[2,2], coef(summary(pds_y_ss_male_cat_2_mod4))[2,2], coef(summary(medhx_6m_times_mod4))[2,2], coef(summary(medhx_6n_notes_mod4))[2,2], coef(summary(medhx_6p_notes_mod4))[2,2])

Pval <- c(coef(summary(reshist_state_immigrant_factor_mod4))[2,5], coef(summary(pds_f4_p_mod4))[2,5], coef(summary(pds_f4_2_y_mod4))[2,5], coef(summary(pds_m4_y_mod4))[2,5], coef(summary(pds_m5_y_mod4))[2,5],coef(summary(pds_m5_p_mod4))[2,5], coef(summary(pds_m4_p_mod4))[2,5], coef(summary(pds_p_ss_female_category_2_mod4))[2,5], coef(summary(pds_p_ss_male_category_2_mod4))[2,5], coef(summary(pds_y_ss_female_category_2_mod4))[2,5], coef(summary(pds_y_ss_male_cat_2_mod4))[2,5], coef(summary(medhx_6m_times_mod4))[2,5], coef(summary(medhx_6n_notes_mod4))[2,5], coef(summary(medhx_6p_notes_mod4))[2,5])

Results4b <- cbind(Variable, Beta, STE, Pval)

# merging with the other results
Results4_cont <- rbind(Results4, Results4b)

## CATEGORICAL VARABIALES AS OUTCOME (calling for categorical variables)
First <- 671
Last <- 1289
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- glmer(PheWAS_baseline[,i] ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id) + (1|rel_family_id), family = "binomial", nAGQ = 0, control = glmerControl(optimizer = "bobyqa", optCtrl=list(maxfun=1e5))))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(PheWAS_baseline)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results4_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results4_cat) <- c("Variable", "Beta", "STE", "Pval")

# merge
Results4 <- rbind(Results4_cont, Results4_cat)
# 2 tiers of FDR correction
Results4$FDR <- p.adjust(Results4$Pval, method="fdr")
Results4$Bonferroni <- p.adjust(Results4$Pval, method = "bonferroni")
#Write out results
fwrite(Results4, "Internalizing_results_base_11_6.csv")
```

#### READING IN FU2 DATA
```{r}
PheWAS_FU <- read_excel("FINAL_PheWAS_FU2_n5556_11.18.xlsx")
PheWAS_FU$site_id <- ifelse(PheWAS_FU$site_id == 22, 21, PheWAS_FU$site_id)
PheWAS_FU[PheWAS_FU == "NA"] <- NA
PheWAS_FU[PheWAS_FU == ""] <- NA

which(colnames(PheWAS_FU) == "tlfb_list_l2___1")
PheWAS_FU[,c(1:4,20:21,1248:1715)] <- lapply(PheWAS_FU[,c(1:4,20:21,1248:1715)],as.factor)
PheWAS_FU[,c(5:19,22:1247)] <- lapply(PheWAS_FU[,c(5:19,22:1247)],as.numeric)

PheWAS_FU <- PheWAS_FU %>%
  mutate_if(is.numeric, scale)
PheWAS_FU <- as.data.frame(PheWAS_FU)

PheWAS_FU_reshist <-  PheWAS_FU %>%
  select(subjectkey:COVID_visittype, contains("reshist"))
PheWAS_FU_sexvar <- PheWAS_FU %>%
  select(subjectkey:COVID_visittype, contains("pds"), contains("menstrual"), contains("gish"))
PheWAS_FU_other <- PheWAS_FU  %>%
  select(subjectkey:COVID_visittype, contains("biospec"), contains("fitbit"), prodromal_19b_y, prodromal_21b_y, ksads_sleepprob_raw_818_pTRAN, ksads_sleepprob_raw_818_tTRAN, ple_injur_fu2_p, ple_friend_died_fu2_p)

PheWAS_FU2 <- PheWAS_FU %>%
  dplyr::select(-contains("reshist"), -contains("pds_"), -contains("menstrual"), -contains("gish"), -contains("biospec"), -contains("fitbit"), -prodromal_19b_y, -prodromal_21b_y, -ksads_sleepprob_raw_818_pTRAN, -ksads_sleepprob_raw_818_tTRAN, -ple_injur_fu2_p, -ple_friend_died_fu2_p)

PheWAS_FU2 <- as.data.frame(PheWAS_FU2)
```

#### FU COMPULSIVE PRS ####
```{r}
which(colnames(PheWAS_FU2)=="tlfb_list_l2___1")
attach(PheWAS_FU2)
First <- 22
Last <- 1053
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU2[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU) <- c("Variable", "Beta", "STE", "Pval")
intersect(search(), objects())
ResultsFU <- ResultsFU %>%
  filter(Variable != "kbi_p_c_school_setting_l_home",
         Variable != "kbi_p_c_school_setting_l_public",
         Variable != "kbi_p_c_school_setting_l_private")
detach(PheWAS_FU2)
attach(PheWAS_FU_reshist)

# take out rel_family_id and covid visit type (shouldn't matter anyway)
First <- 22
Last <- 118
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_reshist[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_reshist)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU_reshist <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU_reshist) <- c("Variable", "Beta", "STE", "Pval")


## family or site ID???
mj_laws_rec_mod1 <- glmer(as.factor(reshist_state_mj_laws_rec) ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|rel_family_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_reshist)
mj_laws_med_mod1 <- glmer(as.factor(reshist_state_mj_laws_med) ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|rel_family_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_reshist)
mj_laws_low_mod1 <- glmer(as.factor(reshist_state_mj_laws_low) ~ Compulsive_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|rel_family_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_reshist)

Variable <- colnames(PheWAS_FU_reshist[119:121])
Beta <- c(coef(summary(mj_laws_rec_mod1))[2,1], coef(summary(mj_laws_med_mod1))[2,1], coef(summary(mj_laws_low_mod1))[2,1])
STE <- c(coef(summary(mj_laws_rec_mod1))[2,2], coef(summary(mj_laws_med_mod1))[2,2], coef(summary(mj_laws_low_mod1))[2,2])
Pval <- c(coef(summary(mj_laws_rec_mod1))[2,4], coef(summary(mj_laws_med_mod1))[2,4], coef(summary(mj_laws_low_mod1))[2,4])
ResultsFU_reshistb <- cbind(Variable, Beta, STE, Pval)

ResultsFU_reshist <- rbind(ResultsFU_reshist, ResultsFU_reshistb)


detach(PheWAS_FU_reshist)
attach(PheWAS_FU_sexvar)

PheWAS_FU_sexvar <- PheWAS_FU_sexvar %>%
  relocate(where(is.factor), .after = where(is.numeric)) %>%
  relocate(subjectkey:COVID_visittype, .before = where(is.numeric))

# take out sex and covid visit type
First <- 22
Last <- 81
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_sexvar[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age +  (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_sexvar)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU_sexvar <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU_sexvar) <- c("Variable", "Beta", "STE", "Pval")

pds_f5_y_mod1 <- glmer(pds_f5_y ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)
pds_f5b_p_mod1 <- glmer(pds_f5b_p ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)
menstrualcycle3_y_mod1 <- glmer(menstrualcycle3_y ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)
menstrualcycle3_p_mod1 <- glmer(menstrualcycle3_p ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)

Variable <- colnames(PheWAS_FU_sexvar[82:85])
Beta <- c(coef(summary(pds_f5_y_mod1))[2,1], coef(summary(pds_f5b_p_mod1))[2,1], coef(summary(menstrualcycle3_y_mod1))[2,1], coef(summary(menstrualcycle3_p_mod1))[2,1])
STE <- c(coef(summary(pds_f5_y_mod1))[2,2], coef(summary(pds_f5b_p_mod1))[2,2], coef(summary(menstrualcycle3_y_mod1))[2,2], coef(summary(menstrualcycle3_p_mod1))[2,2])
Pval <- c(coef(summary(pds_f5_y_mod1))[2,4], coef(summary(pds_f5b_p_mod1))[2,4], coef(summary(menstrualcycle3_y_mod1))[2,4], coef(summary(menstrualcycle3_p_mod1))[2,4])
ResultsFU_sexvarb <- cbind(Variable, Beta, STE, Pval)

ResultsFU_sexvar <- rbind(ResultsFU_sexvar, ResultsFU_sexvarb)


detach(PheWAS_FU_sexvar)
attach(PheWAS_FU_other)

# take out sex and covid visit type
First <- 22
Last <- 52
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_other[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age +  (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_other)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU_other <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU_other) <- c("Variable", "Beta", "STE", "Pval")

# take out sex and covid visit type and family id
First <- 53
Last <- 58
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_other[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_other)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU_other2 <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU_other2) <- c("Variable", "Beta", "STE", "Pval")

ResultsFU_other <- rbind(ResultsFU_other, ResultsFU_other2)
detach(PheWAS_FU_other)

which(colnames(PheWAS_FU2) == "tlfb_list_l2___1")
which(colnames(PheWAS_FU2) == "kbi_p_c_school_setting_l_home")
PheWAS_FU2 <- PheWAS_FU2 %>%
  relocate(contains("_sq2_"), .after = "kbi_p_c_school_setting_l_private")
attach(PheWAS_FU2)

# take out sex and covid visit type
First <- 1054
Last <- 1507
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- glmer(PheWAS_FU2[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age +  (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(PheWAS_FU2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU_cat) <- c("Variable", "Beta", "STE", "Pval")

kbi_home_mod1 <- glmer(kbi_p_c_school_setting_l_home ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
kbi_public_mod1 <- glmer(kbi_p_c_school_setting_l_public ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
kbi_private_mod1 <- glmer(kbi_p_c_school_setting_l_public ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)

screen_sq2_phoneoff_mod1 <- glmer(screentime_sq2_phoneoff ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
screen_sq2_silent_mod1 <- glmer(screentime_sq2_silent ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
screen_sq2_ringeron_mod1 <- glmer(screentime_sq2_ringeron ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
screen_sq2_outside_mod1 <- glmer(screentime_sq2_outside ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)

Variable <- c("kbi_new_school_setting_l_home", "kbi_new_school_setting_l_public", "kbi_new_school_setting_l_private", "screentime_sq2_phoneoff", "screentime_sq2_silent", "screentime_sq2_ringeron", "screentime_sq2_outside")
Beta <- c(coef(summary(kbi_home_mod1))[2,1], coef(summary(kbi_public_mod1))[2,1], coef(summary(kbi_private_mod1))[2,1], coef(summary(screen_sq2_phoneoff_mod1))[2,1], coef(summary(screen_sq2_silent_mod1))[2,1], coef(summary(screen_sq2_ringeron_mod1))[2,1], coef(summary(screen_sq2_outside_mod1))[2,1])
STE <- c(coef(summary(kbi_home_mod1))[2,2], coef(summary(kbi_public_mod1))[2,2], coef(summary(kbi_private_mod1))[2,2], coef(summary(screen_sq2_phoneoff_mod1))[2,2], coef(summary(screen_sq2_silent_mod1))[2,2], coef(summary(screen_sq2_ringeron_mod1))[2,2], coef(summary(screen_sq2_outside_mod1))[2,2])
Pval <- c(coef(summary(kbi_home_mod1))[2,4], coef(summary(kbi_public_mod1))[2,4], coef(summary(kbi_private_mod1))[2,4], coef(summary(screen_sq2_phoneoff_mod1))[2,4], coef(summary(screen_sq2_silent_mod1))[2,4], coef(summary(screen_sq2_ringeron_mod1))[2,4], coef(summary(screen_sq2_outside_mod1))[2,4])
ResultsFU_cat_kbi_school_sq2 <- cbind(Variable, Beta, STE, Pval)

ResultsFU_cat <- rbind(ResultsFU_cat, ResultsFU_cat_kbi_school_sq2)
ResultsFU_comp <- rbind(ResultsFU, ResultsFU_reshist, ResultsFU_sexvar, ResultsFU_other, ResultsFU_cat)
#ResultsFU_comp <- ResultsFU_comp %>%
#  dplyr::filter(Variable!="ksads_bd_raw_162_pTRAN")
ResultsFU_comp$FDR <- p.adjust(ResultsFU_comp$Pval, method = "fdr")
ResultsFU_comp$Bonferroni <- p.adjust(ResultsFU_comp$Pval, method = "bonferroni")
#Write out results
fwrite(ResultsFU_comp, "Compulsive_results_FU_11_18.txt", sep="\t")

detach(PheWAS_FU2)

```

#### FU Psychotic PRS ####
```{r}
which(colnames(PheWAS_FU2)=="tlfb_list_l2___1")
attach(PheWAS_FU2)
First <- 22
Last <- 1053
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU2[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU2 <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU2) <- c("Variable", "Beta", "STE", "Pval")
intersect(search(), objects())
ResultsFU2 <- ResultsFU2 %>%
  filter(Variable != "kbi_p_c_school_setting_l_home",
         Variable != "kbi_p_c_school_setting_l_public",
         Variable != "kbi_p_c_school_setting_l_private")
detach(PheWAS_FU2)
attach(PheWAS_FU_reshist)

# take out rel_family_id and covid visit type (shouldn't matter anyway)
First <- 22
Last <- 118
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_reshist[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_reshist)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU2_reshist <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU2_reshist) <- c("Variable", "Beta", "STE", "Pval")


## family or site ID???
mj_laws_rec_mod2 <- glmer(as.factor(reshist_state_mj_laws_rec) ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|rel_family_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_reshist)
mj_laws_med_mod2 <- glmer(as.factor(reshist_state_mj_laws_med) ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|rel_family_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_reshist)
mj_laws_low_mod2 <- glmer(as.factor(reshist_state_mj_laws_low) ~ Psychotic_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|rel_family_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_reshist)

Variable <- colnames(PheWAS_FU_reshist[119:121])
Beta <- c(coef(summary(mj_laws_rec_mod2))[2,1], coef(summary(mj_laws_med_mod2))[2,1], coef(summary(mj_laws_low_mod2))[2,1])
STE <- c(coef(summary(mj_laws_rec_mod2))[2,2], coef(summary(mj_laws_med_mod2))[2,2], coef(summary(mj_laws_low_mod2))[2,2])
Pval <- c(coef(summary(mj_laws_rec_mod2))[2,4], coef(summary(mj_laws_med_mod2))[2,4], coef(summary(mj_laws_low_mod2))[2,4])
ResultsFU2_reshistb <- cbind(Variable, Beta, STE, Pval)

ResultsFU2_reshist <- rbind(ResultsFU2_reshist, ResultsFU2_reshistb)


detach(PheWAS_FU_reshist)
attach(PheWAS_FU_sexvar)

PheWAS_FU_sexvar <- PheWAS_FU_sexvar %>%
  relocate(where(is.factor), .after = where(is.numeric)) %>%
  relocate(subjectkey:COVID_visittype, .before = where(is.numeric))

# take out sex and covid visit type
First <- 22
Last <- 81
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_sexvar[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age +  (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_sexvar)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU2_sexvar <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU2_sexvar) <- c("Variable", "Beta", "STE", "Pval")

pds_f5_y_mod2 <- glmer(pds_f5_y ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)
pds_f5b_p_mod2 <- glmer(pds_f5b_p ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)
menstrualcycle3_y_mod2 <- glmer(menstrualcycle3_y ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)
menstrualcycle3_p_mod2 <- glmer(menstrualcycle3_p ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)

Variable <- colnames(PheWAS_FU_sexvar[82:85])
Beta <- c(coef(summary(pds_f5_y_mod2))[2,1], coef(summary(pds_f5b_p_mod2))[2,1], coef(summary(menstrualcycle3_y_mod2))[2,1], coef(summary(menstrualcycle3_p_mod2))[2,1])
STE <- c(coef(summary(pds_f5_y_mod2))[2,2], coef(summary(pds_f5b_p_mod2))[2,2], coef(summary(menstrualcycle3_y_mod2))[2,2], coef(summary(menstrualcycle3_p_mod2))[2,2])
Pval <- c(coef(summary(pds_f5_y_mod2))[2,4], coef(summary(pds_f5b_p_mod2))[2,4], coef(summary(menstrualcycle3_y_mod2))[2,4], coef(summary(menstrualcycle3_p_mod2))[2,4])
ResultsFU2_sexvarb <- cbind(Variable, Beta, STE, Pval)

ResultsFU2_sexvar <- rbind(ResultsFU2_sexvar, ResultsFU2_sexvarb)


detach(PheWAS_FU_sexvar)
attach(PheWAS_FU_other)

# take out sex and covid visit type
First <- 22
Last <- 52
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_other[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age +  (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_other)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU2_other <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU2_other) <- c("Variable", "Beta", "STE", "Pval")

# take out sex and covid visit type and family id
First <- 53
Last <- 58
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_other[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_other)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU2_other2 <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU2_other2) <- c("Variable", "Beta", "STE", "Pval")

ResultsFU2_other <- rbind(ResultsFU2_other, ResultsFU2_other2)
detach(PheWAS_FU_other)

which(colnames(PheWAS_FU2) == "tlfb_list_l2___1")
which(colnames(PheWAS_FU2) == "kbi_p_c_school_setting_l_home")
PheWAS_FU2 <- PheWAS_FU2 %>%
  relocate(contains("_sq2_"), .after = "kbi_p_c_school_setting_l_private")
attach(PheWAS_FU2)

# take out sex and covid visit type
First <- 1054
Last <- 1507
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- glmer(PheWAS_FU2[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age +  (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(PheWAS_FU2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU2_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU2_cat) <- c("Variable", "Beta", "STE", "Pval")

kbi_home_mod2 <- glmer(kbi_p_c_school_setting_l_home ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
kbi_public_mod2 <- glmer(kbi_p_c_school_setting_l_public ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
kbi_private_mod2 <- glmer(kbi_p_c_school_setting_l_public ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)

screen_sq2_phoneoff_mod2 <- glmer(screentime_sq2_phoneoff ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
screen_sq2_silent_mod2 <- glmer(screentime_sq2_silent ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
screen_sq2_ringeron_mod2 <- glmer(screentime_sq2_ringeron ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
screen_sq2_outside_mod2 <- glmer(screentime_sq2_outside ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)

Variable <- c("kbi_new_school_setting_l_home", "kbi_new_school_setting_l_public", "kbi_new_school_setting_l_private", "screentime_sq2_phoneoff", "screentime_sq2_silent", "screentime_sq2_ringeron", "screentime_sq2_outside")
Beta <- c(coef(summary(kbi_home_mod2))[2,1], coef(summary(kbi_public_mod2))[2,1], coef(summary(kbi_private_mod2))[2,1], coef(summary(screen_sq2_phoneoff_mod2))[2,1], coef(summary(screen_sq2_silent_mod2))[2,1], coef(summary(screen_sq2_ringeron_mod2))[2,1], coef(summary(screen_sq2_outside_mod2))[2,1])
STE <- c(coef(summary(kbi_home_mod2))[2,2], coef(summary(kbi_public_mod2))[2,2], coef(summary(kbi_private_mod2))[2,2], coef(summary(screen_sq2_phoneoff_mod2))[2,2], coef(summary(screen_sq2_silent_mod2))[2,2], coef(summary(screen_sq2_ringeron_mod2))[2,2], coef(summary(screen_sq2_outside_mod2))[2,2])
Pval <- c(coef(summary(kbi_home_mod2))[2,4], coef(summary(kbi_public_mod2))[2,4], coef(summary(kbi_private_mod2))[2,4], coef(summary(screen_sq2_phoneoff_mod2))[2,4], coef(summary(screen_sq2_silent_mod2))[2,4], coef(summary(screen_sq2_ringeron_mod2))[2,4], coef(summary(screen_sq2_outside_mod2))[2,4])
ResultsFU2_cat_kbi_school_sq2 <- cbind(Variable, Beta, STE, Pval)

ResultsFU2_cat <- rbind(ResultsFU2_cat, ResultsFU2_cat_kbi_school_sq2)
ResultsFU2_comp <- rbind(ResultsFU2, ResultsFU2_reshist, ResultsFU2_sexvar, ResultsFU2_other, ResultsFU2_cat)
ResultsFU2_comp <- ResultsFU2_comp %>%
  dplyr::filter(Variable!="ksads_bd_raw_162_pTRAN")
ResultsFU2_comp$FDR <- p.adjust(ResultsFU2_comp$Pval, method = "fdr")
ResultsFU2_comp$Bonferroni <- p.adjust(ResultsFU2_comp$Pval, method = "bonferroni")
#Write out results
fwrite(ResultsFU2_comp, "Psychotic_results_FU_11_18.txt", sep="\t")
detach(PheWAS_FU2)
```

#### FU Neurodev PRS ####
```{r}
which(colnames(PheWAS_FU2)=="tlfb_list_l2___1")
attach(PheWAS_FU2)
First <- 22
Last <- 1053
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU2[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU3 <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU3) <- c("Variable", "Beta", "STE", "Pval")
intersect(search(), objects())
ResultsFU3 <- ResultsFU3 %>%
  filter(Variable != "kbi_p_c_school_setting_l_home",
         Variable != "kbi_p_c_school_setting_l_public",
         Variable != "kbi_p_c_school_setting_l_private")
detach(PheWAS_FU2)
attach(PheWAS_FU_reshist)

# take out rel_family_id and covid visit type (shouldn't matter anyway)
First <- 22
Last <- 118
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_reshist[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_reshist)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU3_reshist <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU3_reshist) <- c("Variable", "Beta", "STE", "Pval")


## family or site ID???
mj_laws_rec_mod3 <- glmer(as.factor(reshist_state_mj_laws_rec) ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|rel_family_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_reshist)
mj_laws_med_mod3 <- glmer(as.factor(reshist_state_mj_laws_med) ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|rel_family_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_reshist)
mj_laws_low_mod3 <- glmer(as.factor(reshist_state_mj_laws_low) ~ Neurodev_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|rel_family_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_reshist)

Variable <- colnames(PheWAS_FU_reshist[119:121])
Beta <- c(coef(summary(mj_laws_rec_mod3))[2,1], coef(summary(mj_laws_med_mod3))[2,1], coef(summary(mj_laws_low_mod3))[2,1])
STE <- c(coef(summary(mj_laws_rec_mod3))[2,2], coef(summary(mj_laws_med_mod3))[2,2], coef(summary(mj_laws_low_mod3))[2,2])
Pval <- c(coef(summary(mj_laws_rec_mod3))[2,4], coef(summary(mj_laws_med_mod3))[2,4], coef(summary(mj_laws_low_mod3))[2,4])
ResultsFU3_reshistb <- cbind(Variable, Beta, STE, Pval)

ResultsFU3_reshist <- rbind(ResultsFU3_reshist, ResultsFU3_reshistb)


detach(PheWAS_FU_reshist)
attach(PheWAS_FU_sexvar)

PheWAS_FU_sexvar <- PheWAS_FU_sexvar %>%
  relocate(where(is.factor), .after = where(is.numeric)) %>%
  relocate(subjectkey:COVID_visittype, .before = where(is.numeric))

# take out sex and covid visit type
First <- 22
Last <- 81
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_sexvar[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age +  (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_sexvar)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU3_sexvar <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU3_sexvar) <- c("Variable", "Beta", "STE", "Pval")

pds_f5_y_mod3 <- glmer(pds_f5_y ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)
pds_f5b_p_mod3 <- glmer(pds_f5b_p ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)
menstrualcycle3_y_mod3 <- glmer(menstrualcycle3_y ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)
menstrualcycle3_p_mod3 <- glmer(menstrualcycle3_p ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)

Variable <- colnames(PheWAS_FU_sexvar[82:85])
Beta <- c(coef(summary(pds_f5_y_mod3))[2,1], coef(summary(pds_f5b_p_mod3))[2,1], coef(summary(menstrualcycle3_y_mod3))[2,1], coef(summary(menstrualcycle3_p_mod3))[2,1])
STE <- c(coef(summary(pds_f5_y_mod3))[2,2], coef(summary(pds_f5b_p_mod3))[2,2], coef(summary(menstrualcycle3_y_mod3))[2,2], coef(summary(menstrualcycle3_p_mod3))[2,2])
Pval <- c(coef(summary(pds_f5_y_mod3))[2,4], coef(summary(pds_f5b_p_mod3))[2,4], coef(summary(menstrualcycle3_y_mod3))[2,4], coef(summary(menstrualcycle3_p_mod3))[2,4])
ResultsFU3_sexvarb <- cbind(Variable, Beta, STE, Pval)

ResultsFU3_sexvar <- rbind(ResultsFU3_sexvar, ResultsFU3_sexvarb)


detach(PheWAS_FU_sexvar)
attach(PheWAS_FU_other)

# take out sex and covid visit type
First <- 22
Last <- 52
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_other[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age +  (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_other)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU3_other <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU3_other) <- c("Variable", "Beta", "STE", "Pval")

# take out sex and covid visit type and family id
First <- 53
Last <- 58
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_other[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_other)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU3_other2 <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU3_other2) <- c("Variable", "Beta", "STE", "Pval")

ResultsFU3_other <- rbind(ResultsFU3_other, ResultsFU3_other2)
detach(PheWAS_FU_other)

which(colnames(PheWAS_FU2) == "tlfb_list_l2___1")
which(colnames(PheWAS_FU2) == "kbi_p_c_school_setting_l_home")
PheWAS_FU2 <- PheWAS_FU2 %>%
  relocate(contains("_sq2_"), .after = "kbi_p_c_school_setting_l_private")
attach(PheWAS_FU2)

# take out sex and covid visit type
First <- 1054
Last <- 1507
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- glmer(PheWAS_FU2[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age +  (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(PheWAS_FU2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU3_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU3_cat) <- c("Variable", "Beta", "STE", "Pval")

kbi_home_mod3 <- glmer(kbi_p_c_school_setting_l_home ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
kbi_public_mod3 <- glmer(kbi_p_c_school_setting_l_public ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
kbi_private_mod3 <- glmer(kbi_p_c_school_setting_l_public ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)

screen_sq2_phoneoff_mod3 <- glmer(screentime_sq2_phoneoff ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
screen_sq2_silent_mod3 <- glmer(screentime_sq2_silent ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
screen_sq2_ringeron_mod3 <- glmer(screentime_sq2_ringeron ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
screen_sq2_outside_mod3 <- glmer(screentime_sq2_outside ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)

Variable <- c("kbi_new_school_setting_l_home", "kbi_new_school_setting_l_public", "kbi_new_school_setting_l_private", "screentime_sq2_phoneoff", "screentime_sq2_silent", "screentime_sq2_ringeron", "screentime_sq2_outside")
Beta <- c(coef(summary(kbi_home_mod3))[2,1], coef(summary(kbi_public_mod3))[2,1], coef(summary(kbi_private_mod3))[2,1], coef(summary(screen_sq2_phoneoff_mod3))[2,1], coef(summary(screen_sq2_silent_mod3))[2,1], coef(summary(screen_sq2_ringeron_mod3))[2,1], coef(summary(screen_sq2_outside_mod3))[2,1])
STE <- c(coef(summary(kbi_home_mod3))[2,2], coef(summary(kbi_public_mod3))[2,2], coef(summary(kbi_private_mod3))[2,2], coef(summary(screen_sq2_phoneoff_mod3))[2,2], coef(summary(screen_sq2_silent_mod3))[2,2], coef(summary(screen_sq2_ringeron_mod3))[2,2], coef(summary(screen_sq2_outside_mod3))[2,2])
Pval <- c(coef(summary(kbi_home_mod3))[2,4], coef(summary(kbi_public_mod3))[2,4], coef(summary(kbi_private_mod3))[2,4], coef(summary(screen_sq2_phoneoff_mod3))[2,4], coef(summary(screen_sq2_silent_mod3))[2,4], coef(summary(screen_sq2_ringeron_mod3))[2,4], coef(summary(screen_sq2_outside_mod3))[2,4])
ResultsFU3_cat_kbi_school_sq2 <- cbind(Variable, Beta, STE, Pval)

ResultsFU3_cat <- rbind(ResultsFU3_cat, ResultsFU3_cat_kbi_school_sq2)
ResultsFU3_comp <- rbind(ResultsFU3, ResultsFU3_reshist, ResultsFU3_sexvar, ResultsFU3_other, ResultsFU3_cat)
ResultsFU3_comp <- ResultsFU3_comp %>%
  dplyr::filter(Variable!="ksads_bd_raw_162_pTRAN")
ResultsFU3_comp$FDR <- p.adjust(ResultsFU3_comp$Pval, method = "fdr")
ResultsFU3_comp$Bonferroni <- p.adjust(ResultsFU3_comp$Pval, method = "bonferroni")
#Write out results
fwrite(ResultsFU3_comp, "Neurodev_results_FU_11_18.txt", sep="\t")
detach(PheWAS_FU2)
```

#### FU Internalizing PRS ####
```{r}
which(colnames(PheWAS_FU2)=="tlfb_list_l2___1")
attach(PheWAS_FU2)
First <- 22
Last <- 1053
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU2[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU4 <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU4) <- c("Variable", "Beta", "STE", "Pval")
intersect(search(), objects())
ResultsFU4 <- ResultsFU4 %>%
  filter(Variable != "kbi_p_c_school_setting_l_home",
         Variable != "kbi_p_c_school_setting_l_public",
         Variable != "kbi_p_c_school_setting_l_private")
detach(PheWAS_FU2)
attach(PheWAS_FU_reshist)

# take out rel_family_id and covid visit type (shouldn't matter anyway)
First <- 22
Last <- 118
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_reshist[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_reshist)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU4_reshist <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU4_reshist) <- c("Variable", "Beta", "STE", "Pval")


## family or site ID???
mj_laws_rec_mod4 <- glmer(as.factor(reshist_state_mj_laws_rec) ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|rel_family_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_reshist)
mj_laws_med_mod4 <- glmer(as.factor(reshist_state_mj_laws_med) ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|rel_family_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_reshist)
mj_laws_low_mod4 <- glmer(as.factor(reshist_state_mj_laws_low) ~ Internalizing_PRScs +  C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + sex + (1|rel_family_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_reshist)

Variable <- colnames(PheWAS_FU_reshist[119:121])
Beta <- c(coef(summary(mj_laws_rec_mod4))[2,1], coef(summary(mj_laws_med_mod4))[2,1], coef(summary(mj_laws_low_mod4))[2,1])
STE <- c(coef(summary(mj_laws_rec_mod4))[2,2], coef(summary(mj_laws_med_mod4))[2,2], coef(summary(mj_laws_low_mod4))[2,2])
Pval <- c(coef(summary(mj_laws_rec_mod4))[2,4], coef(summary(mj_laws_med_mod4))[2,4], coef(summary(mj_laws_low_mod4))[2,4])
ResultsFU4_reshistb <- cbind(Variable, Beta, STE, Pval)

ResultsFU4_reshist <- rbind(ResultsFU4_reshist, ResultsFU4_reshistb)


detach(PheWAS_FU_reshist)
attach(PheWAS_FU_sexvar)

PheWAS_FU_sexvar <- PheWAS_FU_sexvar %>%
  relocate(where(is.factor), .after = where(is.numeric)) %>%
  relocate(subjectkey:COVID_visittype, .before = where(is.numeric))

# take out sex and covid visit type
First <- 22
Last <- 81
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_sexvar[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age +  (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_sexvar)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU4_sexvar <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU4_sexvar) <- c("Variable", "Beta", "STE", "Pval")

pds_f5_y_mod4 <- glmer(pds_f5_y ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)
pds_f5b_p_mod4 <- glmer(pds_f5b_p ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)
menstrualcycle3_y_mod4 <- glmer(menstrualcycle3_y ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)
menstrualcycle3_p_mod4 <- glmer(menstrualcycle3_p ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + interview_age + (1|rel_family_id) + (1|site_id), nAGQ = 0, family = "binomial", data = PheWAS_FU_sexvar)

Variable <- colnames(PheWAS_FU_sexvar[82:85])
Beta <- c(coef(summary(pds_f5_y_mod4))[2,1], coef(summary(pds_f5b_p_mod4))[2,1], coef(summary(menstrualcycle3_y_mod4))[2,1], coef(summary(menstrualcycle3_p_mod4))[2,1])
STE <- c(coef(summary(pds_f5_y_mod4))[2,2], coef(summary(pds_f5b_p_mod4))[2,2], coef(summary(menstrualcycle3_y_mod4))[2,2], coef(summary(menstrualcycle3_p_mod4))[2,2])
Pval <- c(coef(summary(pds_f5_y_mod4))[2,4], coef(summary(pds_f5b_p_mod4))[2,4], coef(summary(menstrualcycle3_y_mod4))[2,4], coef(summary(menstrualcycle3_p_mod4))[2,4])
ResultsFU4_sexvarb <- cbind(Variable, Beta, STE, Pval)

ResultsFU4_sexvar <- rbind(ResultsFU4_sexvar, ResultsFU4_sexvarb)


detach(PheWAS_FU_sexvar)
attach(PheWAS_FU_other)

# take out sex and covid visit type
First <- 22
Last <- 52
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_other[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age +  (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_other)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU4_other <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU4_other) <- c("Variable", "Beta", "STE", "Pval")

# take out sex and covid visit type and family id
First <- 53
Last <- 58
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(PheWAS_FU_other[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(PheWAS_FU_other)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU4_other2 <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU4_other2) <- c("Variable", "Beta", "STE", "Pval")

ResultsFU4_other <- rbind(ResultsFU4_other, ResultsFU4_other2)
detach(PheWAS_FU_other)

which(colnames(PheWAS_FU2) == "tlfb_list_l2___1")
which(colnames(PheWAS_FU2) == "kbi_p_c_school_setting_l_home")
PheWAS_FU2 <- PheWAS_FU2 %>%
  relocate(contains("_sq2_"), .after = "kbi_p_c_school_setting_l_private")
attach(PheWAS_FU2)

# take out sex and covid visit type
First <- 1054
Last <- 1507
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- glmer(PheWAS_FU2[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age +  (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(PheWAS_FU2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
ResultsFU4_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(ResultsFU4_cat) <- c("Variable", "Beta", "STE", "Pval")

kbi_home_mod4 <- glmer(kbi_p_c_school_setting_l_home ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
kbi_public_mod4 <- glmer(kbi_p_c_school_setting_l_public ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
kbi_private_mod4 <- glmer(kbi_p_c_school_setting_l_public ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)

screen_sq2_phoneoff_mod4 <- glmer(screentime_sq2_phoneoff ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
screen_sq2_silent_mod4 <- glmer(screentime_sq2_silent ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
screen_sq2_ringeron_mod4 <- glmer(screentime_sq2_ringeron ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)
screen_sq2_outside_mod4 <- glmer(screentime_sq2_outside ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + COVID_visittype + (1|rel_family_id) + (1|site_id), family = "binomial", nAGQ = 0, data = PheWAS_FU2)

Variable <- c("kbi_new_school_setting_l_home", "kbi_new_school_setting_l_public", "kbi_new_school_setting_l_private", "screentime_sq2_phoneoff", "screentime_sq2_silent", "screentime_sq2_ringeron", "screentime_sq2_outside")
Beta <- c(coef(summary(kbi_home_mod4))[2,1], coef(summary(kbi_public_mod4))[2,1], coef(summary(kbi_private_mod4))[2,1], coef(summary(screen_sq2_phoneoff_mod4))[2,1], coef(summary(screen_sq2_silent_mod4))[2,1], coef(summary(screen_sq2_ringeron_mod4))[2,1], coef(summary(screen_sq2_outside_mod4))[2,1])
STE <- c(coef(summary(kbi_home_mod4))[2,2], coef(summary(kbi_public_mod4))[2,2], coef(summary(kbi_private_mod4))[2,2], coef(summary(screen_sq2_phoneoff_mod4))[2,2], coef(summary(screen_sq2_silent_mod4))[2,2], coef(summary(screen_sq2_ringeron_mod4))[2,2], coef(summary(screen_sq2_outside_mod4))[2,2])
Pval <- c(coef(summary(kbi_home_mod4))[2,4], coef(summary(kbi_public_mod4))[2,4], coef(summary(kbi_private_mod4))[2,4], coef(summary(screen_sq2_phoneoff_mod4))[2,4], coef(summary(screen_sq2_silent_mod4))[2,4], coef(summary(screen_sq2_ringeron_mod4))[2,4], coef(summary(screen_sq2_outside_mod4))[2,4])
ResultsFU4_cat_kbi_school_sq2 <- cbind(Variable, Beta, STE, Pval)

ResultsFU4_cat <- rbind(ResultsFU4_cat, ResultsFU4_cat_kbi_school_sq2)
ResultsFU4_comp <- rbind(ResultsFU4, ResultsFU4_reshist, ResultsFU4_sexvar, ResultsFU4_other, ResultsFU4_cat)
ResultsFU4_comp <- ResultsFU4_comp %>%
  dplyr::filter(Variable!="ksads_bd_raw_162_pTRAN")
ResultsFU4_comp$FDR <- p.adjust(ResultsFU4_comp$Pval, method = "fdr")
ResultsFU4_comp$Bonferroni <- p.adjust(ResultsFU4_comp$Pval, method = "bonferroni")
#Write out results
fwrite(ResultsFU4_comp, "Internalizing_results_FU_11_18.txt", sep="\t")
detach(PheWAS_FU2)


```


#### IMAGING ANALYSES ####
```{r}
MRI <- read_excel("abcd30_baseline_allMRIvariables_forphewas.xlsx")
MRI<- merge(PheWAS_baseline[,1:20], MRI, by = "subjectkey")

MRIcovs <- MRI %>%
  dplyr::select(1:20, mri_info_manufacturer_COV, rsfmri_c_ngd_meanmotion_COV, dmri_dti_meanmotion_COV, dmri_dtifa_fiberat_allfibers, smri_vol_cdk_total, smri_area_cdk_total, smri_thick_cdk_mean, smri_vol_scs_subcorticalgv)

MRIglobal <- MRI %>%
  dplyr::select(1:20, mri_info_manufacturer_COV, dmri_dti_meanmotion_COV, smri_vol_scs_intracranialv, smri_vol_cdk_total, smri_area_cdk_total, smri_thick_cdk_mean, smri_vol_scs_subcorticalgv, smri_vol_scs_wholeb, smri_vol_scs_suprateialv, smri_vol_scs_cbwmatterlh, smri_vol_scs_cbwmatterrh, smri_vol_cdk_totallh, smri_vol_cdk_totalrh, smri_thick_cdk_meanlh, smri_thick_cdk_meanrh, smri_area_cdk_totallh, smri_area_cdk_totalrh, dmri_dtifa_fiberat_allfibers, dmri_dtimd_fiberat_allfibers)

MRIcortvol <- MRI %>%
  dplyr::select(1:20, mri_info_manufacturer_COV, smri_vol_cdk_total, contains("smri_vol_cdk")) %>%
  dplyr::select(-smri_vol_cdk_totallh, -smri_vol_cdk_totalrh)

MRIsubcortvol <- MRI %>%
  dplyr::select(1:20, mri_info_manufacturer_COV, smri_vol_scs_subcorticalgv, contains("smri_vol_scs")) %>%
  dplyr::select(-smri_vol_scs_intracranialv, -smri_vol_scs_wholeb, -smri_vol_scs_suprateialv, -smri_vol_scs_cbwmatterlh, -smri_vol_scs_cbwmatterrh, -contains("wmhint"))

MRIcortarea <- MRI %>%
  dplyr::select(1:20, mri_info_manufacturer_COV, smri_area_cdk_total, contains("smri_area_cdk")) %>%
  dplyr::select(-smri_area_cdk_totallh, -smri_area_cdk_totalrh)

MRIcortthick <- MRI %>%
  dplyr::select(1:20, mri_info_manufacturer_COV, smri_thick_cdk_mean, contains("smri_thick_cdk")) %>%
  dplyr::select(-smri_thick_cdk_meanlh, -smri_thick_cdk_meanrh)

MRIdtifa <- MRI %>%
  dplyr::select(1:20, mri_info_manufacturer_COV, dmri_dti_meanmotion_COV, dmri_dtifa_fiberat_allfibers, contains("dmri_dtifa")) %>%
  dplyr::select(-c(61:80))

MRIdtimd <- MRI %>%
  dplyr::select(1:20, mri_info_manufacturer_COV, dmri_dti_meanmotion_COV, dmri_dtifa_fiberat_allfibers, contains("dmri_dtimd")) %>%
  dplyr::select(-c(61:65))

MRIrsfc <- MRI %>%
  dplyr::select(1:20, mri_info_manufacturer_COV, rsfmri_c_ngd_meanmotion_COV, contains("rsfmri")) %>%
  dplyr::select(-rsfmri_c_ngd_ca_ngd_ad, -rsfmri_c_ngd_cgc_ngd_ad, -rsfmri_c_ngd_cgc_ngd_ca, -rsfmri_c_ngd_dla_ngd_ad, -rsfmri_c_ngd_dla_ngd_ca, -rsfmri_c_ngd_dla_ngd_cgc, -rsfmri_c_ngd_dt_ngd_ad, -rsfmri_c_ngd_dt_ngd_ca, -rsfmri_c_ngd_dt_ngd_cgc, -rsfmri_c_ngd_dt_ngd_dla, -rsfmri_c_ngd_fo_ngd_ad, -rsfmri_c_ngd_fo_ngd_ca, -rsfmri_c_ngd_fo_ngd_cgc, -rsfmri_c_ngd_fo_ngd_dla, -rsfmri_c_ngd_fo_ngd_dt, -rsfmri_c_ngd_n_ngd_ad, -rsfmri_c_ngd_n_ngd_ca, -rsfmri_c_ngd_n_ngd_cgc, -rsfmri_c_ngd_n_ngd_dla, -rsfmri_c_ngd_n_ngd_dt, -rsfmri_c_ngd_n_ngd_fo, -rsfmri_c_ngd_rspltp_ngd_ad, -rsfmri_c_ngd_rspltp_ngd_ca, -rsfmri_c_ngd_rspltp_ngd_cgc, -rsfmri_c_ngd_rspltp_ngd_dla, -rsfmri_c_ngd_rspltp_ngd_dt, -rsfmri_c_ngd_rspltp_ngd_fo, -rsfmri_c_ngd_rspltp_ngd_n, -rsfmri_c_ngd_sa_ngd_ad, -rsfmri_c_ngd_sa_ngd_ca, -rsfmri_c_ngd_sa_ngd_cgc, -rsfmri_c_ngd_sa_ngd_dla, -rsfmri_c_ngd_sa_ngd_dt, -rsfmri_c_ngd_sa_ngd_fo, -rsfmri_c_ngd_sa_ngd_n, -rsfmri_c_ngd_sa_ngd_rspltp, -rsfmri_c_ngd_smh_ngd_ad, -rsfmri_c_ngd_smh_ngd_ca, -rsfmri_c_ngd_smh_ngd_cgc, -rsfmri_c_ngd_smh_ngd_dla, -rsfmri_c_ngd_smh_ngd_dt, -rsfmri_c_ngd_smh_ngd_fo, -rsfmri_c_ngd_smh_ngd_n, -rsfmri_c_ngd_smh_ngd_rspltp, -rsfmri_c_ngd_smh_ngd_sa, -rsfmri_c_ngd_smm_ngd_ad, -rsfmri_c_ngd_smm_ngd_ca, -rsfmri_c_ngd_smm_ngd_cgc, -rsfmri_c_ngd_smm_ngd_dla, -rsfmri_c_ngd_smm_ngd_dt, -rsfmri_c_ngd_smm_ngd_fo, -rsfmri_c_ngd_smm_ngd_n, -rsfmri_c_ngd_smm_ngd_rspltp, -rsfmri_c_ngd_smm_ngd_sa, -rsfmri_c_ngd_smm_ngd_smh, -rsfmri_c_ngd_vs_ngd_ad, -rsfmri_c_ngd_vs_ngd_ca, -rsfmri_c_ngd_vs_ngd_cgc, -rsfmri_c_ngd_vs_ngd_dla, -rsfmri_c_ngd_vs_ngd_dt, -rsfmri_c_ngd_vs_ngd_fo, -rsfmri_c_ngd_vs_ngd_n, -rsfmri_c_ngd_vs_ngd_rspltp, -rsfmri_c_ngd_vs_ngd_sa, -rsfmri_c_ngd_vs_ngd_smh, -rsfmri_c_ngd_vs_ngd_smm, -rsfmri_c_ngd_vta_ngd_ad, -rsfmri_c_ngd_vta_ngd_ca, -rsfmri_c_ngd_vta_ngd_cgc, -rsfmri_c_ngd_vta_ngd_dla, -rsfmri_c_ngd_vta_ngd_dt, -rsfmri_c_ngd_vta_ngd_fo, -rsfmri_c_ngd_vta_ngd_n, -rsfmri_c_ngd_vta_ngd_rspltp, -rsfmri_c_ngd_vta_ngd_sa, -rsfmri_c_ngd_vta_ngd_smh, -rsfmri_c_ngd_vta_ngd_smm, -rsfmri_c_ngd_vta_ngd_vs)
```

#### Global imaging analyses ####
```{r}
MRIglobal[, c(1:4, 20:21)] <- lapply(MRIglobal[,c(1:4, 20:21)], as.factor)
MRIglobal[, c(5:19, 22:39)] <- lapply(MRIglobal[,c(5:19, 22:39)], as.numeric)

MRIglobal <- MRIglobal %>%
  mutate_if(is.numeric, scale)

MRIglobal[MRIglobal == "NA"] <- NA

attach(MRIglobal)

## Compulsive PRS
First <- 22
#********CHANGE********Number of the last column you want to run. 
Last <- 36
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIglobal[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIglobal)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Comp_global <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Comp_global) <- c("Variable", "Beta", "STE", "Pval")

global_FA_mod1 <- lmer(dmri_dtifa_fiberat_allfibers ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + (1|site_id) + (1|rel_family_id))
global_MD_mod1 <- lmer(dmri_dtimd_fiberat_allfibers ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + (1|site_id) + (1|rel_family_id))

Variable <- c("dmri_dtifa_fiberat_allfibers", "dmri_dtimd_fiberat_allfibers")
Beta <- c(coef(summary(global_FA_mod1))[2,1], coef(summary(global_MD_mod1))[2,1])
STE <- c(coef(summary(global_FA_mod1))[2,2], coef(summary(global_MD_mod1))[2,2])
Pval <- c(coef(summary(global_FA_mod1))[2,5], coef(summary(global_MD_mod1))[2,5])

Results_Comp_global_DTI <- cbind(Variable, Beta, STE, Pval)
Results_Comp_global <- rbind(Results_Comp_global[,1:4], Results_Comp_global_DTI)
Results_Comp_global$FDR <- p.adjust(Results_Comp_global$Pval, method = "fdr")
Results_Comp_global$Bonferroni <- p.adjust(Results_Comp_global$Pval, method = "bonferroni")
fwrite(Results_Comp_global, file = "Results_Compulsive_GlobalMRI_10.28.22.txt", sep = "\t")

## Psychotic PRS
First <- 22
#********CHANGE********Number of the last column you want to run. 
Last <- 36
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIglobal[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIglobal)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Psych_global <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Psych_global) <- c("Variable", "Beta", "STE", "Pval")

global_FA_mod2 <- lmer(dmri_dtifa_fiberat_allfibers ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + (1|site_id) + (1|rel_family_id))
global_MD_mod2 <- lmer(dmri_dtimd_fiberat_allfibers ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + (1|site_id) + (1|rel_family_id))

Variable <- c("dmri_dtifa_fiberat_allfibers", "dmri_dtimd_fiberat_allfibers")
Beta <- c(coef(summary(global_FA_mod2))[2,1], coef(summary(global_MD_mod2))[2,1])
STE <- c(coef(summary(global_FA_mod2))[2,2], coef(summary(global_MD_mod2))[2,2])
Pval <- c(coef(summary(global_FA_mod2))[2,5], coef(summary(global_MD_mod2))[2,5])

Results_Psych_global_DTI <- cbind(Variable, Beta, STE, Pval)
Results_Psych_global <- rbind(Results_Psych_global[,1:4], Results_Psych_global_DTI)
Results_Psych_global$FDR <- p.adjust(Results_Psych_global$Pval, method = "fdr")
Results_Psych_global$Bonferroni <- p.adjust(Results_Psych_global$Pval, method = "bonferroni")
fwrite(Results_Psych_global, file = "Results_Psychotic_GlobalMRI_10.28.22.txt", sep = "\t")

## Neurodev PRS
First <- 22
#********CHANGE********Number of the last column you want to run. 
Last <- 36
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIglobal[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIglobal)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neuro_global <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neuro_global) <- c("Variable", "Beta", "STE", "Pval")

global_FA_mod3 <- lmer(dmri_dtifa_fiberat_allfibers ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + (1|site_id) + (1|rel_family_id))
global_MD_mod3 <- lmer(dmri_dtimd_fiberat_allfibers ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + (1|site_id) + (1|rel_family_id))

Variable <- c("dmri_dtifa_fiberat_allfibers", "dmri_dtimd_fiberat_allfibers")
Beta <- c(coef(summary(global_FA_mod3))[2,1], coef(summary(global_MD_mod3))[2,1])
STE <- c(coef(summary(global_FA_mod3))[2,2], coef(summary(global_MD_mod3))[2,2])
Pval <- c(coef(summary(global_FA_mod3))[2,5], coef(summary(global_MD_mod3))[2,5])

Results_Neuro_global_DTI <- cbind(Variable, Beta, STE, Pval)
Results_Neuro_global <- rbind(Results_Neuro_global[,1:4], Results_Neuro_global_DTI)
Results_Neuro_global$FDR <- p.adjust(Results_Neuro_global$Pval, method = "fdr")
Results_Neuro_global$Bonferroni <- p.adjust(Results_Neuro_global$Pval, method = "bonferroni")
fwrite(Results_Neuro_global, file = "Results_Neurodev_GlobalMRI_10.28.22.txt", sep = "\t")

## Internalizing PRS
First <- 22
#********CHANGE********Number of the last column you want to run. 
Last <- 36
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIglobal[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIglobal)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Internal_global <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Internal_global) <- c("Variable", "Beta", "STE", "Pval")

global_FA_mod4 <- lmer(dmri_dtifa_fiberat_allfibers ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + (1|site_id) + (1|rel_family_id))
global_MD_mod4 <- lmer(dmri_dtimd_fiberat_allfibers ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + (1|site_id) + (1|rel_family_id))

Variable <- c("dmri_dtifa_fiberat_allfibers", "dmri_dtimd_fiberat_allfibers")
Beta <- c(coef(summary(global_FA_mod4))[2,1], coef(summary(global_MD_mod4))[2,1])
STE <- c(coef(summary(global_FA_mod4))[2,2], coef(summary(global_MD_mod4))[2,2])
Pval <- c(coef(summary(global_FA_mod4))[2,5], coef(summary(global_MD_mod4))[2,5])

Results_Internal_global_DTI <- cbind(Variable, Beta, STE, Pval)
Results_Internal_global <- rbind(Results_Internal_global[,1:4], Results_Internal_global_DTI)
Results_Internal_global$FDR <- p.adjust(Results_Internal_global$Pval, method = "fdr")
Results_Internal_global$Bonferroni <- p.adjust(Results_Internal_global$Pval, method = "bonferroni")
fwrite(Results_Internal_global, file = "Results_Internalizing_GlobalMRI_10.28.22.txt", sep = "\t")
```

#### Cortical Volume Imaging Analyses ####
```{r}
MRIcortvol[, c(1:4, 20:21)] <- lapply(MRIcortvol[,c(1:4, 20:21)], as.factor)
MRIcortvol[, c(5:19, 22:90)] <- lapply(MRIcortvol[,c(5:19, 22:90)], as.numeric)

MRIcortvol <- MRIcortvol %>%
  mutate_if(is.numeric, scale)

MRIcortvol[MRIcortvol == "NA"] <- NA

attach(MRIcortvol)

## Compulsive PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 90
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIcortvol[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_vol_cdk_total + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIcortvol)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Comp_CortVol <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Comp_CortVol) <- c("Variable", "Beta", "STE", "Pval")
Results_Comp_CortVol$FDR <- p.adjust(Results_Comp_CortVol$Pval, method = "fdr")
Results_Comp_CortVol$Bonferroni <- p.adjust(Results_Comp_CortVol$Pval, method = "bonferroni")
fwrite(Results_Comp_CortVol, file = "Results_Compulsive_CorticalVolMRI_10.28.22.txt", sep = "\t")


## Psychotic PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 90
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIcortvol[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_vol_cdk_total + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIcortvol)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Psych_CortVol <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Psych_CortVol) <- c("Variable", "Beta", "STE", "Pval")
Results_Psych_CortVol$FDR <- p.adjust(Results_Psych_CortVol$Pval, method = "fdr")
Results_Psych_CortVol$Bonferroni <- p.adjust(Results_Psych_CortVol$Pval, method = "bonferroni")
fwrite(Results_Psych_CortVol, file = "Results_Psychotic_CorticalVolMRI_10.28.22.txt", sep = "\t")


## Neurodev PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 90
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIcortvol[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_vol_cdk_total + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIcortvol)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neuro_CortVol <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neuro_CortVol) <- c("Variable", "Beta", "STE", "Pval")
Results_Neuro_CortVol$FDR <- p.adjust(Results_Neuro_CortVol$Pval, method = "fdr")
Results_Neuro_CortVol$Bonferroni <- p.adjust(Results_Neuro_CortVol$Pval, method = "bonferroni")
fwrite(Results_Neuro_CortVol, file = "Results_Neurodev_CorticalVolMRI_10.28.22.txt", sep = "\t")


## Internalizing PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 90
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIcortvol[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_vol_cdk_total + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIcortvol)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Internal_CortVol <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Internal_CortVol) <- c("Variable", "Beta", "STE", "Pval")
Results_Internal_CortVol$FDR <- p.adjust(Results_Internal_CortVol$Pval, method = "fdr")
Results_Internal_CortVol$Bonferroni <- p.adjust(Results_Internal_CortVol$Pval, method = "bonferroni")
fwrite(Results_Internal_CortVol, file = "Results_Internalizing_CorticalVolMRI_10.28.22.txt", sep = "\t")

detach(MRIcortvol)
```

#### Cortical Area Imaging Analyses ####
```{r}
MRIcortarea[, c(1:4, 20:21)] <- lapply(MRIcortarea[,c(1:4, 20:21)], as.factor)
MRIcortarea[, c(5:19, 22:90)] <- lapply(MRIcortarea[,c(5:19, 22:90)], as.numeric)

MRIcortarea <- MRIcortarea %>%
  mutate_if(is.numeric, scale)

MRIcortarea[MRIcortarea == "NA"] <- NA

attach(MRIcortarea)

## Compulsive PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 90
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIcortarea[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_area_cdk_total + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIcortarea)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Comp_Cortarea <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Comp_Cortarea) <- c("Variable", "Beta", "STE", "Pval")
Results_Comp_Cortarea$FDR <- p.adjust(Results_Comp_Cortarea$Pval, method = "fdr")
Results_Comp_Cortarea$Bonferroni <- p.adjust(Results_Comp_Cortarea$Pval, method = "bonferroni")
fwrite(Results_Comp_Cortarea, file = "Results_Compulsive_CorticalareaMRI_10.28.22.txt", sep = "\t")


## Psychotic PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 90
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIcortarea[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_area_cdk_total + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIcortarea)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Psych_Cortarea <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Psych_Cortarea) <- c("Variable", "Beta", "STE", "Pval")
Results_Psych_Cortarea$FDR <- p.adjust(Results_Psych_Cortarea$Pval, method = "fdr")
Results_Psych_Cortarea$Bonferroni <- p.adjust(Results_Psych_Cortarea$Pval, method = "bonferroni")
fwrite(Results_Psych_Cortarea, file = "Results_Psychotic_CorticalareaMRI_10.28.22.txt", sep = "\t")


## Neurodev PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 90
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIcortarea[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_area_cdk_total + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIcortarea)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neuro_Cortarea <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neuro_Cortarea) <- c("Variable", "Beta", "STE", "Pval")
Results_Neuro_Cortarea$FDR <- p.adjust(Results_Neuro_Cortarea$Pval, method = "fdr")
Results_Neuro_Cortarea$Bonferroni <- p.adjust(Results_Neuro_Cortarea$Pval, method = "bonferroni")
fwrite(Results_Neuro_Cortarea, file = "Results_Neurodev_CorticalareaMRI_10.28.22.txt", sep = "\t")


## Internalizing PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 90
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIcortarea[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_area_cdk_total + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIcortarea)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Internal_Cortarea <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Internal_Cortarea) <- c("Variable", "Beta", "STE", "Pval")
Results_Internal_Cortarea$FDR <- p.adjust(Results_Internal_Cortarea$Pval, method = "fdr")
Results_Internal_Cortarea$Bonferroni <- p.adjust(Results_Internal_Cortarea$Pval, method = "bonferroni")
fwrite(Results_Internal_Cortarea, file = "Results_Internalizing_CorticalareaMRI_10.28.22.txt", sep = "\t")

detach(MRIcortarea)
```

#### Cortical Thickness Imaging Analyses ####
```{r}
MRIcortthick[, c(1:4, 20:21)] <- lapply(MRIcortthick[,c(1:4, 20:21)], as.factor)
MRIcortthick[, c(5:19, 22:90)] <- lapply(MRIcortthick[,c(5:19, 22:90)], as.numeric)

MRIcortthick <- MRIcortthick %>%
  mutate_if(is.numeric, scale)

MRIcortthick[MRIcortthick == "NA"] <- NA

attach(MRIcortthick)

## Compulsive PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 90
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIcortthick[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_thick_cdk_mean + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIcortthick)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Comp_Cortthick <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Comp_Cortthick) <- c("Variable", "Beta", "STE", "Pval")
Results_Comp_Cortthick$FDR <- p.adjust(Results_Comp_Cortthick$Pval, method = "fdr")
Results_Comp_Cortthick$Bonferroni <- p.adjust(Results_Comp_Cortthick$Pval, method = "bonferroni")
fwrite(Results_Comp_Cortthick, file = "Results_Compulsive_CorticalthickMRI_10.28.22.txt", sep = "\t")


## Psychotic PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 90
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIcortthick[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_thick_cdk_mean + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIcortthick)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Psych_Cortthick <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Psych_Cortthick) <- c("Variable", "Beta", "STE", "Pval")
Results_Psych_Cortthick$FDR <- p.adjust(Results_Psych_Cortthick$Pval, method = "fdr")
Results_Psych_Cortthick$Bonferroni <- p.adjust(Results_Psych_Cortthick$Pval, method = "bonferroni")
fwrite(Results_Psych_Cortthick, file = "Results_Psychotic_CorticalthickMRI_10.28.22.txt", sep = "\t")


## Neurodev PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 90
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIcortthick[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_thick_cdk_mean + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIcortthick)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neuro_Cortthick <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neuro_Cortthick) <- c("Variable", "Beta", "STE", "Pval")
Results_Neuro_Cortthick$FDR <- p.adjust(Results_Neuro_Cortthick$Pval, method = "fdr")
Results_Neuro_Cortthick$Bonferroni <- p.adjust(Results_Neuro_Cortthick$Pval, method = "bonferroni")
fwrite(Results_Neuro_Cortthick, file = "Results_Neurodev_CorticalthickMRI_10.28.22.txt", sep = "\t")


## Internalizing PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 90
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIcortthick[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_thick_cdk_mean + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIcortthick)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Internal_Cortthick <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Internal_Cortthick) <- c("Variable", "Beta", "STE", "Pval")
Results_Internal_Cortthick$FDR <- p.adjust(Results_Internal_Cortthick$Pval, method = "fdr")
Results_Internal_Cortthick$Bonferroni <- p.adjust(Results_Internal_Cortthick$Pval, method = "bonferroni")
fwrite(Results_Internal_Cortthick, file = "Results_Internalizing_CorticalthickMRI_10.28.22.txt", sep = "\t")

detach(MRIcortthick)
```

#### Subcortical Volume Imaging Analyses ####
```{r}
MRIsubcortvol[, c(1:4, 20:21)] <- lapply(MRIsubcortvol[,c(1:4, 20:21)], as.factor)
MRIsubcortvol[, c(5:19, 22:57)] <- lapply(MRIsubcortvol[,c(5:19, 22:57)], as.numeric)

MRIsubcortvol <- MRIsubcortvol %>%
  mutate_if(is.numeric, scale)

MRIsubcortvol[MRIsubcortvol == "NA"] <- NA

attach(MRIsubcortvol)

## Compulsive PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 57
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIsubcortvol[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_vol_scs_subcorticalgv + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIsubcortvol)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Comp_subcortVol <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Comp_subcortVol) <- c("Variable", "Beta", "STE", "Pval")
Results_Comp_subcortVol$FDR <- p.adjust(Results_Comp_subcortVol$Pval, method = "fdr")
Results_Comp_subcortVol$Bonferroni <- p.adjust(Results_Comp_subcortVol$Pval, method = "bonferroni")
fwrite(Results_Comp_subcortVol, file = "Results_Compulsive_subcorticalVolMRI_10.28.22.txt", sep = "\t")


## Psychotic PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 57
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIsubcortvol[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_vol_scs_subcorticalgv + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIsubcortvol)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Psych_subcortVol <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Psych_subcortVol) <- c("Variable", "Beta", "STE", "Pval")
Results_Psych_subcortVol$FDR <- p.adjust(Results_Psych_subcortVol$Pval, method = "fdr")
Results_Psych_subcortVol$Bonferroni <- p.adjust(Results_Psych_subcortVol$Pval, method = "bonferroni")
fwrite(Results_Psych_subcortVol, file = "Results_Psychotic_subcorticalVolMRI_10.28.22.txt", sep = "\t")


## Neurodev PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 57
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIsubcortvol[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_vol_scs_subcorticalgv + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIsubcortvol)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neuro_subcortVol <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neuro_subcortVol) <- c("Variable", "Beta", "STE", "Pval")
Results_Neuro_subcortVol$FDR <- p.adjust(Results_Neuro_subcortVol$Pval, method = "fdr")
Results_Neuro_subcortVol$Bonferroni <- p.adjust(Results_Neuro_subcortVol$Pval, method = "bonferroni")
fwrite(Results_Neuro_subcortVol, file = "Results_Neurodev_subcorticalVolMRI_10.28.22.txt", sep = "\t")


## Internalizing PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 57
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIsubcortvol[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + smri_vol_scs_subcorticalgv + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIsubcortvol)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Internal_subcortVol <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Internal_subcortVol) <- c("Variable", "Beta", "STE", "Pval")
Results_Internal_subcortVol$FDR <- p.adjust(Results_Internal_subcortVol$Pval, method = "fdr")
Results_Internal_subcortVol$Bonferroni <- p.adjust(Results_Internal_subcortVol$Pval, method = "bonferroni")
fwrite(Results_Internal_subcortVol, file = "Results_Internalizing_subcorticalVolMRI_10.28.22.txt", sep = "\t")

detach(MRIsubcortvol)

```

#### RSFC Imaging Analyses ####
```{r}
MRIrsfc[, c(1:4, 20:21)] <- lapply(MRIrsfc[,c(1:4, 20:21)], as.factor)
MRIrsfc[, c(5:19, 22:113)] <- lapply(MRIrsfc[,c(5:19, 22:113)], as.numeric)

MRIrsfc <- MRIrsfc %>%
  mutate_if(is.numeric, scale)

MRIrsfc[MRIrsfc == "NA"] <- NA

attach(MRIrsfc)

## Compulsive PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 113
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIrsfc[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + rsfmri_c_ngd_meanmotion_COV + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIrsfc)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Comp_rsfc <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Comp_rsfc) <- c("Variable", "Beta", "STE", "Pval")
Results_Comp_rsfc$FDR <- p.adjust(Results_Comp_rsfc$Pval, method = "fdr")
Results_Comp_rsfc$Bonferroni <- p.adjust(Results_Comp_rsfc$Pval, method = "bonferroni")
fwrite(Results_Comp_rsfc, file = "Results_Compulsive_MRIrsfc_11.6.22.txt", sep = "\t")


## Psychotic PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 113
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIrsfc[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + rsfmri_c_ngd_meanmotion_COV + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIrsfc)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Psych_rsfc <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Psych_rsfc) <- c("Variable", "Beta", "STE", "Pval")
Results_Psych_rsfc$FDR <- p.adjust(Results_Psych_rsfc$Pval, method = "fdr")
Results_Psych_rsfc$Bonferroni <- p.adjust(Results_Psych_rsfc$Pval, method = "bonferroni")
fwrite(Results_Psych_rsfc, file = "Results_Psychotic_MRIrsfc_11.6.22.txt", sep = "\t")


## Neurodev PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 113
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIrsfc[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + rsfmri_c_ngd_meanmotion_COV + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIrsfc)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neuro_rsfc <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neuro_rsfc) <- c("Variable", "Beta", "STE", "Pval")
Results_Neuro_rsfc$FDR <- p.adjust(Results_Neuro_rsfc$Pval, method = "fdr")
Results_Neuro_rsfc$Bonferroni <- p.adjust(Results_Neuro_rsfc$Pval, method = "bonferroni")
fwrite(Results_Neuro_rsfc, file = "Results_Neurodev_MRIrsfc_11.6.22.txt", sep = "\t")


## Internalizing PRS
First <- 23
#********CHANGE********Number of the last column you want to run. 
Last <- 113
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIrsfc[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + rsfmri_c_ngd_meanmotion_COV + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIrsfc)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Internal_rsfc <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Internal_rsfc) <- c("Variable", "Beta", "STE", "Pval")
Results_Internal_rsfc$FDR <- p.adjust(Results_Internal_rsfc$Pval, method = "fdr")
Results_Internal_rsfc$Bonferroni <- p.adjust(Results_Internal_rsfc$Pval, method = "bonferroni")
fwrite(Results_Internal_rsfc, file = "Results_Internalizing_MRIrsfc_11.6.22.txt", sep = "\t")

detach(MRIrsfc)

```

#### FA Imaging Analyses ####
```{r}
MRIdtifa[, c(1:4, 20:21)] <- lapply(MRIdtifa[,c(1:4, 20:21)], as.factor)
MRIdtifa[, c(5:19, 22:60)] <- lapply(MRIdtifa[,c(5:19, 22:60)], as.numeric)

MRIdtifa <- MRIdtifa %>%
  mutate_if(is.numeric, scale)

MRIdtifa[MRIdtifa == "NA"] <- NA

attach(MRIdtifa)

## Compulsive PRS
First <- 24
#********CHANGE********Number of the last column you want to run. 
Last <- 60
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIdtifa[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + dmri_dtifa_fiberat_allfibers + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIdtifa)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Comp_dtifa <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Comp_dtifa) <- c("Variable", "Beta", "STE", "Pval")
Results_Comp_dtifa$FDR <- p.adjust(Results_Comp_dtifa$Pval, method = "fdr")
Results_Comp_dtifa$Bonferroni <- p.adjust(Results_Comp_dtifa$Pval, method = "bonferroni")
fwrite(Results_Comp_dtifa, file = "Results_Compulsive_MRIdtifa_10.28.22.txt", sep = "\t")


## Psychotic PRS
First <- 24
#********CHANGE********Number of the last column you want to run. 
Last <- 60
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIdtifa[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + dmri_dtifa_fiberat_allfibers + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIdtifa)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Psych_dtifa <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Psych_dtifa) <- c("Variable", "Beta", "STE", "Pval")
Results_Psych_dtifa$FDR <- p.adjust(Results_Psych_dtifa$Pval, method = "fdr")
Results_Psych_dtifa$Bonferroni <- p.adjust(Results_Psych_dtifa$Pval, method = "bonferroni")
fwrite(Results_Psych_dtifa, file = "Results_Psychotic_MRIdtifa_10.28.22.txt", sep = "\t")


## Neurodev PRS
First <- 24
#********CHANGE********Number of the last column you want to run. 
Last <- 60
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIdtifa[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + dmri_dtifa_fiberat_allfibers + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIdtifa)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neuro_dtifa <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neuro_dtifa) <- c("Variable", "Beta", "STE", "Pval")
Results_Neuro_dtifa$FDR <- p.adjust(Results_Neuro_dtifa$Pval, method = "fdr")
Results_Neuro_dtifa$Bonferroni <- p.adjust(Results_Neuro_dtifa$Pval, method = "bonferroni")
fwrite(Results_Neuro_dtifa, file = "Results_Neurodev_MRIdtifa_10.28.22.txt", sep = "\t")


## Internalizing PRS
First <- 24
#********CHANGE********Number of the last column you want to run. 
Last <- 60
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIdtifa[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + dmri_dtifa_fiberat_allfibers + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIdtifa)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Internal_dtifa <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Internal_dtifa) <- c("Variable", "Beta", "STE", "Pval")
Results_Internal_dtifa$FDR <- p.adjust(Results_Internal_dtifa$Pval, method = "fdr")
Results_Internal_dtifa$Bonferroni <- p.adjust(Results_Internal_dtifa$Pval, method = "bonferroni")
fwrite(Results_Internal_dtifa, file = "Results_Internalizing_MRIdtifa_10.28.22.txt", sep = "\t")

detach(MRIdtifa)

```

#### MD Imaging Analyses ####
```{r}
MRIdtimd[, c(1:4, 20:21)] <- lapply(MRIdtimd[,c(1:4, 20:21)], as.factor)
MRIdtimd[, c(5:19, 22:60)] <- lapply(MRIdtimd[,c(5:19, 22:60)], as.numeric)

MRIdtimd <- MRIdtimd %>%
  mutate_if(is.numeric, scale)

MRIdtimd[MRIdtimd == "NA"] <- NA

attach(MRIdtimd)

## Compulsive PRS
First <- 24
#********CHANGE********Number of the last column you want to run. 
Last <- 60
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIdtimd[,i] ~ Compulsive_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + dmri_dtifa_fiberat_allfibers + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIdtimd)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Comp_dtimd <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Comp_dtimd) <- c("Variable", "Beta", "STE", "Pval")
Results_Comp_dtimd$FDR <- p.adjust(Results_Comp_dtimd$Pval, method = "fdr")
Results_Comp_dtimd$Bonferroni <- p.adjust(Results_Comp_dtimd$Pval, method = "bonferroni")
fwrite(Results_Comp_dtimd, file = "Results_Compulsive_MRIdtimd_10.28.22.txt", sep = "\t")


## Psychotic PRS
First <- 24
#********CHANGE********Number of the last column you want to run. 
Last <- 60
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIdtimd[,i] ~ Psychotic_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + dmri_dtifa_fiberat_allfibers + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIdtimd)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Psych_dtimd <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Psych_dtimd) <- c("Variable", "Beta", "STE", "Pval")
Results_Psych_dtimd$FDR <- p.adjust(Results_Psych_dtimd$Pval, method = "fdr")
Results_Psych_dtimd$Bonferroni <- p.adjust(Results_Psych_dtimd$Pval, method = "bonferroni")
fwrite(Results_Psych_dtimd, file = "Results_Psychotic_MRIdtimd_10.28.22.txt", sep = "\t")


## Neurodev PRS
First <- 24
#********CHANGE********Number of the last column you want to run. 
Last <- 60
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIdtimd[,i] ~ Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + dmri_dtifa_fiberat_allfibers + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIdtimd)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neuro_dtimd <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neuro_dtimd) <- c("Variable", "Beta", "STE", "Pval")
Results_Neuro_dtimd$FDR <- p.adjust(Results_Neuro_dtimd$Pval, method = "fdr")
Results_Neuro_dtimd$Bonferroni <- p.adjust(Results_Neuro_dtimd$Pval, method = "bonferroni")
fwrite(Results_Neuro_dtimd, file = "Results_Neurodev_MRIdtimd_10.28.22.txt", sep = "\t")


## Internalizing PRS
First <- 24
#********CHANGE********Number of the last column you want to run. 
Last <- 60
#creates objects for the loop
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  #******CHANGE*******add your covariates, build your LMER
  LMEOut <- withWarnings( a <- lmer(MRIdtimd[,i] ~ Internalizing_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + dmri_dtifa_fiberat_allfibers + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(MRIdtimd)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Internal_dtimd <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Internal_dtimd) <- c("Variable", "Beta", "STE", "Pval")
Results_Internal_dtimd$FDR <- p.adjust(Results_Internal_dtimd$Pval, method = "fdr")
Results_Internal_dtimd$Bonferroni <- p.adjust(Results_Internal_dtimd$Pval, method = "bonferroni")
fwrite(Results_Internal_dtimd, file = "Results_Internalizing_MRIdtimd_10.28.22.txt", sep = "\t")

detach(MRIdtimd)

```


#### Baseline Plots
##### Compulsive PRS 
```{r}
Results <- read.csv("Compulsive_results_base_11_6.csv")
Results2 <- read.csv("Psychotic_results_base_11_6.csv")
Results3 <- read.csv("Neurodev_results_base_11_6.csv")
Results4 <- read.csv("Internalizing_results_base_11_6.csv")

mycols <- c("darkorange1", "lightseagreen", "orchid3", "lightskyblue", "goldenrod1",  "seagreen", "pink2", "deepskyblue4")
mycols_darker <- c("darkorange1", "lightseagreen", "orchid4", "steelblue3", "goldenrod3",  "seagreen", "palevioletred", "deepskyblue4")


Results_Substance <- Results %>%
  filter(grepl('tlfb|path|isip|su_|caff|rules_|peer_dev', Variable)) %>%
  filter(!grepl('devhx', Variable)) %>%
  arrange(Variable)
Results_Substance$Category <- rep("Substance", 48)

Results_CE <- Results %>%
  filter(grepl('crpbi|fes|prosocial|school|reshist|monitor|neighborhood|enviro|pmq|psb_|nsc_|srpf', Variable)) %>%
  filter(!grepl('profess|kbi', Variable)) %>%
  arrange(Variable)
Results_CE$Category <- rep("Culture/Environment", 113)

Results_MH_y <- Results %>%
  filter(grepl('ksad|cbcl|prodrom|pps_|upps|bisbas|bis_|resiliency|kbi|gen_child|pgbi|bpm|ADHD', Variable)) %>%
  filter(!grepl('monitor|parent_rules|prosocial|fes_youth|asr_|famhx|fam_hist', Variable)) %>%
  arrange(Variable)
Results_MH_y$Category <- rep("Child Mental Health", 640)

Results_MH_p <- Results %>%
  filter(grepl('asr_|famhx|fam_hist|q1|q2|q4|q5|q6|q9', Variable)) %>%
  filter(!grepl('cbcl|ksads|bpm|parent_mon|parent_rul|fes_|prosocial', Variable)) %>%
  arrange(Variable)
Results_MH_p$Category <- rep("Family Mental Health", 239)

Results_PH <- Results %>%
  filter(grepl('medhx|devhx|tbi|pds|puber|sports|sai_|filtered_|anthro|child_|antidep_|sds_|sleep|weight|SSRI|antidep|hormon_sal|medicat', Variable)) %>%
  filter(!grepl('demo|gen_child', Variable)) %>%
  arrange(Variable)
Results_PH$Category <- rep("Physical Health", 170)

Results_NP <- Results %>%
  filter(grepl('nihtbx|RAVLT|cash|lmt|wisc', Variable)) %>%
  arrange(Variable)
Results_NP$Category <- rep("Cognition", 14)

Results_Screen <- Results %>%
  filter(grepl('screen|stq', Variable)) %>%
  arrange(Variable)
Results_Screen$Category <- rep("Screen Time", 18)

Results_Demo <- Results %>%
  filter(grepl('demo|prtnr_wor|prnt_wor', Variable)) %>%
  arrange(Variable)
Results_Demo$Category <- rep("Demographics", 27)

# binding them in this order
Results_Compulsive <- rbind(Results_NP, Results_Screen, Results_Demo, Results_Substance, Results_CE, Results_PH, Results_MH_p, Results_MH_y)
Results_Compulsive$Variable <- factor(Results_Compulsive$Variable, levels = (Results_Compulsive$Variable))
Results_Compulsive$Category <- factor(Results_Compulsive$Category, levels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health"))

Results_Compulsive$neg_log_p <- -log10(as.numeric(Results_Compulsive$Pval))
Results_Compulsive$direction <- as.factor(ifelse(Results_Compulsive$Beta > 0, 1, 0))

Results_Compulsive <- Results_Compulsive %>%
  mutate(xpos = c(seq(1,14,1), seq(24, 41, 1), seq(51,77,1), seq(87,134,1), seq(144,200,.5), seq(210,294.5,.5), seq(304.5,423.5, .5), seq(433.5,753,.5)),
         xpos2 = c(seq(1,14,1), seq(26, 43, 1), seq(55,81,1), seq(91,138,1), seq(148,260,1), seq(270,439,1),
                   seq(449,687,1), seq(697,1336))) %>%
  mutate(catlab = ifelse(xpos == 2, "Cognition",
                         ifelse(xpos == 26, "Screen Time",
                                ifelse(xpos == 59, "Demographics",
                                       ifelse(xpos == 110, "Substance",
                                              ifelse(xpos == 172, "Culture/\nEnvironment",
                                                     ifelse(xpos == 250, "Physical\nHealth",
                                                            ifelse(xpos == 370, "Family\nMental Health",
                                                                   ifelse(xpos == 590, "Child\nMental Health", "")))))))),
         catlab2 = ifelse(xpos2 == 1, "Cognition",
                         ifelse(xpos2 == 37, "Screen Time",
                                ifelse(xpos2 == 70, "Demographics",
                                       ifelse(xpos2 == 115, "Substance",
                                              ifelse(xpos2 == 206, "Culture/\nEnvironment",
                                                     ifelse(xpos2 == 352, "Physical\nHealth",
                                                            ifelse(xpos2 == 577, "Family\nMental Health",
                                                                   ifelse(xpos2 == 1010, "Child\nMental Health", "")))))))))

Results_Compulsive <- Results_Compulsive %>%
  mutate(xlabs = ifelse(Category == "Cognition", "darkorange1",
                 ifelse(Category == "Screen Time", "lightseagreen",
                        ifelse(Category == "Demographics", "orchid3",
                               ifelse(Category == "Substance", "lightskyblue",
                                      ifelse(Category == "Culture/Environment", "goldenrod1", 
                                             ifelse(Category == "Physical Health", "seagreen",
                                                    ifelse(Category == "Family Mental Health", "pink2",
                                                           ifelse(Category == "Child Mental Health", "deepskyblue4", "")))))))))


Compulsive_Plot_Finala <- ggplot(Results_Compulsive, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(Category), shape = direction), size = 2) + 
  scale_color_manual(values = mycols, labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Category", size="Effect Size", x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(FDR < 0.05, as.character(Variable), "")), 
                  aes(label=label), size=3, box.padding = unit(0.4, "lines")) + 
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/1269), color = "coral3", linetype = 'dashed', size = .5) +
  guides(shape = "none", color = "none") +
  ggtitle(label = "Compulsive Factor PRS PheWAS", subtitle = "Baseline Phenotypes") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 23)) +
  scale_x_continuous(limits = c(.5, 754), expand = c(.01, .01), labels = Results_Compulsive$catlab, breaks = Results_Compulsive$xpos) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, margin = margin(t = 0), hjust = 1, size = 6, colour = Results_Compulsive$xlabs), 
        axis.ticks=element_blank(),
        plot.title = element_text(size = 11, hjust = .5, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = .5),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.1, 'cm'),
        legend.box.margin = margin(0,0,0,-10)) 
ggsave(Compulsive_Plot_Finala, file = "Compulsive_Plot_Finala.png", height = 4, width = 5)

Compulsive_Plot_Finalb <- ggplot(Results_Compulsive, aes(x=xpos2, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(Category), shape = direction), size = 2) + 
  scale_color_manual(values = mycols, labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Category", size="Effect Size", x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(FDR < 0.05, as.character(Variable), "")), 
                  aes(label=label), size=3, box.padding = unit(0.4, "lines")) + 
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/1269), color = "coral3", linetype = 'dashed', size = .5) +
  guides(shape = "none", color = "none") +
  ggtitle(label = "Compulsive Factor PRS PheWAS", subtitle = "Baseline Phenotypes") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 23)) +
  scale_x_continuous(limits = c(1,1336), expand = c(.01, .01), labels = Results_Compulsive$catlab2, breaks = Results_Compulsive$xpos2) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, margin = margin(t = 0), hjust = 1, size = 6, colour = Results_Compulsive$xlabs, family = "Arial"), 
        axis.ticks=element_blank(),
        plot.title = element_text(size = 11, hjust = .5, face = "bold", family = "Arial"),
        plot.subtitle = element_text(size = 10, hjust = .5, family = "Arial"),
        legend.title = element_blank(),
        legend.text = element_text(size = 8, family = "Arial"),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.1, 'cm'),
        legend.box.margin = margin(0,0,0,-10)) 
ggsave(Compulsive_Plot_Finalb, file = "Compulsive_Plot_Finalb.png", height = 4, width = 6)
```

##### Psychotic PRS 
```{r}
Results2_Substance <- Results2 %>%
  filter(grepl('tlfb|path|isip|su_|caff|rules_|peer_dev', Variable)) %>%
  filter(!grepl('devhx', Variable)) %>%
  arrange(Variable)
Results2_Substance$Category <- rep("Substance", 48)

Results2_CE <- Results2 %>%
  filter(grepl('crpbi|fes|prosocial|school|reshist|monitor|neighborhood|enviro|pmq|psb_|nsc_|srpf', Variable)) %>%
  filter(!grepl('profess|kbi', Variable)) %>%
  arrange(Variable)
Results2_CE$Category <- rep("Culture/Environment", 113)

Results2_MH_y <- Results2 %>%
  filter(grepl('ksad|cbcl|prodrom|pps_|upps|bisbas|bis_|resiliency|kbi|gen_child|pgbi|bpm|ADHD', Variable)) %>%
  filter(!grepl('monitor|parent_rules|prosocial|fes_youth|asr_|famhx|fam_hist', Variable)) %>%
  arrange(Variable)
Results2_MH_y$Category <- rep("Child Mental Health", 640)

Results2_MH_p <- Results2 %>%
  filter(grepl('asr_|famhx|fam_hist|q1|q2|q4|q5|q6|q9', Variable)) %>%
  filter(!grepl('cbcl|ksads|bpm|parent_mon|parent_rul|fes_|prosocial', Variable)) %>%
  arrange(Variable)
Results2_MH_p$Category <- rep("Family Mental Health", 239)

Results2_PH <- Results2 %>%
  filter(grepl('medhx|devhx|tbi|pds|puber|sports|sai_|filtered_|anthro|child_|antidep_|sds_|sleep|weight|SSRI|antidep|hormon_sal|medicat', Variable)) %>%
  filter(!grepl('demo|gen_child', Variable)) %>%
  arrange(Variable)
Results2_PH$Category <- rep("Physical Health", 170)

Results2_NP <- Results2 %>%
  filter(grepl('nihtbx|RAVLT|cash|lmt|wisc', Variable)) %>%
  arrange(Variable)
Results2_NP$Category <- rep("Cognition", 14)

Results2_Screen <- Results2 %>%
  filter(grepl('screen|stq', Variable)) %>%
  arrange(Variable)
Results2_Screen$Category <- rep("Screen Time", 18)

Results2_Demo <- Results2 %>%
  filter(grepl('demo|prtnr_wor|prnt_wor', Variable)) %>%
  arrange(Variable)
Results2_Demo$Category <- rep("Demographics", 27)

# binding them in this order
Results2_Psychotic <- rbind(Results2_NP, Results2_Screen, Results2_Demo, Results2_Substance, Results2_CE, Results2_PH, Results2_MH_p, Results2_MH_y)
Results2_Psychotic$Variable <- factor(Results2_Psychotic$Variable, levels = (Results2_Psychotic$Variable))
Results2_Psychotic$Category <- factor(Results2_Psychotic$Category, levels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health"))

Results2_Psychotic$neg_log_p <- -log10(as.numeric(Results2_Psychotic$Pval))
Results2_Psychotic$direction <- as.factor(ifelse(Results2_Psychotic$Beta > 0, 1, 0))

Results2_Psychotic <- Results2_Psychotic %>%
  mutate(xpos = c(seq(1,14,1), seq(24, 41, 1), seq(51,77,1), seq(87,134,1), seq(144,200,.5), seq(210,294.5,.5), seq(304.5,423.5, .5), seq(433.5,753,.5)),
         xpos2 = c(seq(1,14,1), seq(26, 43, 1), seq(55,81,1), seq(91,138,1), seq(148,260,1), seq(270,439,1),
                   seq(449,687,1), seq(697,1336))) %>%
  mutate(catlab = ifelse(xpos == 2, "Cognition",
                         ifelse(xpos == 26, "Screen Time",
                                ifelse(xpos == 59, "Demographics",
                                       ifelse(xpos == 110, "Substance",
                                              ifelse(xpos == 172, "Culture/\nEnvironment",
                                                     ifelse(xpos == 250, "Physical\nHealth",
                                                            ifelse(xpos == 370, "Family\nMental Health",
                                                                   ifelse(xpos == 590, "Child\nMental Health", "")))))))),
         catlab2 = ifelse(xpos2 == 1, "Cognition",
                         ifelse(xpos2 == 37, "Screen Time",
                                ifelse(xpos2 == 70, "Demographics",
                                       ifelse(xpos2 == 115, "Substance",
                                              ifelse(xpos2 == 206, "Culture/\nEnvironment",
                                                     ifelse(xpos2 == 352, "Physical\nHealth",
                                                            ifelse(xpos2 == 577, "Family\nMental Health",
                                                                   ifelse(xpos2 == 1010, "Child\nMental Health", "")))))))))


Results2_Psychotic <- Results2_Psychotic %>%
  mutate(xlabs = ifelse(Category == "Cognition", "darkorange1",
                 ifelse(Category == "Screen Time", "lightseagreen",
                        ifelse(Category == "Demographics", "orchid3",
                               ifelse(Category == "Substance", "lightskyblue",
                                      ifelse(Category == "Culture/Environment", "goldenrod1", 
                                             ifelse(Category == "Physical Health", "seagreen",
                                                    ifelse(Category == "Family Mental Health", "pink2",
                                                           ifelse(Category == "Child Mental Health", "deepskyblue4", "")))))))))


Psychotic_Plot_Finala <- ggplot(Results2_Psychotic, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(Category), shape = direction), size = 2) + 
  scale_color_manual(values = mycols, labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Category", size="Effect Size", x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(FDR < 0.05, as.character(Variable), "")), 
                  aes(label=label), size=3, box.padding = unit(0.4, "lines")) + 
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/1269), color = "coral3", linetype = 'dashed', size = .5) +
  guides(shape = "none", color = "none") +
  ggtitle(label = "Psychotic Factor PRS PheWAS", subtitle = "Baseline Phenotypes") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 23)) +
  scale_x_continuous(limits = c(.5, 754), expand = c(.01, .01), labels = Results2_Psychotic$catlab, breaks = Results2_Psychotic$xpos) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, margin = margin(t = 0), hjust = 1, size = 6, colour = Results2_Psychotic$xlabs), 
        axis.ticks=element_blank(),
        plot.title = element_text(size = 11, hjust = .5, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = .5),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.1, 'cm'),
        legend.box.margin = margin(0,0,0,-10)) 
ggsave(Psychotic_Plot_Finala, file = "Psychotic_Plot_Finala.png", height = 4, width = 5)

Psychotic_Plot_Finalb <- ggplot(Results2_Psychotic, aes(x=xpos2, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(Category), shape = direction), size = 2) + 
  scale_color_manual(values = mycols, labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Category", size="Effect Size", x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(FDR < 0.05, as.character(Variable), "")), 
                  aes(label=label), size=3, box.padding = unit(0.4, "lines")) + 
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/1269), color = "coral3", linetype = 'dashed', size = .5) +
  guides(shape = "none", color = "none") +
  ggtitle(label = "Psychotic Factor PRS PheWAS", subtitle = "Baseline Phenotypes") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 23)) +
  scale_x_continuous(limits = c(1, 1336), expand = c(.01, .01), labels = Results2_Psychotic$catlab2, breaks = Results2_Psychotic$xpos2) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, margin = margin(t = 0), hjust = 1, size = 6, colour = Results2_Psychotic$xlabs), 
        axis.ticks=element_blank(),
        plot.title = element_text(size = 11, hjust = .5, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = .5),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.1, 'cm'),
        legend.box.margin = margin(0,0,0,-10)) 
ggsave(Psychotic_Plot_Finalb, file = "Psychotic_Plot_Finalb.png", height = 4, width = 6)
```


##### Neurodev PRS 
```{r}
Results3_Substance <- Results3 %>%
  filter(grepl('tlfb|path|isip|su_|caff|rules_|peer_dev', Variable)) %>%
  filter(!grepl('devhx', Variable)) %>%
  arrange(Variable)
Results3_Substance$Category <- rep("Substance", 48)

Results3_CE <- Results3 %>%
  filter(grepl('crpbi|fes|prosocial|school|reshist|monitor|neighborhood|enviro|pmq|psb_|nsc_|srpf', Variable)) %>%
  filter(!grepl('profess|kbi', Variable)) %>%
  arrange(Variable)
Results3_CE$Category <- rep("Culture/Environment", 113)

Results3_MH_y <- Results3 %>%
  filter(grepl('ksad|cbcl|prodrom|pps_|upps|bisbas|bis_|resiliency|kbi|gen_child|pgbi|bpm|ADHD', Variable)) %>%
  filter(!grepl('monitor|parent_rules|prosocial|fes_youth|asr_|famhx|fam_hist', Variable)) %>%
  arrange(Variable)
Results3_MH_y$Category <- rep("Child Mental Health", 640)

Results3_MH_p <- Results3 %>%
  filter(grepl('asr_|famhx|fam_hist|q1|q2|q4|q5|q6|q9', Variable)) %>%
  filter(!grepl('cbcl|ksads|bpm|parent_mon|parent_rul|fes_|prosocial', Variable)) %>%
  arrange(Variable)
Results3_MH_p$Category <- rep("Family Mental Health", 239)

Results3_PH <- Results3 %>%
  filter(grepl('medhx|devhx|tbi|pds|puber|sports|sai_|filtered_|anthro|child_|antidep_|sds_|sleep|weight|SSRI|antidep|hormon_sal|medicat', Variable)) %>%
  filter(!grepl('demo|gen_child', Variable)) %>%
  arrange(Variable)
Results3_PH$Category <- rep("Physical Health", 170)

Results3_NP <- Results3 %>%
  filter(grepl('nihtbx|RAVLT|cash|lmt|wisc', Variable)) %>%
  arrange(Variable)
Results3_NP$Category <- rep("Cognition", 14)

Results3_Screen <- Results3 %>%
  filter(grepl('screen|stq', Variable)) %>%
  arrange(Variable)
Results3_Screen$Category <- rep("Screen Time", 18)

Results3_Demo <- Results3 %>%
  filter(grepl('demo|prtnr_wor|prnt_wor', Variable)) %>%
  arrange(Variable)
Results3_Demo$Category <- rep("Demographics", 27)

# binding them in this order
Results3_Neurodev <- rbind(Results3_NP, Results3_Screen, Results3_Demo, Results3_Substance, Results3_CE, Results3_PH, Results3_MH_p, Results3_MH_y)
Results3_Neurodev$Variable <- factor(Results3_Neurodev$Variable, levels = (Results3_Neurodev$Variable))
Results3_Neurodev$Category <- factor(Results3_Neurodev$Category, levels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health"))

Results3_Neurodev_Rename <- Results3_Neurodev
Results3_Neurodev_Rename$Variable <- as.character(Results3_Neurodev_Rename$Variable)
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "cbcl_scr_dsm5_adhd_r", "Variable"] <- "CBCL-ADHD"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "cbcl_scr_syn_attention_r", "Variable"] <- "CBCL-Attention"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "cbcl_q78_p", "Variable"] <- "CBCL-78-Inattentive"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "cbcl_scr_syn_totprob_r", "Variable"] <- "CBCL-Total-Problems"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "ksads_14_425_p", "Variable"] <- "KSADS-P-ADHD-425"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "cbcl_scr_syn_rulebreak_r", "Variable"] <- "CBCL-Rulebreak"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "cbcl_scr_syn_external_r", "Variable"] <- "CBCL-External"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "ksads_14_411_p", "Variable"] <- "KSADS-P-ADHD-411"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "ksads_14_413_p", "Variable"] <- "KSADS-P-ADHD-413"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "cbcl_q41_p", "Variable"] <- "CBCL-41-Impulsive"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "ksads_14_412_p", "Variable"] <- "KSADS-P-ADHD-412"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "ksads_14_415_p", "Variable"] <- "KSADS-P-ADHD-415"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "cbcl_scr_dsm5_conduct_r", "Variable"] <- "CBCL-Conduct"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "stq_y_ss_weekend", "Variable"] <- "Wknd-Screentime"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "stq_y_ss_weekday", "Variable"] <- "Wkdy-Screentime"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "cbcl_scr_syn_aggressive_r", "Variable"] <- "CBCL-Aggressive"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "cbcl_q08_p", "Variable"] <- "CBCL-8-Concentrate"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "ksads_14_416_p", "Variable"] <- "KSADS-P-ADHD-416"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "ksads_14_417_p", "Variable"] <- "KSADS-P-ADHD-417"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "cbcl_q28_p", "Variable"] <- "CBCL-28-Breaks-Rules"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "ksads_14_79_p", "Variable"] <- "KSADS-P-ADHD-79"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "ksads_14_78_p", "Variable"] <- "KSADS-P-ADHD-78"
Results3_Neurodev_Rename[Results3_Neurodev_Rename$Variable == "cbcl_scr_dsm5_opposit_r", "Variable"] <- "CBCL-Oppositional"

Results3_Neurodev_Rename$Variable <- factor(Results3_Neurodev_Rename$Variable, levels = Results3_Neurodev_Rename$Variable)

Results3_Neurodev_Rename$neg_log_p <- -log10(as.numeric(Results3_Neurodev_Rename$Pval))
Results3_Neurodev_Rename$direction <- as.factor(ifelse(Results3_Neurodev_Rename$Beta > 0, 1, 0))

Results3_Neurodev_Rename <- Results3_Neurodev_Rename %>%
  mutate(xpos = c(seq(1,14,1), seq(24, 41, 1), seq(51,77,1), seq(87,134,1), seq(144,200,.5), seq(210,294.5,.5), seq(304.5,423.5, .5), seq(433.5,753,.5)),
         xpos2 = c(seq(1,14,1), seq(26, 43, 1), seq(55,81,1), seq(91,138,1), seq(148,260,1), seq(270,439,1),
                   seq(449,687,1), seq(697,1336))) %>%
  mutate(catlab = ifelse(xpos == 2, "Cognition",
                         ifelse(xpos == 26, "Screen Time",
                                ifelse(xpos == 59, "Demographics",
                                       ifelse(xpos == 110, "Substance",
                                              ifelse(xpos == 172, "Culture/\nEnvironment",
                                                     ifelse(xpos == 250, "Physical\nHealth",
                                                            ifelse(xpos == 370, "Family\nMental Health",
                                                                   ifelse(xpos == 590, "Child\nMental Health", "")))))))),
         catlab2 = ifelse(xpos2 == 1, "Cognition",
                         ifelse(xpos2 == 37, "Screen Time",
                                ifelse(xpos2 == 70, "Demographics",
                                       ifelse(xpos2 == 115, "Substance",
                                              ifelse(xpos2 == 206, "Culture/\nEnvironment",
                                                     ifelse(xpos2 == 352, "Physical\nHealth",
                                                            ifelse(xpos2 == 577, "Family\nMental Health",
                                                                   ifelse(xpos2 == 1010, "Child\nMental Health", "")))))))))

Results3_Neurodev_Rename <- Results3_Neurodev_Rename %>%
  mutate(xlabs = ifelse(Category == "Cognition", "darkorange1",
                 ifelse(Category == "Screen Time", "lightseagreen",
                        ifelse(Category == "Demographics", "orchid3",
                               ifelse(Category == "Substance", "lightskyblue",
                                      ifelse(Category == "Culture/Environment", "goldenrod1", 
                                             ifelse(Category == "Physical Health", "seagreen",
                                                    ifelse(Category == "Family Mental Health", "pink2",
                                                           ifelse(Category == "Child Mental Health", "deepskyblue4", "")))))))))

options(ggrepel.max.overlaps = Inf)

Neurodev_Plot_Finala <- ggplot(Results3_Neurodev_Rename, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(Category), shape = direction), size = 2) + 
  scale_color_manual(values = mycols, labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Category", size="Effect Size", x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(Pval < 5e-14, as.character(Variable), "")), 
                  aes(label=label, color = Category), size=1.5,  box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2) + 
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/1269), color = "coral3", linetype = 'dashed', size = .5) +
  guides(shape = "none", color = "none") +
  ggtitle(label = "Neurodevelopmental Factor PRS PheWAS", subtitle = "Baseline Phenotypes") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 23)) +
  scale_x_continuous(limits = c(.5, 754), expand = c(.01, .01), labels = Results3_Neurodev_Rename$catlab, breaks = Results3_Neurodev_Rename$xpos) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, margin = margin(t = 0), hjust = 1, size = 6, colour = Results3_Neurodev_Rename$xlabs), 
        axis.ticks=element_blank(),
        plot.title = element_text(size = 11, hjust = .5, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = .5),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.1, 'cm'),
        legend.box.margin = margin(0,0,0,-10)) 
ggsave(Neurodev_Plot_Finala, file = "Neurodev_Plot_Finala.png", height = 4, width = 5)

Neurodev_Plot_Finalb <- ggplot(Results3_Neurodev_Rename, aes(x=xpos2, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(Category), shape = direction), size = 2) + 
  scale_color_manual(values = mycols, labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Category", size="Effect Size", x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(Pval < 1.5e-12, as.character(Variable), "")), 
                  aes(label=label, color = Category), size=1.5,  box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2) + 
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/1269), color = "coral3", linetype = 'dashed', size = .5) +
  guides(shape = "none", color = "none") +
  ggtitle(label = "Neurodevelopmental Factor PRS PheWAS", subtitle = "Baseline Phenotypes") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 23)) +
  scale_x_continuous(limits = c(1, 1336), expand = c(.01, .01), labels = Results3_Neurodev_Rename$catlab2, breaks = Results3_Neurodev_Rename$xpos2) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, margin = margin(t = 0), hjust = 1, size = 6, colour = Results3_Neurodev_Rename$xlabs), 
        axis.ticks=element_blank(),
        plot.title = element_text(size = 11, hjust = .5, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = .5),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.1, 'cm'),
        legend.box.margin = margin(0,0,0,-10)) 
ggsave(Neurodev_Plot_Finalb, file = "Neurodev_Plot_Finalb.png", height = 4, width = 6)
```

##### Internalizing PRS 
```{r}
Results4_Substance <- Results4 %>%
  filter(grepl('tlfb|path|isip|su_|caff|rules_|peer_dev', Variable)) %>%
  filter(!grepl('devhx', Variable)) %>%
  arrange(Variable)
Results4_Substance$Category <- rep("Substance", 48)

Results4_CE <- Results4 %>%
  filter(grepl('crpbi|fes|prosocial|school|reshist|monitor|neighborhood|enviro|pmq|psb_|nsc_|srpf', Variable)) %>%
  filter(!grepl('profess|kbi', Variable)) %>%
  arrange(Variable)
Results4_CE$Category <- rep("Culture/Environment", 113)

Results4_MH_y <- Results4 %>%
  filter(grepl('ksad|cbcl|prodrom|pps_|upps|bisbas|bis_|resiliency|kbi|gen_child|pgbi|bpm|ADHD', Variable)) %>%
  filter(!grepl('monitor|parent_rules|prosocial|fes_youth|asr_|famhx|fam_hist', Variable)) %>%
  arrange(Variable)
Results4_MH_y$Category <- rep("Child Mental Health", 640)

Results4_MH_p <- Results4 %>%
  filter(grepl('asr_|famhx|fam_hist|q1|q2|q4|q5|q6|q9', Variable)) %>%
  filter(!grepl('cbcl|ksads|bpm|parent_mon|parent_rul|fes_|prosocial', Variable)) %>%
  arrange(Variable)
Results4_MH_p$Category <- rep("Family Mental Health", 239)

Results4_PH <- Results4 %>%
  filter(grepl('medhx|devhx|tbi|pds|puber|sports|sai_|filtered_|anthro|child_|antidep_|sds_|sleep|weight|SSRI|antidep|hormon_sal|medicat', Variable)) %>%
  filter(!grepl('demo|gen_child', Variable)) %>%
  arrange(Variable)
Results4_PH$Category <- rep("Physical Health", 170)

Results4_NP <- Results4 %>%
  filter(grepl('nihtbx|RAVLT|cash|lmt|wisc', Variable)) %>%
  arrange(Variable)
Results4_NP$Category <- rep("Cognition", 14)

Results4_Screen <- Results4 %>%
  filter(grepl('screen|stq', Variable)) %>%
  arrange(Variable)
Results4_Screen$Category <- rep("Screen Time", 18)

Results4_Demo <- Results4 %>%
  filter(grepl('demo|prtnr_wor|prnt_wor', Variable)) %>%
  arrange(Variable)
Results4_Demo$Category <- rep("Demographics", 27)

# binding them in this order
Results4_Internal <- rbind(Results4_NP, Results4_Screen, Results4_Demo, Results4_Substance, Results4_CE, Results4_PH, Results4_MH_p, Results4_MH_y)
Results4_Internal$Variable <- factor(Results4_Internal$Variable, levels = (Results4_Internal$Variable))
Results4_Internal$Category <- factor(Results4_Internal$Category, levels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health"))

Results4_Internal_Rename <- Results4_Internal
Results4_Internal_Rename$Variable <- as.character(Results4_Internal_Rename$Variable)
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_scr_syn_totprob_r", "Variable"] <- "CBCL-Total-Problems"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "famhx_ss_moth_prob_dprs_p", "Variable"] <- "FamHx-Mom-Prob-Dprs"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_scr_dsm5_depress_r", "Variable"] <- "CBCL-Dprs"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_q03_p", "Variable"] <- "CBCL-3-Argue"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_scr_syn_somatic_r", "Variable"] <- "CBCL-Somatic"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "sds_p_ss_dims", "Variable"] <- "SDS-Sleep-Disord-DIMS"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "famhx_ss_momdad_dg_p", "Variable"] <- "FamHx-Parent-Prob-Drugs"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "pps_y_ss_severity_score", "Variable"] <- "PPS-SS-Severity"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_scr_syn_internal_r", "Variable"] <- "CBCL-Internal"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_scr_syn_external_r", "Variable"] <- "CBCL-External"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "pps_y_ss_bother_sum", "Variable"] <- "PPS-SS-Bother-Sum"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_scr_dsm5_opposit_r", "Variable"] <- "CBCL-Oppositional"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_scr_07_stress_r", "Variable"] <- "CBCL-Stress-Scale"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "sds_p_ss_total", "Variable"] <- "SDS-Sleep-Disord-Total"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_scr_dsm5_somaticpr_r", "Variable"] <- "CBCL-Somatic(DSM)"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "famhx_ss_fath_prob_dprs_p", "Variable"] <- "FamHx-Dad-Prob-Dprs"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "su_caff_max_calc", "Variable"] <- "Caffeine-Max"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_scr_syn_rulebreak_r", "Variable"] <- "CBCL-Rulebreak"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_scr_syn_aggressive_r", "Variable"] <- "CBCL-Aggressive"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "pps_y_ss_number", "Variable"] <- "PPS-SS-Number"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_scr_dsm5_conduct_r", "Variable"] <- "CBCL-Conduct"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "ksads_23_957_p", "Variable"] <- "KSADS-P-Suicidal-957"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "ksads_23_146_p", "Variable"] <- "KSADS-P-Suicidal-146"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "famhx_ss_momdad_nrv_p", "Variable"] <- "FamHx-Parent-Prob-Anxiety"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "cbcl_scr_dsm5_anxdisord_r", "Variable"] <- "CBCL-Anxiety-Disord"
Results4_Internal_Rename[Results4_Internal_Rename$Variable == "prodromal_20_y", "Variable"] <- "PPS-See-Things"

Results4_Internal_Rename$Variable <- factor(Results4_Internal_Rename$Variable, levels = Results4_Internal_Rename$Variable)

Results4_Internal_Rename$neg_log_p <- -log10(as.numeric(Results4_Internal_Rename$Pval))
Results4_Internal_Rename$direction <- as.factor(ifelse(Results4_Internal_Rename$Beta > 0, 1, 0))


Results4_Internal_Rename <- Results4_Internal_Rename %>%
  mutate(xpos = c(seq(1,14,1), seq(24, 41, 1), seq(51,77,1), seq(87,134,1), seq(144,200,.5), seq(210,294.5,.5), seq(304.5,423.5, .5), seq(433.5,753,.5)),
         xpos2 = c(seq(1,14,1), seq(26, 43, 1), seq(55,81,1), seq(91,138,1), seq(148,260,1), seq(270,439,1),
                   seq(449,687,1), seq(697,1336))) %>%
  mutate(catlab = ifelse(xpos == 2, "Cognition",
                         ifelse(xpos == 26, "Screen Time",
                                ifelse(xpos == 59, "Demographics",
                                       ifelse(xpos == 110, "Substance",
                                              ifelse(xpos == 172, "Culture/\nEnvironment",
                                                     ifelse(xpos == 250, "Physical\nHealth",
                                                            ifelse(xpos == 370, "Family\nMental Health",
                                                                   ifelse(xpos == 590, "Child\nMental Health", "")))))))),
         catlab2 = ifelse(xpos2 == 1, "Cognition",
                         ifelse(xpos2 == 37, "Screen Time",
                                ifelse(xpos2 == 70, "Demographics",
                                       ifelse(xpos2 == 115, "Substance",
                                              ifelse(xpos2 == 206, "Culture/\nEnvironment",
                                                     ifelse(xpos2 == 352, "Physical\nHealth",
                                                            ifelse(xpos2 == 577, "Family\nMental Health",
                                                                   ifelse(xpos2 == 1010, "Child\nMental Health", "")))))))))

Results4_Internal_Rename <- Results4_Internal_Rename %>%
  mutate(xlabs = ifelse(Category == "Cognition", "darkorange1",
                 ifelse(Category == "Screen Time", "lightseagreen",
                        ifelse(Category == "Demographics", "orchid3",
                               ifelse(Category == "Substance", "lightskyblue",
                                      ifelse(Category == "Culture/Environment", "goldenrod1", 
                                             ifelse(Category == "Physical Health", "seagreen",
                                                    ifelse(Category == "Family Mental Health", "pink2",
                                                           ifelse(Category == "Child Mental Health", "deepskyblue4", "")))))))))

options(ggrepel.max.overlaps = Inf)

Internal_Plot_Finala <- ggplot(Results4_Internal_Rename, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(Category), shape = direction), size = 2) + 
  scale_color_manual(values = mycols, labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Category", size="Effect Size", x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(Pval < 5e-8, as.character(Variable), "")), 
                  aes(label=label, color = Category), size=1.5,  box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2) + 
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/1269), color = "coral3", linetype = 'dashed', size = .5) +
  guides(shape = "none", color = "none") +
  ggtitle(label = "Internalizing Factor PRS PheWAS", subtitle = "Baseline Phenotypes") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 23)) +
  scale_x_continuous(limits = c(.5, 754), expand = c(.01, .01), labels = Results4_Internal_Rename$catlab, breaks = Results4_Internal_Rename$xpos) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, margin = margin(t = 0), hjust = 1, size = 6, colour = Results4_Internal_Rename$xlabs), 
        axis.ticks=element_blank(),
        plot.title = element_text(size = 11, hjust = .5, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = .5),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.1, 'cm'),
        legend.box.margin = margin(0,0,0,-10)) 
ggsave(Internal_Plot_Finala, file = "Internal_Plot_Finala.png", height = 4, width = 5)

Internal_Plot_Finalb <- ggplot(Results4_Internal_Rename, aes(x=xpos2, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(Category), shape = direction), size = 2) + 
  scale_color_manual(values = mycols, labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Category", size="Effect Size", x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(Pval < 5e-08 & Variable != "PPS-See-Things" & Variable != "KSADS-P-Suicidal-957", as.character(Variable), "")), 
                  aes(label=label, color = Category), size=1.5,  box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2) + 
  geom_text_repel(data=. %>% mutate(label = ifelse(Variable == "PPS-See-Things", as.character(Variable), "")), 
                  aes(label=label, color = Category), size=1.5, nudge_y = .4, box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2) + 
  geom_text_repel(data=. %>% mutate(label = ifelse(Variable == "KSADS-P-Suicidal-957", as.character(Variable), "")), 
                  aes(label=label, color = Category), size=1.5, nudge_x = -50, box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2) + 
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/1269), color = "coral3", linetype = 'dashed', size = .5) +
  guides(shape = "none", color = "none") +
  ggtitle(label = "Internalizing Factor PRS PheWAS", subtitle = "Baseline Phenotypes") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 23)) +
  scale_x_continuous(limits = c(1, 1336), expand = c(.01, .01), labels = Results4_Internal_Rename$catlab2, breaks = Results4_Internal_Rename$xpos2) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, margin = margin(t = 0), hjust = 1, size = 6, colour = Results4_Internal_Rename$xlabs), 
        axis.ticks=element_blank(),
        plot.title = element_text(size = 11, hjust = .5, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = .5),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.1, 'cm'),
        legend.box.margin = margin(0,0,0,-10)) 
ggsave(Internal_Plot_Finalb, file = "Internal_Plot_Finalb.png", height = 4, width = 6)
```

#### Follow-Up Plots ####
##### Compulsive PRS
```{r}
Results_FU_Substance <- ResultsFU_comp %>%
  filter(grepl('tlfb|path|isip|su_|caff|rules_|peer_dev|ascq|ptu_|meeq|phs_|aeq_', Variable)) %>%
  filter(!grepl('caff_ago|caff_24', Variable))
Results_FU_Substance$Category <- rep("Substance", 119)

Results_FU_CE <- ResultsFU_comp %>%
  filter(grepl('crpbi|fes|prosocial|school|reshist|monitor|neighborhood|enviro|pmq|ple_|cybb|pnh_|nsc_|psb_|sag_|comc|srpf_|dim_mat|dim_y|pbp_|peq', Variable)) %>%
  filter(!grepl('profess|kbi|eatq|screen|mctq', Variable))
Results_FU_CE$Category <- rep("Culture/Environment", 441)

Results_FU_MH_y <- ResultsFU_comp %>%
  filter(grepl('ksad|cbcl|prodrom|pps_|upps|bisbas|bis_|resiliency|kbi|gen_child|pgbi|bpmt|bpm|sup_|eatq_|ssrs_|poa_|ksad', Variable)) %>%
  filter(!grepl('monitor|parent_rules|prosocial|fes_youth|asr_|famhx|fam_hist|abcl|screen|dim_matrix|dim_yes', Variable))
Results_FU_MH_y$Category <- rep("Child Mental Health", 636)

Results_FU_MH_p <- ResultsFU_comp %>%
  filter(grepl('asr_|famhx|fam_hist|q1|q2|q4|q5|q6|q9|abcl', Variable)) %>%
  filter(!grepl('cbcl|ksads|bpmt|parent|fes_|prosocial|screen|dim_matrix|dim_yes', Variable))
Results_FU_MH_p$Category <- rep("Family Mental Health", 158)

Results_FU_PH <- ResultsFU_comp %>%
  filter(grepl('medhx|devhx|tbi|pds|puber|sports|sai_|filtered_|anthro|child_|antidep_|sds_|sleep|weight|SSRI|antidepressant|bkfs|mctq|gish|physical_activity|pain_last|brought|blood_pressure|pain_|menstrual|biospec|fitbit|caff_ago|caff_24', Variable)) %>%
  filter(!grepl('demo|gen_child|screen|ksad', Variable))
Results_FU_PH$Category <- rep("Physical Health", 199)

Results_FU_NP <- ResultsFU_comp %>%
  filter(grepl('nihtbx|RAVLT|lmt', Variable))
Results_FU_NP$Category <- rep("Cognition", 8)

Results_FU_Screen <- ResultsFU_comp %>%
  filter(grepl('screen|stq', Variable))
Results_FU_Screen$Category <- rep("Screen Time", 107)

Results_FU_Demo <- ResultsFU_comp %>%
  filter(grepl('demo', Variable))
Results_FU_Demo$Category <- rep("Demographics", 26)

Results_FU_Compulsive <- rbind(Results_FU_NP, Results_FU_Screen, Results_FU_Demo, Results_FU_Substance, Results_FU_CE, Results_FU_PH, Results_FU_MH_p, Results_FU_MH_y)

Results_FU_Compulsive$Variable <- factor(Results_FU_Compulsive$Variable, levels = Results_FU_Compulsive$Variable)
Results_FU_Compulsive$Category <- factor(Results_FU_Compulsive$Category, levels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health"))
Results_FU_Compulsive$Pval <- as.numeric(Results_FU_Compulsive$Pval)
Results_FU_Compulsive$neg_log_p <- -log10(Results_FU_Compulsive$Pval)
Results_FU_Compulsive$direction <- as.factor(ifelse(Results_FU_Compulsive$Beta > 0, 1, 0))

Results_FU_Compulsive <- Results_FU_Compulsive %>%
  mutate(xpos = c(seq(1,8,1), seq(20, 126, 1), seq(136,161,1), seq(171,289,1), seq(299,739,1), seq(749,947,1), seq(957,1114, 1), seq(1124,1759, 1))) %>%
  mutate(catlab = ifelse(xpos == 2, "Cognition",
                         ifelse(xpos == 80, "Screen Time",
                                ifelse(xpos == 150, "Demographics",
                                       ifelse(xpos ==235, "Substance",
                                              ifelse(xpos == 515, "Culture/\nEnvironment",
                                                     ifelse(xpos == 860, "Physical\nHealth",
                                                            ifelse(xpos == 1045, "Family\nMental Health",
                                                                   ifelse(xpos == 1450, "Child\nMental Health", "")))))))))

Results_FU_Compulsive <- Results_FU_Compulsive %>%
  mutate(xlabs = ifelse(Category == "Cognition", "darkorange1",
                 ifelse(Category == "Screen Time", "lightseagreen",
                        ifelse(Category == "Demographics", "orchid3",
                               ifelse(Category == "Substance", "lightskyblue",
                                      ifelse(Category == "Culture/Environment", "goldenrod1", 
                                             ifelse(Category == "Physical Health", "seagreen",
                                                    ifelse(Category == "Family Mental Health", "pink2",
                                                           ifelse(Category == "Child Mental Health", "deepskyblue4", "")))))))))


Compulsive_FU_Plot_Finala <- ggplot(Results_FU_Compulsive, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(Category), shape = direction), size = 2) + 
  scale_color_manual(values = mycols, labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Category", size="Effect Size", x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(Bonferroni < 0.05, as.character(Variable), "")), 
                  aes(label=label), size=3, box.padding = unit(0.4, "lines")) + 
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/1694), color = "coral3", linetype = 'dashed', size = .5) +
  guides(shape = "none", color = "none") +
  ggtitle(label = "Compulsive Factor PRS PheWAS", subtitle = "Two-Year Follow-Up Phenotypes") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 24)) +
  scale_x_continuous(limits = c(.5, 1760), expand = c(.01, .01), labels = Results_FU_Compulsive$catlab, breaks = Results_FU_Compulsive$xpos) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, margin = margin(t = 0), hjust = 1, size = 6, colour = Results_FU_Compulsive$xlabs), 
        axis.ticks=element_blank(),
        plot.title = element_text(size = 11, hjust = .5, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = .5),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.1, 'cm'),
        legend.box.margin = margin(0,0,0,-10)) 
ggsave(Compulsive_FU_Plot_Finala, file = "Compulsive_FU_Plot_Finala.png", height = 4, width = 6)

```

##### Psychotic PRS
```{r}
Results2_FU_Substance <- ResultsFU2_comp %>%
  filter(grepl('tlfb|path|isip|su_|caff|rules_|peer_dev|ascq|ptu_|meeq|phs_|aeq_', Variable)) %>%
  filter(!grepl('caff_ago|caff_24', Variable))
Results2_FU_Substance$Category <- rep("Substance", 119)

Results2_FU_CE <- ResultsFU2_comp %>%
  filter(grepl('crpbi|fes|prosocial|school|reshist|monitor|neighborhood|enviro|pmq|ple_|cybb|pnh_|nsc_|psb_|sag_|comc|srpf_|dim_mat|dim_y|pbp_|peq', Variable)) %>%
  filter(!grepl('profess|kbi|eatq|screen|mctq', Variable))
Results2_FU_CE$Category <- rep("Culture/Environment", 441)

Results2_FU_MH_y <- ResultsFU2_comp %>%
  filter(grepl('ksad|cbcl|prodrom|pps_|upps|bisbas|bis_|resiliency|kbi|gen_child|pgbi|bpmt|bpm|sup_|eatq_|ssrs_|poa_|ksad', Variable)) %>%
  filter(!grepl('monitor|parent_rules|prosocial|fes_youth|asr_|famhx|fam_hist|abcl|screen|dim_matrix|dim_yes', Variable))
Results2_FU_MH_y$Category <- rep("Child Mental Health", 636)

Results2_FU_MH_p <- ResultsFU2_comp %>%
  filter(grepl('asr_|famhx|fam_hist|q1|q2|q4|q5|q6|q9|abcl', Variable)) %>%
  filter(!grepl('cbcl|ksads|bpmt|parent|fes_|prosocial|screen|dim_matrix|dim_yes', Variable))
Results2_FU_MH_p$Category <- rep("Family Mental Health", 158)

Results2_FU_PH <- ResultsFU2_comp %>%
  filter(grepl('medhx|devhx|tbi|pds|puber|sports|sai_|filtered_|anthro|child_|antidep_|sds_|sleep|weight|SSRI|antidepressant|bkfs|mctq|gish|physical_activity|pain_last|brought|blood_pressure|pain_|menstrual|biospec|fitbit|caff_ago|caff_24', Variable)) %>%
  filter(!grepl('demo|gen_child|screen|ksad', Variable))
Results2_FU_PH$Category <- rep("Physical Health", 199)

Results2_FU_NP <- ResultsFU2_comp %>%
  filter(grepl('nihtbx|RAVLT|lmt', Variable))
Results2_FU_NP$Category <- rep("Cognition", 8)

Results2_FU_Screen <- ResultsFU2_comp %>%
  filter(grepl('screen|stq', Variable))
Results2_FU_Screen$Category <- rep("Screen Time", 107)

Results2_FU_Demo <- ResultsFU2_comp %>%
  filter(grepl('demo', Variable))
Results2_FU_Demo$Category <- rep("Demographics", 26)

Results2_FU_Psychotic <- rbind(Results2_FU_NP, Results2_FU_Screen, Results2_FU_Demo, Results2_FU_Substance, Results2_FU_CE, Results2_FU_PH, Results2_FU_MH_p, Results2_FU_MH_y)

Results2_FU_Psychotic$Variable <- factor(Results2_FU_Psychotic$Variable, levels = Results2_FU_Psychotic$Variable)
Results2_FU_Psychotic$Category <- factor(Results2_FU_Psychotic$Category, levels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health"))
Results2_FU_Psychotic$Pval <- as.numeric(Results2_FU_Psychotic$Pval)
Results2_FU_Psychotic$neg_log_p <- -log10(Results2_FU_Psychotic$Pval)
Results2_FU_Psychotic$direction <- as.factor(ifelse(Results2_FU_Psychotic$Beta > 0, 1, 0))

Results2_FU_Psychotic <- Results2_FU_Psychotic %>%
  mutate(xpos = c(seq(1,8,1), seq(20, 126, 1), seq(136,161,1), seq(171,289,1), seq(299,739,1), seq(749,947,1), seq(957,1114, 1), seq(1124,1759, 1))) %>%
  mutate(catlab = ifelse(xpos == 2, "Cognition",
                         ifelse(xpos == 80, "Screen Time",
                                ifelse(xpos == 150, "Demographics",
                                       ifelse(xpos ==235, "Substance",
                                              ifelse(xpos == 515, "Culture/\nEnvironment",
                                                     ifelse(xpos == 860, "Physical\nHealth",
                                                            ifelse(xpos == 1045, "Family\nMental Health",
                                                                   ifelse(xpos == 1450, "Child\nMental Health", "")))))))))

Results2_FU_Psychotic <- Results2_FU_Psychotic %>%
  mutate(xlabs = ifelse(Category == "Cognition", "darkorange1",
                 ifelse(Category == "Screen Time", "lightseagreen",
                        ifelse(Category == "Demographics", "orchid3",
                               ifelse(Category == "Substance", "lightskyblue",
                                      ifelse(Category == "Culture/Environment", "goldenrod1", 
                                             ifelse(Category == "Physical Health", "seagreen",
                                                    ifelse(Category == "Family Mental Health", "pink2",
                                                           ifelse(Category == "Child Mental Health", "deepskyblue4", "")))))))))

Results2_FU_Psychotic$Variable <- as.character(Results2_FU_Psychotic$Variable)
Results2_FU_Psychotic[Results2_FU_Psychotic$Variable == "srpf_y_ss_iiss", "Variable"] <- "SRPF-School-Involvement-Subscale"
Results2_FU_Psychotic$Variable <- factor(Results2_FU_Psychotic$Variable, levels = Results2_FU_Psychotic$Variable)

Psychotic_FU_Plot_Finala <- ggplot(Results2_FU_Psychotic, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(Category), shape = direction), size = 2) + 
  scale_color_manual(values = mycols, labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Category", size="Effect Size", x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(Bonferroni < 0.05, as.character(Variable), "")), 
                  aes(label=label), color = "goldenrod2", size=1.5,  nudge_y = .7, nudge_x = 50, box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2) + 
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/1694), color = "coral3", linetype = 'dashed', size = .5) +
  guides(shape = "none", color = "none") +
  ggtitle(label = "Psychotic Factor PRS PheWAS", subtitle = "Two-Year Follow-Up Phenotypes") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 24)) +
  scale_x_continuous(limits = c(.5, 1760), expand = c(.01, .01), labels = Results2_FU_Psychotic$catlab, breaks = Results2_FU_Psychotic$xpos) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, margin = margin(t = 0), hjust = 1, size = 6, colour = Results2_FU_Psychotic$xlabs), 
        axis.ticks=element_blank(),
        plot.title = element_text(size = 11, hjust = .5, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = .5),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.1, 'cm'),
        legend.box.margin = margin(0,0,0,-10)) 
ggsave(Psychotic_FU_Plot_Finala, file = "Psychotic_FU_Plot_Finala.png", height = 4, width = 6)
```

##### Neurodevelopmental PRS
```{r}
Results3_FU_Substance <- ResultsFU3_comp %>%
  filter(grepl('tlfb|path|isip|su_|caff|rules_|peer_dev|ascq|ptu_|meeq|phs_|aeq_', Variable)) %>%
  filter(!grepl('caff_ago|caff_24', Variable))
Results3_FU_Substance$Category <- rep("Substance", 119)

Results3_FU_CE <- ResultsFU3_comp %>%
  filter(grepl('crpbi|fes|prosocial|school|reshist|monitor|neighborhood|enviro|pmq|ple_|cybb|pnh_|nsc_|psb_|sag_|comc|srpf_|dim_mat|dim_y|pbp_|peq', Variable)) %>%
  filter(!grepl('profess|kbi|eatq|screen|mctq', Variable))
Results3_FU_CE$Category <- rep("Culture/Environment", 441)

Results3_FU_MH_y <- ResultsFU3_comp %>%
  filter(grepl('ksad|cbcl|prodrom|pps_|upps|bisbas|bis_|resiliency|kbi|gen_child|pgbi|bpmt|bpm|sup_|eatq_|ssrs_|poa_|ksad', Variable)) %>%
  filter(!grepl('monitor|parent_rules|prosocial|fes_youth|asr_|famhx|fam_hist|abcl|screen|dim_matrix|dim_yes', Variable))
Results3_FU_MH_y$Category <- rep("Child Mental Health", 636)

Results3_FU_MH_p <- ResultsFU3_comp %>%
  filter(grepl('asr_|famhx|fam_hist|q1|q2|q4|q5|q6|q9|abcl', Variable)) %>%
  filter(!grepl('cbcl|ksads|bpmt|parent|fes_|prosocial|screen|dim_matrix|dim_yes', Variable))
Results3_FU_MH_p$Category <- rep("Family Mental Health", 158)

Results3_FU_PH <- ResultsFU3_comp %>%
  filter(grepl('medhx|devhx|tbi|pds|puber|sports|sai_|filtered_|anthro|child_|antidep_|sds_|sleep|weight|SSRI|antidepressant|bkfs|mctq|gish|physical_activity|pain_last|brought|blood_pressure|pain_|menstrual|biospec|fitbit|caff_ago|caff_24', Variable)) %>%
  filter(!grepl('demo|gen_child|screen|ksad', Variable))
Results3_FU_PH$Category <- rep("Physical Health", 199)

Results3_FU_NP <- ResultsFU3_comp %>%
  filter(grepl('nihtbx|RAVLT|lmt', Variable))
Results3_FU_NP$Category <- rep("Cognition", 8)

Results3_FU_Screen <- ResultsFU3_comp %>%
  filter(grepl('screen|stq', Variable))
Results3_FU_Screen$Category <- rep("Screen Time", 107)

Results3_FU_Demo <- ResultsFU3_comp %>%
  filter(grepl('demo', Variable))
Results3_FU_Demo$Category <- rep("Demographics", 26)

Results3_FU_Neurodev <- rbind(Results3_FU_NP, Results3_FU_Screen, Results3_FU_Demo, Results3_FU_Substance, Results3_FU_CE, Results3_FU_PH, Results3_FU_MH_p, Results3_FU_MH_y)

Results3_FU_Neurodev$Variable <- factor(Results3_FU_Neurodev$Variable, levels = Results3_FU_Neurodev$Variable)
Results3_FU_Neurodev$Category <- factor(Results3_FU_Neurodev$Category, levels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health"))
Results3_FU_Neurodev$Pval <- as.numeric(Results3_FU_Neurodev$Pval)
Results3_FU_Neurodev$neg_log_p <- -log10(Results3_FU_Neurodev$Pval)
Results3_FU_Neurodev$direction <- as.factor(ifelse(Results3_FU_Neurodev$Beta > 0, 1, 0))

Results3_FU_Neurodev <- Results3_FU_Neurodev %>%
  mutate(xpos = c(seq(1,8,1), seq(20, 126, 1), seq(136,161,1), seq(171,289,1), seq(299,739,1), seq(749,947,1), seq(957,1114, 1), seq(1124,1759, 1))) %>%
  mutate(catlab = ifelse(xpos == 2, "Cognition",
                         ifelse(xpos == 80, "Screen Time",
                                ifelse(xpos == 150, "Demographics",
                                       ifelse(xpos ==235, "Substance",
                                              ifelse(xpos == 515, "Culture/\nEnvironment",
                                                     ifelse(xpos == 860, "Physical\nHealth",
                                                            ifelse(xpos == 1045, "Family\nMental Health",
                                                                   ifelse(xpos == 1450, "Child\nMental Health", "")))))))))

Results3_FU_Neurodev <- Results3_FU_Neurodev %>%
  mutate(xlabs = ifelse(Category == "Cognition", "darkorange1",
                 ifelse(Category == "Screen Time", "lightseagreen",
                        ifelse(Category == "Demographics", "orchid3",
                               ifelse(Category == "Substance", "lightskyblue",
                                      ifelse(Category == "Culture/Environment", "goldenrod1", 
                                             ifelse(Category == "Physical Health", "seagreen",
                                                    ifelse(Category == "Family Mental Health", "pink2",
                                                           ifelse(Category == "Child Mental Health", "deepskyblue4", "")))))))))

Results3_FU_Neurodev$Variable <- as.character(Results3_FU_Neurodev$Variable)
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_p_ss_effort_cont_sup_scale", "Variable"] <- "EATQ-SS-Effort-Ctrl"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_p_ss_attention", "Variable"] <- "EATQ-SS-Attention"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_p_ss_activation", "Variable"] <- "EATQ-SS-Activation"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_p_ss_inhibitory", "Variable"] <- "EATQ-SS-Inhibitory"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "sag_grade_type", "Variable"] <- "SAG-p-School-Grades"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_finish_p", "Variable"] <- "EATQ-Finish-Time"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "bpm_y_scr_attention_r", "Variable"] <- "BPM-y-Attention"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "cbcl_q08_p", "Variable"] <- "CBCL-8-Concentrate"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "cbcl_q61_p", "Variable"] <- "CBCL-61-SchWork"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "bpm_y_scr_totalprob_r", "Variable"] <- "BPM-y-Total-Problems"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_close_attention", "Variable"] <- "EATQ-Close-Attention"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_p_ss_aggression", "Variable"] <- "EATQ-SS-Aggression"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "bpm_4_y", "Variable"] <- "BPM-4y-Concentrate"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "cbcl_scr_dsm5_adhd_r", "Variable"] <- "CBCL-ADHD"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "cbcl_scr_syn_attention_r", "Variable"] <- "CBCL-Attention"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "upps19_y", "Variable"] <- "UPPS-19-Done-Time"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "bpm_y_scr_external_r", "Variable"] <- "BPM-y-External"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "screentime_wknd_typical_composit", "Variable"] <- "Wknd-Screentime"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "screentime_wkdy_typical_composit", "Variable"] <- "Wkdy-Screentime"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_puts_off_p", "Variable"] <- "EATQ-Puts-Off"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_concentrate_p", "Variable"] <- "EATQ-Concentrate"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_sidetracked_p", "Variable"] <- "EATQ-Sidetracked"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_p_ss_neg_affect_sup_scale", "Variable"] <- "EATQ-SS-Negative-Affect"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "upps_y_ss_lack_of_perseverance", "Variable"] <- "UPPS-SS-Lack-Persev"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "kbi_p_how_well_c_school_l", "Variable"] <- "KBI-p-How-Well-in-School"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_peripheral_p", "Variable"] <- "EATQ-Periph-Attention"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "eatq_close_attention_p", "Variable"] <- "EATQ-Close-Attention"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "srpf_y_ss_iiss", "Variable"] <- "SRPF-School-Involvement-Subscale"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "screentime_pmum_short_7_p", "Variable"] <- "Screentime_7p-Only-Media-Motivates"
Results3_FU_Neurodev[Results3_FU_Neurodev$Variable == "screentime_pmum_short_7_p", "Variable"] <- "Screentime_7p-Only-Media-Motivates"

Results3_FU_Neurodev$Variable <- factor(Results3_FU_Neurodev$Variable, levels = Results3_FU_Neurodev$Variable)
options(ggrepel.max.overlaps = Inf)

Neurodev_FU_Plot_Finala <- ggplot(Results3_FU_Neurodev, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(Category), shape = direction), size = 2) + 
  scale_color_manual(values = mycols, labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Category", size="Effect Size", x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(Pval < 8e-13 & Category!="Culture/Environment", as.character(Variable), "")), 
                  aes(label=label, colour = Category), size=1.5,  box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2) + 
  geom_text_repel(data=. %>% mutate(label = ifelse(Pval < 8e-13 & Category=="Culture/Environment", as.character(Variable), "")), 
                  aes(label=label), color = "goldenrod2", size=1.5,  box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2) + 
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/1694), color = "coral3", linetype = 'dashed', size = .5) +
  guides(shape = "none", color = "none") +
  ggtitle(label = "Neurodevelopmental Factor PRS PheWAS", subtitle = "Two-Year Follow-Up Phenotypes") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 24)) +
  scale_x_continuous(limits = c(.5, 1760), expand = c(.01, .01), labels = Results3_FU_Neurodev$catlab, breaks = Results3_FU_Neurodev$xpos) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, margin = margin(t = 0), hjust = 1, size = 6, colour = Results3_FU_Neurodev$xlabs), 
        axis.ticks=element_blank(),
        plot.title = element_text(size = 11, hjust = .5, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = .5),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.1, 'cm'),
        legend.box.margin = margin(0,0,0,-10)) 
ggsave(Neurodev_FU_Plot_Finala, file = "Neurodev_FU_Plot_Finala.png", height = 4, width = 6)
```

##### Internalizing PRS
```{r}
Results4_FU_Substance <- ResultsFU4_comp %>%
  filter(grepl('tlfb|path|isip|su_|caff|rules_|peer_dev|ascq|ptu_|meeq|phs_|aeq_', Variable)) %>%
  filter(!grepl('caff_ago|caff_24', Variable))
Results4_FU_Substance$Category <- rep("Substance", 119)

Results4_FU_CE <- ResultsFU4_comp %>%
  filter(grepl('crpbi|fes|prosocial|school|reshist|monitor|neighborhood|enviro|pmq|ple_|cybb|pnh_|nsc_|psb_|sag_|comc|srpf_|dim_mat|dim_y|pbp_|peq', Variable)) %>%
  filter(!grepl('profess|kbi|eatq|screen|mctq', Variable))
Results4_FU_CE$Category <- rep("Culture/Environment", 441)

Results4_FU_MH_y <- ResultsFU4_comp %>%
  filter(grepl('ksad|cbcl|prodrom|pps_|upps|bisbas|bis_|resiliency|kbi|gen_child|pgbi|bpmt|bpm|sup_|eatq_|ssrs_|poa_|ksad', Variable)) %>%
  filter(!grepl('monitor|parent_rules|prosocial|fes_youth|asr_|famhx|fam_hist|abcl|screen|dim_matrix|dim_yes', Variable))
Results4_FU_MH_y$Category <- rep("Child Mental Health", 636)

Results4_FU_MH_p <- ResultsFU4_comp %>%
  filter(grepl('asr_|famhx|fam_hist|q1|q2|q4|q5|q6|q9|abcl', Variable)) %>%
  filter(!grepl('cbcl|ksads|bpmt|parent|fes_|prosocial|screen|dim_matrix|dim_yes', Variable))
Results4_FU_MH_p$Category <- rep("Family Mental Health", 158)

Results4_FU_PH <- ResultsFU4_comp %>%
  filter(grepl('medhx|devhx|tbi|pds|puber|sports|sai_|filtered_|anthro|child_|antidep_|sds_|sleep|weight|SSRI|antidepressant|bkfs|mctq|gish|physical_activity|pain_last|brought|blood_pressure|pain_|menstrual|biospec|fitbit|caff_ago|caff_24', Variable)) %>%
  filter(!grepl('demo|gen_child|screen|ksad', Variable))
Results4_FU_PH$Category <- rep("Physical Health", 199)

Results4_FU_NP <- ResultsFU4_comp %>%
  filter(grepl('nihtbx|RAVLT|lmt', Variable))
Results4_FU_NP$Category <- rep("Cognition", 8)

Results4_FU_Screen <- ResultsFU4_comp %>%
  filter(grepl('screen|stq', Variable))
Results4_FU_Screen$Category <- rep("Screen Time", 107)

Results4_FU_Demo <- ResultsFU4_comp %>%
  filter(grepl('demo', Variable))
Results4_FU_Demo$Category <- rep("Demographics", 26)

Results4_FU_Internal <- rbind(Results4_FU_NP, Results4_FU_Screen, Results4_FU_Demo, Results4_FU_Substance, Results4_FU_CE, Results4_FU_PH, Results4_FU_MH_p, Results4_FU_MH_y)

Results4_FU_Internal$Variable <- factor(Results4_FU_Internal$Variable, levels = Results4_FU_Internal$Variable)
Results4_FU_Internal$Category <- factor(Results4_FU_Internal$Category, levels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health"))
Results4_FU_Internal$Pval <- as.numeric(Results4_FU_Internal$Pval)
Results4_FU_Internal$neg_log_p <- -log10(Results4_FU_Internal$Pval)
Results4_FU_Internal$direction <- as.factor(ifelse(Results4_FU_Internal$Beta > 0, 1, 0))

Results4_FU_Internal <- Results4_FU_Internal %>%
  mutate(xpos = c(seq(1,8,1), seq(20, 126, 1), seq(136,161,1), seq(171,289,1), seq(299,739,1), seq(749,947,1), seq(957,1114, 1), seq(1124,1759, 1))) %>%
  mutate(catlab = ifelse(xpos == 2, "Cognition",
                         ifelse(xpos == 80, "Screen Time",
                                ifelse(xpos == 150, "Demographics",
                                       ifelse(xpos ==235, "Substance",
                                              ifelse(xpos == 515, "Culture/\nEnvironment",
                                                     ifelse(xpos == 860, "Physical\nHealth",
                                                            ifelse(xpos == 1045, "Family\nMental Health",
                                                                   ifelse(xpos == 1450, "Child\nMental Health", "")))))))))

Results4_FU_Internal <- Results4_FU_Internal %>%
  mutate(xlabs = ifelse(Category == "Cognition", "darkorange1",
                 ifelse(Category == "Screen Time", "lightseagreen",
                        ifelse(Category == "Demographics", "orchid3",
                               ifelse(Category == "Substance", "lightskyblue",
                                      ifelse(Category == "Culture/Environment", "goldenrod1", 
                                             ifelse(Category == "Physical Health", "seagreen",
                                                    ifelse(Category == "Family Mental Health", "pink2",
                                                           ifelse(Category == "Child Mental Health", "deepskyblue4", "")))))))))

Results4_FU_Internal$Variable <- as.character(Results4_FU_Internal$Variable)
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_scr_syn_totprob_r", "Variable"] <- "CBCL-Total-Problems"
Results4_FU_Internal[Results4_FU_Internal$Variable == "bpm_y_scr_totalprob_r", "Variable"] <- "BPM-y-Total-Problems"
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_scr_syn_external_r", "Variable"] <- "CBCL-External"
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_scr_syn_internal_r", "Variable"] <- "CBCL-Internal"
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_scr_syn_aggressive_r", "Variable"] <- "CBCL-Aggressive"
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_scr_syn_thought_r", "Variable"] <- "CBCL-Thought-Problems"
Results4_FU_Internal[Results4_FU_Internal$Variable == "ple_y_ss_total_bad", "Variable"] <- "PLE-y-SS-Total-Bad"
Results4_FU_Internal[Results4_FU_Internal$Variable == "ple_y_ss_affected_bad_sum", "Variable"] <- "PLE-y-SS-Affected-Bad"
Results4_FU_Internal[Results4_FU_Internal$Variable == "eatq_p_ss_effort_cont_sup_scale", "Variable"] <- "EATQ-SS-Effort-Ctrl"
Results4_FU_Internal[Results4_FU_Internal$Variable == "eatq_p_ss_neg_affect_sup_scale", "Variable"] <- "EATQ-SS-Neg-Affect"
Results4_FU_Internal[Results4_FU_Internal$Variable == "eatq_p_ss_attention", "Variable"] <- "EATQ-SS-Attention"
Results4_FU_Internal[Results4_FU_Internal$Variable == "pps_y_ss_severity_score", "Variable"] <- "PPS-SS-Severity"
Results4_FU_Internal[Results4_FU_Internal$Variable == "prodromal_8_y", "Variable"] <- "PPS-8-Not-Trust"
Results4_FU_Internal[Results4_FU_Internal$Variable == "prodromal_2b_y", "Variable"] <- "PPS-2b-Strange-Sounds"
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_scr_07_stress_r", "Variable"] <- "CBCL-Stress-Scale"
Results4_FU_Internal[Results4_FU_Internal$Variable == "abcl_q110_p", "Variable"] <- "ABCL-110-Good-Decisions"
Results4_FU_Internal[Results4_FU_Internal$Variable == "eatq_p_ss_inhibitory", "Variable"] <- "EATQ-SS-Inhibitory"
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_scr_dsm5_depress_r", "Variable"] <- "CBCL-Dprs"
Results4_FU_Internal[Results4_FU_Internal$Variable == "ple_y_ss_total_number", "Variable"] <- "PLE-y-SS-Total-Number"
Results4_FU_Internal[Results4_FU_Internal$Variable == "sds_p_ss_total", "Variable"] <- "SDS-Sleep-Disord-Total"
Results4_FU_Internal[Results4_FU_Internal$Variable == "demo_comb_income_v2_l", "Variable"] <- "Comb Income"
Results4_FU_Internal[Results4_FU_Internal$Variable == "pps_y_ss_number", "Variable"] <- "PPS-SS-Number"
Results4_FU_Internal[Results4_FU_Internal$Variable == "pps_y_ss_bother_sum", "Variable"] <- "PPS-SS-Bother-Sum"
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_scr_dsm5_opposit_r", "Variable"] <- "CBCL-Oppositional"
Results4_FU_Internal[Results4_FU_Internal$Variable == "sds_p_ss_dims", "Variable"] <- "SDS-Sleep-Disord-DIMS"
Results4_FU_Internal[Results4_FU_Internal$Variable == "ple_y_ss_affect_sum", "Variable"] <- "PLE-y-SS-Affected-Sum"
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_q03_p", "Variable"] <- "CBCL-3-Argue"
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_scr_07_ocd_r", "Variable"] <- "CBCL-OCD-Scale"
Results4_FU_Internal[Results4_FU_Internal$Variable == "eatq_phenx_stick_to_plan_p", "Variable"] <- "EATQ-Stick-Plan"
Results4_FU_Internal[Results4_FU_Internal$Variable == "eatq_p_ss_depressive_mood", "Variable"] <- "EATQ-SS-Dprs-Mood"
Results4_FU_Internal[Results4_FU_Internal$Variable == "ple_argue_fu2_y", "Variable"] <- "PLE-y-Argue-Affected"
Results4_FU_Internal[Results4_FU_Internal$Variable == "prodromal_8b_y", "Variable"] <- "PPS-8b-Not-Trust"
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_scr_dsm5_anxdisord_r", "Variable"] <- "CBCL-Anx-Disord"
Results4_FU_Internal[Results4_FU_Internal$Variable == "eatq_p_ss_activation", "Variable"] <- "EATQ-SS-Activation"
Results4_FU_Internal[Results4_FU_Internal$Variable == "eatq_p_ss_fear", "Variable"] <- "EATQ-SS-Fear"
Results4_FU_Internal[Results4_FU_Internal$Variable == "eatq_p_ss_frustration", "Variable"] <- "EATQ-SS-Frustration"
Results4_FU_Internal[Results4_FU_Internal$Variable == "bpm_4_y", "Variable"] <- "BPM-4y-Concentrate"
Results4_FU_Internal[Results4_FU_Internal$Variable == "bpm_y_scr_internal_r", "Variable"] <- "BPM-y-Internal"
Results4_FU_Internal[Results4_FU_Internal$Variable == "bpm_y_scr_attention_r", "Variable"] <- "BPM-y-Attention"
Results4_FU_Internal[Results4_FU_Internal$Variable == "kbi_p_c_mh_sa_l", "Variable"] <- "KBI-p-MH-Services"
Results4_FU_Internal[Results4_FU_Internal$Variable == "kbipcserviceschecklistl10", "Variable"] <- "KBI-p-No-MH-Services"
Results4_FU_Internal[Results4_FU_Internal$Variable == "screentime_pmum_short_4_p", "Variable"] <- "Screentime-4p-Only-Media-Helps"
Results4_FU_Internal[Results4_FU_Internal$Variable == "srpf_y_ss_iiss", "Variable"] <- "SRPF-School-Involvement-Subscale"
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_q04_p", "Variable"] <- "CBCL-4-Fails-to-Finish"
Results4_FU_Internal[Results4_FU_Internal$Variable == "bpm_19_y", "Variable"] <- "BPM-19y-Worry"
Results4_FU_Internal[Results4_FU_Internal$Variable == "cbcl_scr_syn_rulebreak_r", "Variable"] <- "CBCL-Rulebreak"
Results4_FU_Internal[Results4_FU_Internal$Variable == "sag_grade_type", "Variable"] <- "SAG-p-School-Grades"
Results4_FU_Internal$Variable <- factor(Results4_FU_Internal$Variable, levels = Results4_FU_Internal$Variable)
options(ggrepel.max.overlaps = Inf)

Internal_FU_Plot_Finala <- ggplot(Results4_FU_Internal, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(Category), shape = direction), size = 2) + 
  scale_color_manual(values = mycols, labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Category", size="Effect Size", x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(Pval < 5e-10 & Category!="Culture/Environment" & Variable != "KBI-p-MH-Services", as.character(Variable), "")), 
                  aes(label=label, colour = Category), size=1.5,  box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2) + 
  geom_text_repel(data=. %>% mutate(label = ifelse(Pval < 5e-10 & Category=="Culture/Environment", as.character(Variable), "")), 
                  aes(label=label), color = "goldenrod2", size=1.5,  box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2) + 
  geom_text_repel(data=. %>% mutate(label = ifelse(Variable == "KBI-p-MH-Services", as.character(Variable), "")), 
                  aes(label=label, colour = Category), size=1.5,  nudge_y = -.05, nudge_x = -60, box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2) + 
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/1694), color = "coral3", linetype = 'dashed', size = .5) +
  guides(shape = "none", color = "none") +
  ggtitle(label = "Internalizing Factor PRS PheWAS", subtitle = "Two-Year Follow-Up Phenotypes") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 24)) +
  scale_x_continuous(limits = c(.5, 1760), expand = c(.01, .01), labels = Results4_FU_Internal$catlab, breaks = Results4_FU_Internal$xpos) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, margin = margin(t = 0), hjust = 1, size = 6, colour = Results4_FU_Internal$xlabs), 
        axis.ticks=element_blank(),
        plot.title = element_text(size = 11, hjust = .5, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = .5),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.1, 'cm'),
        legend.box.margin = margin(0,0,0,-10)) 
ggsave(Internal_FU_Plot_Finala, file = "Internal_FU_Plot_Finala.png", height = 4, width = 6)
```

#### Imaging Plots
```{r}
Global <- rbind(Results_Comp_global, Results_Psych_global, Results_Neuro_global, Results_Internal_global)
Global$PRS <- c(rep("Compulsive", 17), rep("Psychotic", 17), rep("Neurodevelopmental", 17), rep("Internalizing", 17))
Global$PRS <- factor(Global$PRS, levels = c("Compulsive", "Psychotic", "Neurodevelopmental", "Internalizing"))
Global$neg_log_p <- -log10(as.numeric(Global$Pval))
Global$direction <- ifelse(Global$Beta > 0, 1, 0)
Global <- Global %>%
  mutate(Variable2 = ifelse(Variable == "smri_vol_scs_suprateialv", "Supratent. Vol",
                            ifelse(Variable == "smri_vol_cdk_total", "Total Cortical Vol",
                                   ifelse(Variable == "smri_vol_cdk_totallh", "LH Cortical Vol",
                                          ifelse(Variable == "smri_vol_cdk_totalrh", "RH Cortical Vol",
                                                 ifelse(Variable == "smri_vol_scs_wholeb", "Whole Brain Vol",
                                                        ifelse(Variable == "smri_thick_cdk_meanrh", "RH Mean Thick", Variable)))))))

CortVol <- rbind(Results_Comp_CortVol, Results_Psych_CortVol, Results_Neuro_CortVol, Results_Internal_CortVol)
CortVol$PRS <- c(rep("Compulsive", 68), rep("Psychotic", 68), rep("Neurodevelopmental", 68), rep("Internalizing", 68))
CortVol$PRS <- factor(CortVol$PRS, levels = c("Compulsive", "Psychotic", "Neurodevelopmental", "Internalizing"))
CortVol$neg_log_p <- -log10(as.numeric(CortVol$Pval))
CortVol$direction <- ifelse(CortVol$Beta > 0, 1, 0)
CortVol <- CortVol %>%
  mutate(Variable2 = ifelse(Variable == "smri_vol_cdk_precnlh", "LH Precentral", Variable))

CortArea <- rbind(Results_Comp_Cortarea, Results_Psych_Cortarea, Results_Neuro_Cortarea, Results_Internal_Cortarea)
CortArea$PRS <- c(rep("Compulsive", 68), rep("Psychotic", 68), rep("Neurodevelopmental", 68), rep("Internalizing", 68))
CortArea$PRS <- factor(CortArea$PRS, levels = c("Compulsive", "Psychotic", "Neurodevelopmental", "Internalizing"))
CortArea$neg_log_p <- -log10(as.numeric(CortArea$Pval))
CortArea$direction <- ifelse(CortArea$Beta > 0, 1, 0)
CortArea <- CortArea %>%
  mutate(Variable2 = ifelse(Variable == "smri_area_cdk_precnlh", "LH Precentral", 
                            ifelse(Variable == "smri_area_cdk_trvtmrh", "RH Transverse Temporal", Variable)))

CortThick <- rbind(Results_Comp_Cortthick, Results_Psych_Cortthick, Results_Neuro_Cortthick, Results_Internal_Cortthick)
CortThick$PRS <- c(rep("Compulsive", 68), rep("Psychotic", 68), rep("Neurodevelopmental", 68), rep("Internalizing", 68))
CortThick$PRS <- factor(CortThick$PRS, levels = c("Compulsive", "Psychotic", "Neurodevelopmental", "Internalizing"))
CortThick$neg_log_p <- -log10(as.numeric(CortThick$Pval))
CortThick$direction <- ifelse(CortThick$Beta > 0, 1, 0)
CortThick <- CortThick %>%
  mutate(Variable2 = ifelse(Variable == "smri_thick_cdk_parsobisrh", "RH Pars Orbitalis", Variable))

Subcort <- rbind(Results_Comp_subcortVol, Results_Psych_subcortVol, Results_Neuro_subcortVol, Results_Internal_subcortVol)
Subcort$PRS <- c(rep("Compulsive", 35), rep("Psychotic", 35), rep("Neurodevelopmental", 35), rep("Internalizing", 35))
Subcort$PRS <- factor(Subcort$PRS, levels = c("Compulsive", "Psychotic", "Neurodevelopmental", "Internalizing"))
Subcort$neg_log_p <- -log10(as.numeric(Subcort$Pval))
Subcort$direction <- ifelse(Subcort$Beta > 0, 1, 0)
Subcort <- Subcort %>%
  mutate(Variable2 = ifelse(Variable == "smri_vol_scs_4thventricle", "4th Ventricle", 
                            ifelse(Variable == "smri_vol_scs_vedcrh", "RH Ventral DC", Variable)))

RSFC <- rbind(Results_Comp_rsfc, Results_Psych_rsfc, Results_Neuro_rsfc, Results_Internal_rsfc)
RSFC$PRS <- c(rep("Compulsive", 91), rep("Psychotic", 91), rep("Neurodevelopmental", 91), rep("Internalizing", 91))
RSFC$PRS <- factor(RSFC$PRS, levels = c("Compulsive", "Psychotic", "Neurodevelopmental", "Internalizing"))
RSFC$neg_log_p <- -log10(as.numeric(RSFC$Pval))
RSFC$direction <- ifelse(RSFC$Beta > 0, 1, 0)

DTIFA <- rbind(Results_Comp_dtifa, Results_Psych_dtifa, Results_Neuro_dtifa, Results_Internal_dtifa)
DTIFA$PRS <- c(rep("Compulsive", 37), rep("Psychotic", 37), rep("Neurodevelopmental", 37), rep("Internalizing", 37))
DTIFA$PRS <- factor(DTIFA$PRS, levels = c("Compulsive", "Psychotic", "Neurodevelopmental", "Internalizing"))
DTIFA$neg_log_p <- -log10(as.numeric(DTIFA$Pval))
DTIFA$direction <- ifelse(DTIFA$Beta > 0, 1, 0)
DTIFA <- DTIFA %>%
  mutate(Variable2 = ifelse(Variable == "dmri_dtifa_fiberat_cc", "Corpus Callosum", Variable))

DTIMD <- rbind(Results_Comp_dtimd, Results_Psych_dtimd, Results_Neuro_dtimd, Results_Internal_dtimd)
DTIMD$PRS <- c(rep("Compulsive", 37), rep("Psychotic", 37), rep("Neurodevelopmental", 37), rep("Internalizing", 37))
DTIMD$PRS <- factor(DTIMD$PRS, levels = c("Compulsive", "Psychotic", "Neurodevelopmental", "Internalizing"))
DTIMD$neg_log_p <- -log10(as.numeric(DTIMD$Pval))
DTIMD$direction <- ifelse(DTIMD$Beta > 0, 1, 0)



## Global plot
Global$xpos <- c(rep(seq(1,17,1),4))
Global$braintype <- factor(ifelse(grepl("smri", Global$Variable), "sMRI", 
                                  ifelse(grepl("dtifa", Global$Variable), "dMRI FA", "dMRI MD")),
                           levels = c("sMRI", "dMRI FA", "dMRI MD"))
Global_Final <- ggplot(Global, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(braintype), shape = as.factor(direction)), size = 2.3) + 
  scale_color_manual(values = c("steelblue", "darkorange2", "goldenrod3"), labels = c("sMRI", "dMRI FA", "dMRI MD")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Neuroimaging \nMetric", x="", y="-log(p-value)") +
  new_scale_color() +
  geom_text_repel(data=. %>% mutate(label = ifelse(Bonferroni < .05, as.character(Variable2), "")), 
                  aes(label=label, color = braintype), size=2.5,  box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2)  +
  scale_color_manual(values = c("steelblue4", "darkorange4", "goldenrod4")) +
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/17), color = "coral3", linetype = 'dashed', size = .5) +
  theme_classic() +
  guides(shape = "none", colour = "none") +
  ggtitle(label = "Associations Between PRS and Global Brain Metrics") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 4.2)) +
  ylab("-log(p-value)") +
  theme(axis.text.x = element_blank(), 
        axis.ticks=element_blank(),
        axis.title.y = element_text(size = 10, face = "bold"),
        axis.text.y = element_text(size = 8),
        plot.title = element_text(size = 12, hjust = .5, face = "bold"),
        strip.text = element_text(hjust=.5,vjust = 1,size = 8, margin = margin(b = 2, t = 2)),
        strip.background = element_rect(fill = "white", color = "black"),
        legend.title = element_text(size = 9, face = "bold", hjust = .5),
        legend.text = element_text(size = 9),
        legend.key.size = unit(.6, 'cm'),
        legend.spacing.y = unit(.001, "cm"),
        legend.box.margin = margin(0,0,0,-5)) +
  facet_wrap(~PRS) 
  
ggsave(Global_Final, file = "Global_Final_plot1.png", width = 6, height = 5)

## Cortical Volume plot
CortVol$xpos <- c(rep(seq(1,68,1),4))
CortVol$hemisphere <- factor(ifelse(grepl("lh", CortVol$Variable), "Left Hemisphere", "Right Hemisphere"),
                           levels = c("Left Hemisphere", "Right Hemisphere"))
CortVol_Final <- ggplot(CortVol, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(hemisphere), shape = as.factor(direction)), size = 2.3) + 
  scale_color_manual(values = c("deepskyblue4", "deepskyblue3"), labels = c("Left", "Right")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Hemisphere", x="", y="-log(p-value)") +
  new_scale_color() +
  geom_text_repel(data=. %>% mutate(label = ifelse(Bonferroni < .05, as.character(Variable2), "")), 
                  aes(label=label, color = hemisphere), size=2.5,  box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2)  +
  scale_color_manual(values = c("deepskyblue4", "deepskyblue3")) +
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/68), color = "coral3", linetype = 'dashed', size = .5) +
  theme_classic() +
  guides(shape = "none", colour = "none") +
  ggtitle(label = "Associations Between PRS and Cortical Volume Brain Metrics") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 4.2)) +
  ylab("-log(p-value)") +
  theme(axis.text.x = element_blank(), 
        axis.ticks=element_blank(),
        axis.title.y = element_text(size = 10, face = "bold"),
        axis.text.y = element_text(size = 8),
        plot.title = element_text(size = 12, hjust = .5, face = "bold"),
        strip.text = element_text(hjust=.5,vjust = 1,size = 8, margin = margin(b = 2, t = 2)),
        strip.background = element_rect(fill = "white", color = "black"),
        legend.title = element_text(size = 9, face = "bold", hjust = .5),
        legend.text = element_text(size = 9),
        legend.key.size = unit(.6, 'cm'),
        legend.spacing.y = unit(.001, "cm"),
        legend.box.margin = margin(0,0,0,-5)) +
  facet_wrap(~PRS) 
  
ggsave(CortVol_Final, file = "CortVol_Final_plot1.png", width = 6, height = 5)

## Cortical Area plot
CortArea$xpos <- c(rep(seq(1,68,1),4))
CortArea$hemisphere <- factor(ifelse(grepl("lh", CortArea$Variable), "Left Hemisphere", "Right Hemisphere"),
                           levels = c("Left Hemisphere", "Right Hemisphere"))
CortArea_Final <- ggplot(CortArea, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(hemisphere), shape = as.factor(direction)), size = 2.3) + 
  scale_color_manual(values = c("deepskyblue4", "deepskyblue3"), labels = c("Left", "Right")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Hemisphere", x="", y="-log(p-value)") +
  new_scale_color() +
  geom_text_repel(data=. %>% mutate(label = ifelse(Bonferroni < .05, as.character(Variable2), "")), 
                  aes(label=label, color = hemisphere), size=2.5,  box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2)  +
  scale_color_manual(values = c("deepskyblue4", "deepskyblue3")) +
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/68), color = "coral3", linetype = 'dashed', size = .5) +
  theme_classic() +
  guides(shape = "none", colour = "none") +
  ggtitle(label = "Associations Between PRS and Cortical Area Brain Metrics") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 4.2)) +
  ylab("-log(p-value)") +
  theme(axis.text.x = element_blank(), 
        axis.ticks=element_blank(),
        axis.title.y = element_text(size = 10, face = "bold"),
        axis.text.y = element_text(size = 8),
        plot.title = element_text(size = 12, hjust = .5, face = "bold"),
        strip.text = element_text(hjust=.5,vjust = 1,size = 8, margin = margin(b = 2, t = 2)),
        strip.background = element_rect(fill = "white", color = "black"),
        legend.title = element_text(size = 9, face = "bold", hjust = .5),
        legend.text = element_text(size = 9),
        legend.key.size = unit(.6, 'cm'),
        legend.spacing.y = unit(.001, "cm"),
        legend.box.margin = margin(0,0,0,-5)) +
  facet_wrap(~PRS) 
  
ggsave(CortArea_Final, file = "CortArea_Final_plot1.png", width = 6, height = 5)

## Cortical Thick plot
CortThick$xpos <- c(rep(seq(1,68,1),4))
CortThick$hemisphere <- factor(ifelse(grepl("lh", CortThick$Variable), "Left Hemisphere", "Right Hemisphere"),
                           levels = c("Left Hemisphere", "Right Hemisphere"))
CortThick_Final <- ggplot(CortThick, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=as.factor(hemisphere), shape = as.factor(direction)), size = 2.3) + 
  scale_color_manual(values = c("deepskyblue4", "deepskyblue3"), labels = c("Left", "Right")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Hemisphere", x="", y="-log(p-value)") +
  new_scale_color() +
  geom_text_repel(data=. %>% mutate(label = ifelse(Bonferroni < .05, as.character(Variable2), "")), 
                  aes(label=label, color = hemisphere), size=2.5,  box.padding = 0.1, point.padding = .1, size=2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2)  +
  scale_color_manual(values = c("deepskyblue4", "deepskyblue3")) +
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/68), color = "coral3", linetype = 'dashed', size = .5) +
  theme_classic() +
  guides(shape = "none", colour = "none") +
  ggtitle(label = "Associations Between PRS and Cortical Thickness Brain Metrics") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 4.2)) +
  ylab("-log(p-value)") +
  theme(axis.text.x = element_blank(), 
        axis.ticks=element_blank(),
        axis.title.y = element_text(size = 10, face = "bold"),
        axis.text.y = element_text(size = 8),
        plot.title = element_text(size = 12, hjust = .5, face = "bold"),
        strip.text = element_text(hjust=.5,vjust = 1,size = 8, margin = margin(b = 2, t = 2)),
        strip.background = element_rect(fill = "white", color = "black"),
        legend.title = element_text(size = 9, face = "bold", hjust = .5),
        legend.text = element_text(size = 9),
        legend.key.size = unit(.6, 'cm'),
        legend.spacing.y = unit(.001, "cm"),
        legend.box.margin = margin(0,0,0,-5)) +
  facet_wrap(~PRS) 
  
ggsave(CortThick_Final, file = "CortThick_Final_plot1.png", width = 6, height = 5)


## Subcortical Volume plot
Subcort$xpos <- c(rep(seq(1,35,1),4))
Subcort$hemisphere <- factor(ifelse(grepl("lh", Subcort$Variable), "Left Hemisphere", 
                                    ifelse(grepl("rh", Subcort$Variable), "Right Hemisphere", "Non-Lateral")),
                           levels = c("Left Hemisphere", "Right Hemisphere", "Non-Lateral"))
Subcort <- Subcort %>%
  arrange(PRS, hemisphere)
Subcort_Final <- ggplot(Subcort %>% arrange(hemisphere), aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=hemisphere, shape = as.factor(direction)), size = 2.3) + 
  scale_color_manual(values = c("deepskyblue4", "deepskyblue3", "deepskyblue1"), labels = c("Left", "Right", "Non-Lateral")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Hemisphere", x="", y="-log(p-value)") +
  new_scale_color() +
  geom_text_repel(data=. %>% mutate(label = ifelse(Bonferroni < .05, as.character(Variable2), "")), 
                  aes(label=label, color = hemisphere), size=2.5,  box.padding = 0.1, point.padding = .1, size=2, nudge_y = .2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2)  +
  scale_color_manual(values = c("deepskyblue4", "deepskyblue3", "deepskyblue3")) +
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/35), color = "coral3", linetype = 'dashed', size = .5) +
  theme_classic() +
  guides(shape = "none", colour = "none") +
  ggtitle(label = "Associations Between PRS and \nSubcortical Volume Brain Metrics") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 4.2)) +
  ylab("-log(p-value)") +
  theme(axis.text.x = element_blank(), 
        axis.ticks=element_blank(),
        axis.title.y = element_text(size = 10, face = "bold"),
        axis.text.y = element_text(size = 8),
        plot.title = element_text(size = 12, hjust = .5, face = "bold"),
        strip.text = element_text(hjust=.5,vjust = 1,size = 8, margin = margin(b = 2, t = 2)),
        strip.background = element_rect(fill = "white", color = "black"),
        legend.title = element_text(size = 9, face = "bold", hjust = .5),
        legend.text = element_text(size = 9),
        legend.key.size = unit(.6, 'cm'),
        legend.spacing.y = unit(.001, "cm"),
        legend.box.margin = margin(0,0,0,-5)) +
  facet_wrap(~PRS) 
  
ggsave(Subcort_Final, file = "Subcort_Final_plot1.png", width = 6, height = 5)


## RSFC plot
RSFC$xpos <- c(rep(seq(1,91,1),4))
RSFC$network1 <- factor(rep(c(rep("auditory", 13), rep("cingulo-parietal", 12), rep("cingulo-opercular", 11), rep("dorsal attention", 10), rep("default", 9), rep("fronto-parietal", 8), rep("none", 7), rep("retrosplenial temporal", 6), rep("salience", 5), rep("sensorimotor hand", 4), rep("sensorimotor mouth", 3), rep("visual", 2), "ventral attention"), 4), levels = c("auditory", "cingulo-parietal", "cingulo-opercular", "dorsal attention", "default", "frontal parietal", "none", "retrosplenial temporal", "salience", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention"))
RSFC$network2 <- factor(rep(c("auditory", "cingulo-parietal", "cingulo-opercular", "dorsal attention", "default", "frontal parietal", "none", "retrosplenial temporal", "salience", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention", "cingulo-parietal", "cingulo-opercular", "dorsal attention", "default", "frontal parietal", "none", "retrosplenial temporal", "salience", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention","cingulo-opercular", "dorsal attention", "default", "frontal parietal", "none", "retrosplenial temporal", "salience", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention", "dorsal attention", "default", "frontal parietal", "none", "retrosplenial temporal", "salience", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention", "default", "frontal parietal", "none", "retrosplenial temporal", "salience", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention", "frontal parietal", "none", "retrosplenial temporal", "salience", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention", "none", "retrosplenial temporal", "salience", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention", "retrosplenial temporal", "salience", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention", "salience", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention", "sensorimotor mouth", "visual", "ventral attention", "visual", "ventral attention", "ventral attention"), 4), levels = c("auditory", "cingulo-parietal", "cingulo-opercular", "dorsal attention", "default", "frontal parietal", "none", "retrosplenial temporal", "salience", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention"))

color_col = c("orchid3", "dodgerblue4", "mediumpurple4", "seagreen4", "palevioletred4", "goldenrod1", "lemonchiffon3", "slateblue2", "darkslategrey", "turquoise2", "darkorange2", "maroon3", "deepskyblue2", "black")
RSFC_Final <- ggplot(RSFC[1:91,], aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=network2, shape = as.factor(direction)), size = 5) + 
  geom_point(aes(shape = as.factor(direction), color = network1),  size = 3) + 
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  scale_color_manual(values = color_col, labels = c("auditory", "cingulo-parietal", "cingulo-opercular", "dorsal attention", "default", "frontal parietal", "none", "retrosplenial temporal", "salience", "sensorimotor hand", "sensorimotor mouth", "visual", "ventral attention")) +
  labs(color="Network", x="", y="-log(p-value)") +
  new_scale_color() +
  geom_text_repel(data=. %>% mutate(label = ifelse(Bonferroni < .05, as.character(Variable), "")), 
                  aes(label=label, color = network1), size=2.5,  box.padding = 0.1, point.padding = .1, size=2, nudge_y = .2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2)  +
  #scale_color_manual(values = c("deepskyblue4", "deepskyblue3", "deepskyblue3")) +
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/35), color = "coral3", linetype = 'dashed', size = .5) +
  theme_classic() +
  guides(shape = "none", colour = "none") +
  ggtitle(label = "Associations Between PRS and Functional Connectivity Metrics") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 4.2)) +
  ylab("-log(p-value)") +
  theme(axis.text.x = element_blank(), 
        axis.ticks=element_blank(),
        axis.title.y = element_text(size = 10, face = "bold"),
        axis.text.y = element_text(size = 8),
        plot.title = element_text(size = 12, hjust = .5, face = "bold"),
        strip.text = element_text(hjust=.5,vjust = 1,size = 8, margin = margin(b = 2, t = 2)),
        strip.background = element_rect(fill = "white", color = "black"),
        legend.title = element_text(size = 9, face = "bold", hjust = .5),
        legend.text = element_text(size = 9),
        legend.key.size = unit(.6, 'cm'),
        legend.spacing.y = unit(.001, "cm"),
        legend.box.margin = margin(0,0,0,-5)) +
  facet_wrap(~PRS) 
  
ggsave(RSFC_Final, file = "RSFC_Final_plot1.png", width = 6, height = 5)

RSFC$Variable[RSFC$Variable=="rsfmri_c_ngd_fo_ngd_fo"] <- "Frontoparietal Network"
RSFC_Final2 <- ggplot(RSFC, aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(shape = as.factor(direction)), color = "orchid4", size = 2.3) + 
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(x="", y="-log(p-value)") +
  geom_text_repel(data=. %>% mutate(label = ifelse(Bonferroni < .05, as.character(Variable), "")), 
                  aes(label=label), color = "orchid4", size=2.5,  box.padding = 0.1, point.padding = .1, size=2, nudge_y = .2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2)  +
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/91), color = "coral3", linetype = 'dashed', size = .5) +
  theme_classic() +
  guides(shape = "none", colour = "none") +
  ggtitle(label = "Associations Between PRS and Functional Connectivity Metrics") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 4.2)) +
  ylab("-log(p-value)") +
  theme(axis.text.x = element_blank(), 
        axis.ticks=element_blank(),
        axis.title.y = element_text(size = 10, face = "bold"),
        axis.text.y = element_text(size = 8),
        plot.title = element_text(size = 12, hjust = .5, face = "bold"),
        strip.text = element_text(hjust=.5,vjust = 1,size = 8, margin = margin(b = 2, t = 2)),
        strip.background = element_rect(fill = "white", color = "black"),
        legend.title = element_text(size = 9, face = "bold", hjust = .5),
        legend.text = element_text(size = 9),
        legend.key.size = unit(.6, 'cm'),
        legend.spacing.y = unit(.001, "cm"),
        legend.box.margin = margin(0,0,0,-5)) +
  facet_wrap(~PRS) 
  
ggsave(RSFC_Final2, file = "RSFC_Final_plot2.png", width = 6, height = 5)

## FA PLOT
DTIFA$xpos <- c(rep(seq(1,37,1),4))
DTIFA$hemisphere <- factor(ifelse(grepl("lh", DTIFA$Variable), "Left Hemisphere", 
                                    ifelse(grepl("rh", DTIFA$Variable), "Right Hemisphere", "Non-Lateral")),
                           levels = c("Left Hemisphere", "Right Hemisphere", "Non-Lateral"))
DTIFA <- DTIFA %>%
  arrange(PRS, hemisphere)
DTIFA_Final <- ggplot(DTIFA %>% arrange(hemisphere), aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=hemisphere, shape = as.factor(direction)), size = 2.3) + 
  scale_color_manual(values = c("deepskyblue4", "deepskyblue3", "deepskyblue1"), labels = c("Left", "Right", "Non-Lateral")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Hemisphere", x="", y="-log(p-value)") +
  new_scale_color() +
  geom_text_repel(data=. %>% mutate(label = ifelse(Bonferroni < .05, as.character(Variable2), "")), 
                  aes(label=label, color = hemisphere), size=2.5,  box.padding = 0.1, point.padding = .1, size=2, nudge_y = .2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2)  +
  scale_color_manual(values = c("deepskyblue4", "deepskyblue3", "deepskyblue3")) +
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/37), color = "coral3", linetype = 'dashed', size = .5) +
  theme_classic() +
  guides(shape = "none", colour = "none") +
  ggtitle(label = "Associations Between PRS and \nFractional Anisotropy Metrics") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 4.2)) +
  ylab("-log(p-value)") +
  theme(axis.text.x = element_blank(), 
        axis.ticks=element_blank(),
        axis.title.y = element_text(size = 10, face = "bold"),
        axis.text.y = element_text(size = 8),
        plot.title = element_text(size = 12, hjust = .5, face = "bold"),
        strip.text = element_text(hjust=.5,vjust = 1,size = 8, margin = margin(b = 2, t = 2)),
        strip.background = element_rect(fill = "white", color = "black"),
        legend.title = element_text(size = 9, face = "bold", hjust = .5),
        legend.text = element_text(size = 9),
        legend.key.size = unit(.6, 'cm'),
        legend.spacing.y = unit(.001, "cm"),
        legend.box.margin = margin(0,0,0,-5)) +
  facet_wrap(~PRS) 
  
ggsave(DTIFA_Final, file = "DTIFA_Final_plot1.png", width = 6, height = 5)

## MD PLOT
DTIMD$xpos <- c(rep(seq(1,37,1),4))
DTIMD$hemisphere <- factor(ifelse(grepl("lh", DTIMD$Variable), "Left Hemisphere", 
                                    ifelse(grepl("rh", DTIMD$Variable), "Right Hemisphere", "Non-Lateral")),
                           levels = c("Left Hemisphere", "Right Hemisphere", "Non-Lateral"))
DTIMD <- DTIMD %>%
  arrange(PRS, hemisphere)
DTIMD_Final <- ggplot(DTIMD %>% arrange(hemisphere), aes(x=xpos, y=neg_log_p)) + 
  geom_point(aes(col=hemisphere, shape = as.factor(direction)), size = 2.3) + 
  scale_color_manual(values = c("deepskyblue4", "deepskyblue3", "deepskyblue1"), labels = c("Left", "Right", "Non-Lateral")) +
  scale_shape_manual(values = c("\u25BC", "\u25B2")) +
  labs(color="Hemisphere", x="", y="-log(p-value)") +
  new_scale_color() +
  geom_text_repel(data=. %>% mutate(label = ifelse(Bonferroni < .05, as.character(Variable2), "")), 
                  aes(label=label, color = hemisphere), size=2.5,  box.padding = 0.1, point.padding = .1, size=2, nudge_y = .2, segment.color = 'gray32', segment.size = 0.3, arrow = arrow(length = unit(0.007, 'npc')), min.segment.length = 0.2)  +
  scale_color_manual(values = c("deepskyblue4", "deepskyblue3", "deepskyblue3")) +
  geom_hline(yintercept=0, color="black", size=.8, alpha=0.5) +
  geom_hline(yintercept = -log10(.05/37), color = "coral3", linetype = 'dashed', size = .5) +
  theme_classic() +
  guides(shape = "none", colour = "none") +
  ggtitle(label = "Associations Between PRS and \nMean Diffusivity Metrics") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 4.2)) +
  ylab("-log(p-value)") +
  theme(axis.text.x = element_blank(), 
        axis.ticks=element_blank(),
        axis.title.y = element_text(size = 10, face = "bold"),
        axis.text.y = element_text(size = 8),
        plot.title = element_text(size = 12, hjust = .5, face = "bold"),
        strip.text = element_text(hjust=.5,vjust = 1,size = 8, margin = margin(b = 2, t = 2)),
        strip.background = element_rect(fill = "white", color = "black"),
        legend.title = element_text(size = 9, face = "bold", hjust = .5),
        legend.text = element_text(size = 9),
        legend.key.size = unit(.6, 'cm'),
        legend.spacing.y = unit(.001, "cm"),
        legend.box.margin = margin(0,0,0,-5)) +
  facet_wrap(~PRS) 
  
ggsave(DTIMD_Final, file = "DTIMD_Final_plot1.png", width = 6, height = 5)

```

#### BRAIN TO FU PHENOTYPE ANALYSES ####
```{r}
PheWAS_FU <- read_excel("FINAL_PheWAS_FU2_n5556_11.18.xlsx")

PheWAS_FU$site_id <- ifelse(PheWAS_FU$site_id == 22, 21, PheWAS_FU$site_id)
PheWAS_FU[PheWAS_FU == "NA"] <- NA
PheWAS_FU[PheWAS_FU == ""] <- NA

sig_brain <- MRI%>%
  dplyr::select(subjectkey, mri_info_manufacturer_COV, rsfmri_c_ngd_meanmotion_COV, dmri_dti_meanmotion_COV, smri_thick_cdk_mean, smri_area_cdk_total, smri_vol_scs_subcorticalgv, dmri_dtifa_fiberat_allfibers, 
                smri_thick_cdk_meanrh, smri_vol_cdk_total, smri_vol_cdk_totallh, smri_vol_cdk_totalrh, smri_vol_scs_suprateialv, smri_vol_scs_wholeb, smri_vol_cdk_precnlh, smri_area_cdk_precnlh, smri_area_cdk_trvtmrh, smri_thick_cdk_parsobisrh, smri_vol_scs_4thventricle, smri_vol_scs_vedcrh, rsfmri_c_ngd_fo_ngd_fo, dmri_dtifa_fiberat_cc)

Psychotic_FU_sig <- ResultsFU2_comp[ResultsFU2_comp$Bonferroni < 0.05, ]
Neurodev_FU_sig <- ResultsFU3_comp[ResultsFU3_comp$Bonferroni < 0.05, ]

Psychotic_FU_sig_df <- PheWAS_FU[colnames(PheWAS_FU) %in% Psychotic_FU_sig$Variable]
Neurodev_FU_sig_df <- PheWAS_FU[colnames(PheWAS_FU) %in% Neurodev_FU_sig$Variable]

Psychotic_brain_sig <- cbind(PheWAS_FU[, 1:21], sig_brain[,-1], Psychotic_FU_sig_df)
Neurodev_brain_sig <- cbind(PheWAS_FU[, 1:21], sig_brain[,-1], Neurodev_FU_sig_df)

Psychotic_brain_sig[, c(1:4,20:22)] <- lapply(Psychotic_brain_sig[,c(1:4,20:22)],as.factor)
Psychotic_brain_sig[, c(5:19,23:43)] <- lapply(Psychotic_brain_sig[,c(5:19,23:43)],as.numeric)

Psychotic_brain_sig <- Psychotic_brain_sig %>%
  mutate_if(is.numeric, scale)

Psychotic_brain_sig <- as.data.frame(Psychotic_brain_sig)

psychotic_pars_mod <- lmer(srpf_y_ss_iiss ~ smri_thick_cdk_parsobisrh + sex + interview_age + mri_info_manufacturer_COV + smri_thick_cdk_mean + COVID_visittype + (1|site_id) + (1|rel_family_id), data = Psychotic_brain_sig)
summary(psychotic_pars_mod)

psychotic_ventraldc_mod <- lmer(srpf_y_ss_iiss ~ smri_vol_scs_vedcrh + sex + interview_age + mri_info_manufacturer_COV + smri_vol_scs_subcorticalgv + COVID_visittype + (1|site_id) + (1|rel_family_id), data = Psychotic_brain_sig)
summary(psychotic_ventraldc_mod)

psychotic_fiberat_cc_mod <- lmer(srpf_y_ss_iiss ~ dmri_dtifa_fiberat_cc + sex + interview_age + mri_info_manufacturer_COV + dmri_dti_meanmotion_COV + dmri_dtifa_fiberat_allfibers + COVID_visittype + (1|site_id) + (1|rel_family_id), data = Psychotic_brain_sig)
summary(psychotic_fiberat_cc_mod)



Neurodev_brain_sig[, c(1:4,20:22, 237:253)] <- lapply(Neurodev_brain_sig[,c(1:4,20:22, 237:253)],as.factor)
Neurodev_brain_sig[, c(5:19,23:236)] <- lapply(Neurodev_brain_sig[,c(5:19,23:236)],as.numeric)

Neurodev_brain_sig <- Neurodev_brain_sig %>%
  mutate_if(is.numeric, scale)

Neurodev_brain_sig <- as.data.frame(Neurodev_brain_sig)

Neurodev_brain_sig_sexvar <- Neurodev_brain_sig %>%
  dplyr::select(subjectkey:dmri_dtifa_fiberat_cc, contains("pds"), contains("menstrual"), contains("gish"))

Neurodev_brain_sig_other <- Neurodev_brain_sig  %>%
  select(subjectkey:dmri_dtifa_fiberat_cc, contains("biospec"), contains("fitbit"), prodromal_19b_y, prodromal_21b_y, ksads_sleepprob_raw_818_pTRAN, ksads_sleepprob_raw_818_tTRAN, ple_injur_fu2_p, ple_friend_died_fu2_p)

Neurodev_brain_sig2 <- Neurodev_brain_sig %>%
  dplyr::select(-contains("pds"), -contains("menstrual"), -contains("gish"))


#### CDK TOT VOL ####
attach(Neurodev_brain_sig2)

First <- 43
Last <- 231
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(Neurodev_brain_sig2[,i] ~ smri_vol_cdk_total + sex + interview_age + mri_info_manufacturer_COV + COVID_visittype + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_vol_tot_cont <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_vol_tot_cont) <- c("Variable", "Beta", "STE", "Pval")

set.seed(10)
First <- 232 
Last <- 248 
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  LMEOut <- withWarnings( a <- glmer(Neurodev_brain_sig2[,i] ~ smri_vol_cdk_total + sex + interview_age + mri_info_manufacturer_COV + COVID_visittype + (1|site_id) + (1|rel_family_id), nAGQ = 0, family = "binomial"))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_vol_tot_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_vol_tot_cat) <- c("Variable", "Beta", "STE", "Pval")

detach(Neurodev_brain_sig2)
attach(Neurodev_brain_sig_sexvar)

First <- 43
Last <- 47
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  LMEOut <- withWarnings( a <- lmer(Neurodev_brain_sig2[,i] ~ smri_vol_cdk_total + interview_age + mri_info_manufacturer_COV + COVID_visittype + (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_vol_tot_sexvar <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_vol_tot_sexvar) <- c("Variable", "Beta", "STE", "Pval")
detach(Neurodev_brain_sig_sexvar)

Results_Neur_vol_tot <- rbind(Results_Neur_vol_tot_cont, Results_Neur_vol_tot_cat, Results_Neur_vol_tot_sexvar)
Results_Neur_vol_tot$FDR <- p.adjust(Results_Neur_vol_tot$Pval, method = "fdr")
Results_Neur_vol_tot$Bonferroni <- p.adjust(Results_Neur_vol_tot$Pval, method = "fdr")



#### CDK RH THICK ####
attach(Neurodev_brain_sig2)

First <- 43
Last <- 231
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(Neurodev_brain_sig2[,i] ~ smri_thick_cdk_meanrh + sex + interview_age + mri_info_manufacturer_COV + COVID_visittype + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_thick_rh_cont <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_thick_rh_cont) <- c("Variable", "Beta", "STE", "Pval")

set.seed(10)
First <- 232 
Last <- 248 
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  LMEOut <- withWarnings( a <- glmer(Neurodev_brain_sig2[,i] ~ smri_thick_cdk_meanrh + sex + interview_age + mri_info_manufacturer_COV + COVID_visittype + (1|site_id) + (1|rel_family_id), nAGQ = 0, family = "binomial"))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_thick_rh_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_thick_rh_cat) <- c("Variable", "Beta", "STE", "Pval")

detach(Neurodev_brain_sig2)
attach(Neurodev_brain_sig_sexvar)

First <- 43
Last <- 47
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  LMEOut <- withWarnings( a <- lmer(Neurodev_brain_sig2[,i] ~ smri_thick_cdk_meanrh + interview_age + mri_info_manufacturer_COV + COVID_visittype + (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_thick_rh_sexvar <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_thick_rh_sexvar) <- c("Variable", "Beta", "STE", "Pval")
detach(Neurodev_brain_sig_sexvar)

Results_Neur_thick_rh <- rbind(Results_Neur_thick_rh_cont, Results_Neur_thick_rh_cat, Results_Neur_thick_rh_sexvar)
Results_Neur_thick_rh$FDR <- p.adjust(Results_Neur_thick_rh$Pval, method = "fdr")
Results_Neur_thick_rh$Bonferroni <- p.adjust(Results_Neur_thick_rh$Pval, method = "fdr")



#### Supratentorial volume ####
attach(Neurodev_brain_sig2)

First <- 43
Last <- 231
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(Neurodev_brain_sig2[,i] ~ smri_vol_scs_suprateialv + sex + interview_age + mri_info_manufacturer_COV + COVID_visittype + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_suprateialv_cont <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_suprateialv_cont) <- c("Variable", "Beta", "STE", "Pval")

set.seed(10)
First <- 232 
Last <- 248 
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  LMEOut <- withWarnings( a <- glmer(Neurodev_brain_sig2[,i] ~ smri_vol_scs_suprateialv + sex + interview_age + mri_info_manufacturer_COV + COVID_visittype + (1|site_id) + (1|rel_family_id), nAGQ = 0, family = "binomial"))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_suprateialv_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_suprateialv_cat) <- c("Variable", "Beta", "STE", "Pval")

detach(Neurodev_brain_sig2)
attach(Neurodev_brain_sig_sexvar)

First <- 43
Last <- 47
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  LMEOut <- withWarnings( a <- lmer(Neurodev_brain_sig2[,i] ~ smri_vol_scs_suprateialv + interview_age + mri_info_manufacturer_COV + COVID_visittype + (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_suprateialv_sexvar <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_suprateialv_sexvar) <- c("Variable", "Beta", "STE", "Pval")
detach(Neurodev_brain_sig_sexvar)

Results_Neur_suprateialv <- rbind(Results_Neur_suprateialv_cont, Results_Neur_suprateialv_cat, Results_Neur_suprateialv_sexvar)
Results_Neur_suprateialv$FDR <- p.adjust(Results_Neur_suprateialv$Pval, method = "fdr")
Results_Neur_suprateialv$Bonferroni <- p.adjust(Results_Neur_suprateialv$Pval, method = "fdr")



#### Whole brain volume ####
attach(Neurodev_brain_sig2)

First <- 43
Last <- 231
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(Neurodev_brain_sig2[,i] ~ smri_vol_scs_wholeb + sex + interview_age + mri_info_manufacturer_COV + COVID_visittype + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_wholeb_cont <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_wholeb_cont) <- c("Variable", "Beta", "STE", "Pval")

set.seed(10)
First <- 232 
Last <- 248 
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  LMEOut <- withWarnings( a <- glmer(Neurodev_brain_sig2[,i] ~ smri_vol_scs_wholeb + sex + interview_age + mri_info_manufacturer_COV + COVID_visittype + (1|site_id) + (1|rel_family_id), nAGQ = 0, family = "binomial"))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_wholeb_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_wholeb_cat) <- c("Variable", "Beta", "STE", "Pval")

detach(Neurodev_brain_sig2)
attach(Neurodev_brain_sig_sexvar)

First <- 43
Last <- 47
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  LMEOut <- withWarnings( a <- lmer(Neurodev_brain_sig2[,i] ~ smri_vol_scs_wholeb + interview_age + mri_info_manufacturer_COV + COVID_visittype + (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_wholeb_sexvar <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_wholeb_sexvar) <- c("Variable", "Beta", "STE", "Pval")
detach(Neurodev_brain_sig_sexvar)

Results_Neur_wholeb <- rbind(Results_Neur_wholeb_cont, Results_Neur_wholeb_cat, Results_Neur_wholeb_sexvar)
Results_Neur_wholeb$FDR <- p.adjust(Results_Neur_wholeb$Pval, method = "fdr")
Results_Neur_wholeb$Bonferroni <- p.adjust(Results_Neur_wholeb$Pval, method = "fdr")


#### 4th ventricle volume ####
attach(Neurodev_brain_sig2)

First <- 43
Last <- 231
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
for (i in First:Last) {
  print(i)
  LMEOut <- withWarnings( a <- lmer(Neurodev_brain_sig2[,i] ~ smri_vol_scs_4thventricle + sex + interview_age + mri_info_manufacturer_COV + COVID_visittype + smri_vol_scs_subcorticalgv + (1|site_id) + (1|rel_family_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_4thventricle_cont <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_4thventricle_cont) <- c("Variable", "Beta", "STE", "Pval")

set.seed(10)
First <- 232 
Last <- 248 
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  LMEOut <- withWarnings( a <- glmer(Neurodev_brain_sig2[,i] ~ smri_vol_scs_4thventricle + sex + interview_age + mri_info_manufacturer_COV + COVID_visittype + smri_vol_scs_subcorticalgv + (1|site_id) + (1|rel_family_id), nAGQ = 0, family = "binomial"))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,4]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_4thventricle_cat <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_4thventricle_cat) <- c("Variable", "Beta", "STE", "Pval")

detach(Neurodev_brain_sig2)
attach(Neurodev_brain_sig_sexvar)

First <- 43
Last <- 47
Beta <- NULL
STE <- NULL
Area <- NULL
Pval <- NULL
i <-  NULL
Warn <- NULL
Results <- NULL
Sigs <- NULL
LMEOut <- NULL
a <- NULL
#Runs the for loop
for (i in First:Last) {
  LMEOut <- withWarnings( a <- lmer(Neurodev_brain_sig2[,i] ~ smri_vol_scs_4thventricle + interview_age + mri_info_manufacturer_COV + COVID_visittype + smri_vol_scs_subcorticalgv + (1|rel_family_id) + (1|site_id)))
  Beta[i] <- summary(a)$`coefficients`[2]
  STE[i] <- summary(a)$`coefficients`[2,2]
  Pval[i] <-  summary(a)$`coefficients`[2,5]
  Area[i] <- colnames(Neurodev_brain_sig2)[i]
  Warn[i] <- LMEOut$warnings
}
#Store results in a dataframe
Results_Neur_4thventricle_sexvar <- cbind.data.frame(Area[First:length(Area)], Beta[First:length(Beta)], STE[First:length(STE)], Pval[First:length(Pval)])
#Relabel Results
colnames(Results_Neur_4thventricle_sexvar) <- c("Variable", "Beta", "STE", "Pval")
detach(Neurodev_brain_sig_sexvar)

Results_Neur_4thventricle <- rbind(Results_Neur_4thventricle_cont, Results_Neur_4thventricle_cat, Results_Neur_4thventricle_sexvar)
Results_Neur_4thventricle$FDR <- p.adjust(Results_Neur_4thventricle$Pval, method = "fdr")
Results_Neur_4thventricle$Bonferroni <- p.adjust(Results_Neur_4thventricle$Pval, method = "fdr")


Results_brain_pheno <- rbind(Results_Neur_vol_tot, Results_Neur_thick_rh, Results_Neur_suprateialv, Results_Neur_wholeb, Results_Neur_4thventricle)
brain_region <- as.data.frame(c(rep("vol_tot", 211), rep("thk_rh", 211), rep("suprateialv", 211), rep("wholeb", 211), rep("4th_ven", 211)))
colnames(brain_region) <- "brain_region"
Results_brain_pheno <- as.data.frame(cbind(brain_region, Results_brain_pheno))
Results_brain_pheno$FDR2 <- p.adjust(Results_brain_pheno$Pval, method = "fdr")
Results_brain_pheno$Bonferroni <- p.adjust(Results_brain_pheno$Pval, method = "bonferroni")
fwrite(Results_brain_pheno, "PheWAS_BraintoPheno_Results_bonf2_11.20.22.txt", sep = "\t")
```


#### MEDIATION ####
```{r}
library(lavaan)
library(data.table)

## pulling significant variables
PheWAS_baseline <- read_excel("FINAL_PHEWAS_BASELINE_n5556_10.23.22.xlsx")
PheWAS_baseline[PheWAS_baseline == "NA"] <- NA
PheWAS_FU <- read_excel("FINAL_PheWAS_FU2_n5556_11.18.xlsx")
PheWAS_FU[PheWAS_FU == "NA"] <- NA
FU_covar <- PheWAS_FU[,c(1:21)]
colnames(FU_covar)[19] <- "FU_age"
FU_covar[,"sex"] <- NULL
baseline_covar <- PheWAS_baseline[, c("interview_age", "sex")]
colnames(baseline_covar)[1] <- "baseline_age"
sig_outcomes <- Results_brain_pheno[Results_brain_pheno$Bonferroni < .05,]
sig_outcomes_df <- PheWAS_FU[colnames(PheWAS_FU) %in% sig_outcomes$Variable] 

sig_brain <- MRI %>%
  dplyr::select(mri_info_manufacturer_COV, smri_vol_scs_subcorticalgv, smri_vol_cdk_total, smri_vol_cdk_totallh, smri_vol_scs_suprateialv, smri_vol_scs_wholeb, smri_vol_scs_4thventricle)

meddata <- cbind(FU_covar, baseline_covar, sig_brain, sig_outcomes_df)
meddata$sex = ifelse(meddata$sex == "F", 1, 0)
meddata$siemens <- as.numeric(ifelse(meddata$mri_info_manufacturer_COV == "SIEMENS", 1, 0))
meddata$philips <- as.numeric(ifelse(meddata$mri_info_manufacturer_COV == "Philips Medical Systems", 1, 0))
meddata$ge <- as.numeric(ifelse(meddata$mri_info_manufacturer_COV == "GE MEDICAL SYSTEMS", 1, 0))

meddata$COVID_visittype1 <-as.numeric(ifelse(meddata$COVID_visittype == 1, 1, 0))
meddata$COVID_visittype2 <- as.numeric(ifelse(meddata$COVID_visittype == 2, 1, 0))
meddata$COVID_visittype3 <- as.numeric(ifelse(meddata$COVID_visittype == 3, 1, 0))

meddata$agediff <- as.numeric(meddata$FU_age) - as.numeric(meddata$baseline_age)
meddata$site_id <- ifelse(meddata$site_id == 22, 21, meddata$site_id)

meddata[,c(1:4, 20, 23, 83:84)] <- lapply(meddata[,c(1:4, 20, 23, 83:84)],as.factor)
meddata[,c(5:19, 21:22, 24:82)] <- lapply(meddata[,c(5:19, 21:22, 24:82)],as.numeric)

meddata <- meddata %>%
  mutate_if(is.numeric, scale)
meddata$demo_med_insur_d_p <- as.numeric(meddata$demo_med_insur_d_p)
meddata$kbi_p_conflict_causes_l___6 <- as.numeric(meddata$kbi_p_conflict_causes_l___6)
meddata <- as.data.frame(meddata)

#meddata <- meddata[complete.cases(meddata),]
#fwrite(meddata, file = "meddata.txt", sep = "\t")

meddata_outcomes_cortvol <- meddata %>%
  dplyr::select(sag_grades_last_yr:kbi_p_conflict_causes_l___6) %>%
  dplyr::select(-school_9_y, -gen_child_behav_5, -cbcl_q26_p, -cbcl_q38_p, -cbcl_scr_07_stress_r)
meddata_nooutcomes <- meddata %>%
  dplyr::select(subjectkey, rel_family_id:C10, Neurodev_PRScs, FU_age, baseline_age, sex, smri_vol_cdk_total, smri_vol_scs_suprateialv, smri_vol_scs_wholeb, smri_vol_scs_4thventricle, smri_vol_scs_subcorticalgv,  siemens:agediff)

first <- 1
last <-48
i <- NULL
fit <- NULL
fit2 <- NULL
groups <- NULL
surveyfitmod <- NULL
surveyfitmod2 <- NULL
surveyfitmod3 <- NULL
indirect_Effect <- NULL
indirect_Effect_CIl <- NULL
indirect_Effect_CIu <- NULL
indirect_P <- NULL
direct_Effect <- NULL 
direct_Effect_CIl <- NULL
direct_Effect_CIu <- NULL
direct_Effect_PValue <- NULL
outcome <- NULL
for (i in first:last) {
  meddata2 <- cbind.data.frame(meddata_nooutcomes, meddata_outcomes_cortvol[i]) 
  colnames(meddata2) <- c("subjectkey", "rel_family_id", "site_id", "C1", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C10",  "Neurodev_PRScs", "FU_age", "baseline_age", "sex", "smri_vol_cdk_total",  "smri_vol_scs_suprateialv", "smri_vol_scs_wholeb", "smri_vol_scs_4thventricle", "smri_vol_scs_subcorticalgv",  "siemens", "philips", "ge", "COVID_visittype1",   "COVID_visittype2", "COVID_visittype3", "agediff", "outcome")
  
  Model <- '
smri_vol_cdk_total ~ a*Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + baseline_age + sex + siemens + philips 
outcome ~ c*Neurodev_PRScs + b*smri_vol_cdk_total + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + FU_age + sex + siemens + philips + COVID_visittype1 + COVID_visittype3
 # indirect effect (a*b)
             ab := a*b
           # total effect
             total := c + (a*b)
'
fit <- sem(Model, data = meddata2, estimator = "ML" )
fit2 <- summary(fit)

groups <- svydesign(id=~rel_family_id + site_id, data = meddata2)
surveyfitmod <- lavaan.survey(lavaan.fit = fit, survey.design = groups)
surveyfitmod2 <- summary(surveyfitmod)
surveyfitmod3 <- parameterEstimates(surveyfitmod, boot.ci.type="bca.simple",level=0.95, ci=TRUE,rsquare=TRUE,standardized = TRUE)

  indirect_Effect[i] <- surveyfitmod3[227,5]
  indirect_Effect_CIl[i] <- surveyfitmod3[227,9]
  indirect_Effect_CIu[i] <- surveyfitmod3[227,10]
  indirect_P[i] <- surveyfitmod3[227,8]
  direct_Effect[i] <- surveyfitmod3[16,6]
  direct_Effect_CIl[i] <- surveyfitmod3[16,9]
  direct_Effect_CIu[i] <- surveyfitmod3[16,10]
  direct_Effect_PValue[i] <- surveyfitmod3[16,8]
  outcome[i] <- colnames(meddata_outcomes_cortvol)[i]

}
Results_cortvol_mediation <- cbind.data.frame(indirect_Effect, indirect_Effect_CIl, indirect_Effect_CIu, indirect_P, direct_Effect, direct_Effect_CIl, direct_Effect_CIu, direct_Effect_PValue, outcome)
colnames(Results_cortvol_mediation) <- c("indirect_Effect", "indirect_Effect_CIl", "indirect_Effect_CIu", "indirect_P", "direct_Effect", "direct_Effect_CIl", "direct_Effect_CIu", "direct_Effect_PValue", "outcome")

  Model_cortvol_categ1 <- '
smri_vol_cdk_total ~ a*Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + baseline_age + sex + siemens + philips 
demo_med_insur_d_p ~ c*Neurodev_PRScs + b*smri_vol_cdk_total + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + FU_age + sex + siemens + philips + COVID_visittype1 + COVID_visittype3
 # indirect effect (a*b)
             ab := a*b
           # total effect
             total := c + (a*b)
'
fit_cortvol_categ1 <- sem(Model_cortvol_categ1, data = meddata, estimator = "WLSMV", ordered = "demo_med_insur_d_p")
fit2_cortvol_categ1 <- summary(fit_cortvol_categ1)

groups <- svydesign(id=~rel_family_id + site_id, data = meddata)
surveyfitmod_fit_cortvol_categ1 <- lavaan.survey(lavaan.fit = fit_cortvol_categ1, survey.design = groups)
surveyfitmod2_fit_cortvol_categ1 <- summary(surveyfitmod_fit_cortvol_categ1)
surveyfitmod3_fit_cortvol_categ1 <- parameterEstimates(surveyfitmod_fit_cortvol_categ1, boot.ci.type="bca.simple",level=0.95, ci=TRUE,rsquare=TRUE,standardized = TRUE)

insurance_med1 <- data.frame(surveyfitmod3_fit_cortvol_categ1[227,5], surveyfitmod3_fit_cortvol_categ1[227,9], surveyfitmod3_fit_cortvol_categ1[227,10], surveyfitmod3_fit_cortvol_categ1[227,8], surveyfitmod3_fit_cortvol_categ1[16,6], surveyfitmod3_fit_cortvol_categ1[16,9],  surveyfitmod3_fit_cortvol_categ1[16,10], surveyfitmod3_fit_cortvol_categ1[16,8], "demo_med_insur_d_p")

names(insurance_med1) <- c("indirect_Effect", "indirect_Effect_CIl", "indirect_Effect_CIu", "indirect_P", "direct_Effect", "direct_Effect_CIl", "direct_Effect_CIu", "direct_Effect_PValue", "outcome")


  Model_cortvol_categ2 <- '
smri_vol_cdk_total ~ a*Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + baseline_age + sex + siemens + philips 
kbi_p_conflict_causes_l___6 ~ c*Neurodev_PRScs + b*smri_vol_cdk_total + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + FU_age + sex + siemens + philips + COVID_visittype1 + COVID_visittype3
 # indirect effect (a*b)
             ab := a*b
           # total effect
             total := c + (a*b)
'
fit_cortvol_categ2 <- sem(Model_cortvol_categ2, data = meddata, estimator = "WLSMV", ordered = "kbi_p_conflict_causes_l___6")
fit2_cortvol_categ2 <- summary(fit_cortvol_categ2)

groups <- svydesign(id=~rel_family_id + site_id, data = meddata)
surveyfitmod_fit_cortvol_categ2 <- lavaan.survey(lavaan.fit = fit_cortvol_categ2, survey.design = groups)
surveyfitmod2_fit_cortvol_categ2 <- summary(surveyfitmod_fit_cortvol_categ2)
surveyfitmod3_fit_cortvol_categ2 <- parameterEstimates(surveyfitmod_fit_cortvol_categ2, boot.ci.type="bca.simple",level=0.95, ci=TRUE,rsquare=TRUE,standardized = TRUE)


kbi_med1 <- data.frame(surveyfitmod3_fit_cortvol_categ2[227,5], surveyfitmod3_fit_cortvol_categ2[227,9], surveyfitmod3_fit_cortvol_categ2[227,10], surveyfitmod3_fit_cortvol_categ2[227,8], surveyfitmod3_fit_cortvol_categ2[16,6], surveyfitmod3_fit_cortvol_categ2[16,9],  surveyfitmod3_fit_cortvol_categ2[16,10], surveyfitmod3_fit_cortvol_categ2[16,8], "kbi_p_conflict_causes_l___6")

names(kbi_med1) <- c("indirect_Effect", "indirect_Effect_CIl", "indirect_Effect_CIu", "indirect_P", "direct_Effect", "direct_Effect_CIl", "direct_Effect_CIu", "direct_Effect_PValue", "outcome")




Results_cortvol_mediation <- rbind(Results_cortvol_mediation, insurance_med1, kbi_med1)
Results_cortvol_mediation$Bonferroni <- p.adjust(Results_cortvol_mediation$indirect_P, method = "bonferroni")
fwrite(Results_cortvol_mediation, file = "Results_cortvol_mediation_11.21.22.txt", sep = "\t")


# supraielv volume

meddata_outcomes_supraeilv <- meddata %>%
  select(sag_grades_last_yr:kbi_p_conflict_causes_l___6) %>%
  select(-mctq_sjl_calc, -bpm_5_y, -bpm_10_y, -bpm_14_y, -screentime_wknd_typical_composit, -eatq_finish_p, -cbcl_scr_07_stress_r, -contains("conflict_causes"))
meddata_nooutcomes <- meddata %>%
  select(subjectkey, rel_family_id:C10, Neurodev_PRScs, FU_age, baseline_age, sex, smri_vol_cdk_total, smri_vol_scs_suprateialv, smri_vol_scs_wholeb, smri_vol_scs_4thventricle, smri_vol_scs_subcorticalgv,  siemens:agediff)

first <- 1
last <-46
i <- NULL
fit <- NULL
fit2 <- NULL
groups <- NULL
surveyfitmod <- NULL
surveyfitmod2 <- NULL
surveyfitmod3 <- NULL
indirect_Effect <- NULL
indirect_Effect_CIl <- NULL
indirect_Effect_CIu <- NULL
indirect_P <- NULL
direct_Effect <- NULL 
direct_Effect_CIl <- NULL
direct_Effect_CIu <- NULL
direct_Effect_PValue <- NULL
outcome <- NULL
for (i in first:last) {
  meddata2 <- cbind.data.frame(meddata_nooutcomes, meddata_outcomes_supraeilv[i]) 
  colnames(meddata2) <- c("subjectkey", "rel_family_id", "site_id", "C1", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C10",      "Neurodev_PRScs", "FU_age", "baseline_age", "sex", "smri_vol_cdk_total",  "smri_vol_scs_suprateialv", "smri_vol_scs_wholeb", "smri_vol_scs_4thventricle", "smri_vol_scs_subcorticalgv",   "siemens", "philips", "ge", "COVID_visittype1",   "COVID_visittype2", "COVID_visittype3", "agediff", "outcome")
  
  Model <- '
smri_vol_scs_suprateialv ~ a*Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + baseline_age + sex + siemens + philips 
outcome ~ c*Neurodev_PRScs + b*smri_vol_scs_suprateialv + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + FU_age + sex + siemens + philips + COVID_visittype1 + COVID_visittype3
 # indirect effect (a*b)
             ab := a*b
           # total effect
             total := c + (a*b)
'
fit <- sem(Model, data = meddata2, estimator = "ML" )
fit2 <- summary(fit)

groups <- svydesign(id=~rel_family_id + site_id, data = meddata2)
surveyfitmod <- lavaan.survey(lavaan.fit = fit, survey.design = groups)
surveyfitmod2 <- summary(surveyfitmod)
surveyfitmod3 <- parameterEstimates(surveyfitmod, boot.ci.type="bca.simple",level=0.95, ci=TRUE,rsquare=TRUE,standardized = TRUE)

  indirect_Effect[i] <- surveyfitmod3[227,5]
  indirect_Effect_CIl[i] <- surveyfitmod3[227,9]
  indirect_Effect_CIu[i] <- surveyfitmod3[227,10]
  indirect_P[i] <- surveyfitmod3[227,8]
  direct_Effect[i] <- surveyfitmod3[16,6]
  direct_Effect_CIl[i] <- surveyfitmod3[16,9]
  direct_Effect_CIu[i] <- surveyfitmod3[16,10]
  direct_Effect_PValue[i] <- surveyfitmod3[16,8]
  outcome[i] <- colnames(meddata_outcomes_supraeilv)[i]

}
Results_supraeilv_mediation <- cbind.data.frame(indirect_Effect, indirect_Effect_CIl, indirect_Effect_CIu, indirect_P, direct_Effect, direct_Effect_CIl, direct_Effect_CIu, direct_Effect_PValue, outcome)
colnames(Results_supraeilv_mediation) <- c("indirect_Effect", "indirect_Effect_CIl", "indirect_Effect_CIu", "indirect_P", "direct_Effect", "direct_Effect_CIl", "direct_Effect_CIu", "direct_Effect_PValue", "outcome")

  Model_supraeilv_categ1 <- '
smri_vol_scs_suprateialv ~ a*Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + baseline_age + sex + siemens + philips 
demo_med_insur_d_p ~ c*Neurodev_PRScs + b*smri_vol_scs_suprateialv + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + FU_age + sex + siemens + philips + COVID_visittype1 + COVID_visittype3
 # indirect effect (a*b)
             ab := a*b
           # total effect
             total := c + (a*b)
'
fit_supraeilv_categ1 <- sem(Model_supraeilv_categ1, data = meddata, estimator = "WLSMV", ordered = "demo_med_insur_d_p")
fit2_supraeilv_categ1 <- summary(fit_supraeilv_categ1)

groups <- svydesign(id=~rel_family_id + site_id, data = meddata)
surveyfitmod_fit_supraeilv_categ1 <- lavaan.survey(lavaan.fit = fit_supraeilv_categ1, survey.design = groups)
surveyfitmod2_fit_supraeilv_categ1 <- summary(surveyfitmod_fit_supraeilv_categ1)
surveyfitmod3_fit_supraeilv_categ1 <- parameterEstimates(surveyfitmod_fit_supraeilv_categ1, boot.ci.type="bca.simple",level=0.95, ci=TRUE,rsquare=TRUE,standardized = TRUE)

insurance_med2 <- data.frame(surveyfitmod3_fit_supraeilv_categ1[227,5], surveyfitmod3_fit_supraeilv_categ1[227,9], surveyfitmod3_fit_supraeilv_categ1[227,10], surveyfitmod3_fit_supraeilv_categ1[227,8], surveyfitmod3_fit_supraeilv_categ1[16,6], surveyfitmod3_fit_supraeilv_categ1[16,9],  surveyfitmod3_fit_supraeilv_categ1[16,10], surveyfitmod3_fit_supraeilv_categ1[16,8], "demo_med_insur_d_p")

names(insurance_med2) <- c("indirect_Effect", "indirect_Effect_CIl", "indirect_Effect_CIu", "indirect_P", "direct_Effect", "direct_Effect_CIl", "direct_Effect_CIu", "direct_Effect_PValue", "outcome")

Results_supraeilv_mediation <- rbind(Results_supraeilv_mediation, insurance_med2)
Results_supraeilv_mediation$Bonferroni <- p.adjust(Results_supraeilv_mediation$indirect_P, method = "bonferroni")
fwrite(Results_supraeilv_mediation, file = "Results_supraeilv_mediation_11.21.22.txt", sep = "\t")


# wholeb volume

meddata_outcomes_wholeb <- meddata %>%
  select(sag_grades_last_yr:kbi_p_conflict_causes_l___6) %>%
  select(-bpm_10_y, -bpm_14_y, -eatq_finish_p, -contains("conflict_causes"))
meddata_nooutcomes <- meddata %>%
  select(subjectkey, rel_family_id:C10, Neurodev_PRScs, FU_age, baseline_age, sex, smri_vol_cdk_total, smri_vol_scs_suprateialv, smri_vol_scs_wholeb, smri_vol_scs_4thventricle, smri_vol_scs_subcorticalgv,  siemens:agediff)

first <- 1
last <-50
i <- NULL
fit <- NULL
fit2 <- NULL
groups <- NULL
surveyfitmod <- NULL
surveyfitmod2 <- NULL
surveyfitmod3 <- NULL
indirect_Effect <- NULL
indirect_Effect_CIl <- NULL
indirect_Effect_CIu <- NULL
indirect_P <- NULL
direct_Effect <- NULL 
direct_Effect_CIl <- NULL
direct_Effect_CIu <- NULL
direct_Effect_PValue <- NULL
outcome <- NULL
for (i in first:last) {
  meddata2 <- cbind.data.frame(meddata_nooutcomes, meddata_outcomes_wholeb[i]) 
  colnames(meddata2) <- c("subjectkey", "rel_family_id", "site_id", "C1", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C10",      "Neurodev_PRScs", "FU_age", "baseline_age", "sex", "smri_vol_cdk_total",  "smri_vol_scs_suprateialv", "smri_vol_scs_wholeb", "smri_vol_scs_4thventricle", "smri_vol_scs_subcorticalgv",   "siemens", "philips", "ge", "COVID_visittype1",   "COVID_visittype2", "COVID_visittype3", "agediff", "outcome")
  
  Model <- '
smri_vol_scs_wholeb ~ a*Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + baseline_age + sex + siemens + philips 
outcome ~ c*Neurodev_PRScs + b*smri_vol_scs_wholeb + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + FU_age + sex + siemens + philips + COVID_visittype1 + COVID_visittype3
 # indirect effect (a*b)
             ab := a*b
           # total effect
             total := c + (a*b)
'
fit <- sem(Model, data = meddata2, estimator = "ML" )
fit2 <- summary(fit)

groups <- svydesign(id=~rel_family_id + site_id, data = meddata2)
surveyfitmod <- lavaan.survey(lavaan.fit = fit, survey.design = groups)
surveyfitmod2 <- summary(surveyfitmod)
surveyfitmod3 <- parameterEstimates(surveyfitmod, boot.ci.type="bca.simple",level=0.95, ci=TRUE,rsquare=TRUE,standardized = TRUE)

  indirect_Effect[i] <- surveyfitmod3[227,5]
  indirect_Effect_CIl[i] <- surveyfitmod3[227,9]
  indirect_Effect_CIu[i] <- surveyfitmod3[227,10]
  indirect_P[i] <- surveyfitmod3[227,8]
  direct_Effect[i] <- surveyfitmod3[16,6]
  direct_Effect_CIl[i] <- surveyfitmod3[16,9]
  direct_Effect_CIu[i] <- surveyfitmod3[16,10]
  direct_Effect_PValue[i] <- surveyfitmod3[16,8]
  outcome[i] <- colnames(meddata_outcomes_wholeb)[i]

}
Results_wholeb_mediation <- cbind.data.frame(indirect_Effect, indirect_Effect_CIl, indirect_Effect_CIu, indirect_P, direct_Effect, direct_Effect_CIl, direct_Effect_CIu, direct_Effect_PValue, outcome)
colnames(Results_wholeb_mediation) <- c("indirect_Effect", "indirect_Effect_CIl", "indirect_Effect_CIu", "indirect_P", "direct_Effect", "direct_Effect_CIl", "direct_Effect_CIu", "direct_Effect_PValue", "outcome")

  Model_wholeb_categ1 <- '
smri_vol_scs_wholeb ~ a*Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + baseline_age + sex + siemens + philips 
demo_med_insur_d_p ~ c*Neurodev_PRScs + b*smri_vol_scs_wholeb + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + FU_age + sex + siemens + philips + COVID_visittype1 + COVID_visittype3
 # indirect effect (a*b)
             ab := a*b
           # total effect
             total := c + (a*b)
'
fit_wholeb_categ1 <- sem(Model_wholeb_categ1, data = meddata, estimator = "WLSMV", ordered = "demo_med_insur_d_p")
fit2_wholeb_categ1 <- summary(fit_wholeb_categ1)

groups <- svydesign(id=~rel_family_id + site_id, data = meddata)
surveyfitmod_fit_wholeb_categ1 <- lavaan.survey(lavaan.fit = fit_wholeb_categ1, survey.design = groups)
surveyfitmod2_fit_wholeb_categ1 <- summary(surveyfitmod_fit_wholeb_categ1)
surveyfitmod3_fit_wholeb_categ1 <- parameterEstimates(surveyfitmod_fit_wholeb_categ1, boot.ci.type="bca.simple",level=0.95, ci=TRUE,rsquare=TRUE,standardized = TRUE)

insurance_med3 <- data.frame(surveyfitmod3_fit_wholeb_categ1[227,5], surveyfitmod3_fit_wholeb_categ1[227,9], surveyfitmod3_fit_wholeb_categ1[227,10], surveyfitmod3_fit_wholeb_categ1[227,8], surveyfitmod3_fit_wholeb_categ1[16,6], surveyfitmod3_fit_wholeb_categ1[16,9],  surveyfitmod3_fit_wholeb_categ1[16,10], surveyfitmod3_fit_wholeb_categ1[16,8], "demo_med_insur_d_p")

names(insurance_med3) <- c("indirect_Effect", "indirect_Effect_CIl", "indirect_Effect_CIu", "indirect_P", "direct_Effect", "direct_Effect_CIl", "direct_Effect_CIu", "direct_Effect_PValue", "outcome")

Results_wholeb_mediation <- rbind(Results_wholeb_mediation, insurance_med3)
Results_wholeb_mediation$Bonferroni <- p.adjust(Results_wholeb_mediation$indirect_P, method = "bonferroni")
fwrite(Results_wholeb_mediation, file = "Results_wholeb_mediation_11.21.22.txt", sep = "\t")

asdf <- psych::describe(PheWAS_FU)
fwrite(asdf, file = "asdf.txt", row.names = T)



 test <- '
smri_vol_cdk_total ~ a*Neurodev_PRScs + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + baseline_age + sex + siemens + philips 
sag_grade_type ~ c*Neurodev_PRScs + b*smri_vol_cdk_total + C1 + C2 + C3 + C4 + C5 + C6 + C7 + C8 + C9 + C10 + FU_age + sex + siemens + philips + COVID_visittype1 + COVID_visittype3
 # indirect effect (a*b)
             ab := a*b
           # total effect
             total := c + (a*b)
'
fittest <- sem(test, data = meddata, estimator = "ML" )
fittest2 <- summary(fittest)

groups <- svydesign(id=~rel_family_id + site_id, data = meddata)
surveyfitmod_fit_sag <- lavaan.survey(lavaan.fit = fittest, survey.design = groups)
surveyfitmod2_fit_sag <- summary(surveyfitmod_fit_sag)
surveyfitmod3_fit_sag <- parameterEstimates(surveyfitmod_fit_sag, boot.ci.type="bca.simple",level=0.95, ci=TRUE,rsquare=TRUE,standardized = TRUE)




```

#### More Plots 
```{r}
## broader categories

Categories <- c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health","Family Mental Health", "Child Mental Health")
Total_Count_base <- c(208, 179, 340, 946, 365, 1198, 697, 2474)
Retained_Count_base <- c(14, 18, 27, 46, 111, 172, 239, 638)
Total_Count_FU <- c(172, 239, 149, 769, 1293, 1707, 283, 5517)
Retained_Count_FU <- c(8, 104, 26, 119, 439, 199, 158, 634)
barplotdf <- data.frame(Categories, Total_Count_base, Retained_Count_base, Total_Count_FU, Retained_Count_FU)

barplotdf$Categories <- as.factor(barplotdf$Categories)

barplotdf <- reshape2::melt(barplotdf, id.vars = 'Categories') 

barplotdf$wave <- factor(c(rep("Baseline", 16), rep("2-Year-Follow-Up", 16)), levels = c("Baseline", "2-Year-Follow-Up"))
barplotdf$variable <- c(rep("Total", 8),rep("Retained", 8), rep("Total", 8),rep("Retained", 8))
barplotdf$Categories <- factor(barplotdf$Categories, levels = barplotdf$Categories[1:8])
names(barplotdf)[1] <- "Category"
names(barplotdf)[2] <- "Total/Retained"
barplotdf$`Total/Retained` <- factor(barplotdf$`Total/Retained`, levels = c("Total", "Retained"))
barplotdf$xpos <- c(seq(1,15,2), seq(2,16,2),seq(1,15,2), seq(2,16,2))


barplot3 <- barplotdf %>%
ggplot(aes(x = xpos, y = as.numeric(value))) +
  geom_col(aes(x = xpos, fill = Category, alpha = factor(`Total/Retained`)), position = position_dodge(preserve = "single")) +#, show.legend = F) +
  scale_fill_manual(values = mycols) +
  scale_alpha_manual(values = c(1, .5), guide = "none") +
  theme_classic() +
  xlab("Category") +
  ylab("Count") +
  ggtitle("# Phenotypes/Domain: Total & Retained") +
  scale_y_continuous(limits = c(0, 5610), breaks = seq(0, 5610, 250), expand = c(0.01,0.01)) +
  scale_x_continuous(limits = c(0.5,16.5), expand = c(0.01,0.01), breaks = seq(1,16,2), labels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health","Family Mental Health", "Child Mental Health")) +
  theme(text = element_text(size = 12),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_text(size = 6),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size = 8, face = "bold"),
        plot.title = element_blank(),
        strip.text = element_text(hjust=.5,vjust = 1,size = 9, margin = margin(b = 1.7, t = 2)),
        strip.background = element_rect(fill = "white", color = "#2C3A48"),
        legend.title = element_blank(),
        legend.position = "bottom",
        legend.text = element_text(size = 7),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.0001, "cm"),
        legend.box.margin = margin(0,0,0,0)) +
  geom_text(aes(label = value, x = xpos), hjust = 0.5, vjust = -.5, size = 2, nudge_y = -8) +
  facet_wrap(~wave)

ggsave(barplot3, file = "barplot3.png", width = 5, height = 4)

```

#### Summary Plot 
```{r}
sigsneurbase <- Results3_Neurodev[Results3_Neurodev$Bonferroni < .05,]
table(sigsneurbase$Category)
sigsintbase <- Results4_Internal[Results4_Internal$Bonferroni < .05,]
table(sigsintbase$Category)
sigsneurFU <- Results3_FU_Neurodev[Results3_FU_Neurodev$Bonferroni < .05,]
table(sigsneurFU$Category)
sigsintFU <- Results4_FU_Internal[Results4_FU_Internal$Bonferroni < .05,]
table(sigsintFU$Category)

Categories <- c(rep(c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health"), 8))
PRS <- rep(c(rep("Compulsive", 8), rep("Psychotic", 8), rep("Neurodevelopmental", 8), rep("Internalizing", 8)), 2)
Wave <- c(rep("Baseline", 32), rep("2-Year Follow-Up", 32))

NumSigs <- c(rep(0,16), 
             3, 10, 3, 4, 3, 9, 11, 144,
             1, 4, 1, 3, 0, 13, 26, 74,
             rep(0,8),
             0, 0, 0, 0, 1, 0, 0, 0, 
             1, 19, 2, 5, 39, 11, 0, 134,
             0, 9, 2, 0, 26, 9, 19, 108)

Totals <- c(rep(c(14, 18, 27, 46, 111, 172, 239, 638),4), rep(c(8, 104, 26, 119, 439, 199, 158, 634), 4))
results_barplotdf <- data.frame(Categories, PRS, Wave, NumSigs, Totals)

results_barplotdf$Categories <- factor(results_barplotdf$Categories, levels = c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health"))
results_barplotdf$PRS <- factor(results_barplotdf$PRS, levels = c("Compulsive", "Psychotic", "Neurodevelopmental", "Internalizing"))
results_barplotdf$Wave <- factor(results_barplotdf$Wave, levels = c("Baseline", "2-Year Follow-Up"))

totalsdf <- data.frame(Wave = c(rep("Baseline", 8), rep("2-Year-Follow-Up", 8)),
                      Totals = c(14, 18, 27, 46, 111, 172, 239, 638, 8, 104, 26, 119, 439, 199, 158, 634),
                      x = rep(c("Cognition", "Screen Time", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health")),2)

results_barplot <-  results_barplotdf %>%
ggplot(aes(x = NumSigs, y = Categories, fill = PRS, label = Totals)) +
  geom_col() +
  scale_fill_manual(values = c("darkorange", "turquoise4", "mediumorchid4", "goldenrod")) +
  theme_bw() +
  ylab("Category") +
  xlab("Number of Significantly Associated Phenotypes") +
  labs(fill = "Polygenic Risk Score") +
  scale_x_continuous(limits = c(0, 250), breaks = seq(0, 250, 25), expand = c(0.01,0.01)) +
  theme(text = element_text(size = 12),
        axis.ticks.x = element_blank(),
        axis.text.x = element_text(size = 8),
        axis.text.y = element_text(size = 8),
        axis.title.x = element_text(size = 10, face = "bold"),
        axis.title.y = element_blank(),
        plot.title = element_text(size = 12,  hjust = 0.5, face = "bold"),
        strip.text = element_text(hjust=.5,vjust = 1,size = 10, margin = margin(b = 2, t = 2)),
        strip.background = element_rect(fill = "white", colour = "black"),
        legend.title = element_text(size = 10, face = "bold"),
        legend.text = element_text(size = 8),
        legend.key.size = unit(.4, 'cm'),
        legend.spacing.y = unit(.0001, "cm"), 
        legend.position = "top",
        legend.box.margin = margin(0,0,-7,0)) +
  facet_wrap(~Wave, strip.position = "top", ncol = 2)  +
  geom_text(x = rep(261,64), y = Categories, size = 2.2) +
  coord_cartesian(xlim = c(0, 250), # This focuses the x-axis on the range of interest
                      clip = 'off') +
  theme(plot.margin = unit(c(1,1,1,1), "lines"), panel.spacing=unit(1.2,"lines"))

ggsave(results_barplot, file = "results_barplot.png", width = 7, height = 3)
```
#### Supplemental Heatmap Results
```{r}
Compbase <- read.csv("Compulsive_results_base_11_6.csv", header = T)
Compbase$PRS <- rep("Compulsive", 1269)
Psychbase <- read.csv("Psychotic_results_base_11_6.csv", header = T)
Psychbase$PRS <- rep("Psychotic", 1269)
Neurbase <- read.csv("Neurodev_results_base_11_6.csv", header = T)
Neurbase$PRS <- rep("Neurodevel", 1269)
Intbase <- read.csv("Internalizing_results_base_11_6.csv", header = T)
Intbase$PRS <- rep("Internal", 1269)

sigs_neur <- Neurbase[Neurbase$Bonferroni < .05,]
sigs_int <- Intbase[Intbase$Bonferroni < .05,]
sigsbase <- merge(sigs_neur, sigs_int, by = "Variable", all = T)

sigsbase <- rbind(Compbase[Compbase$Variable %in% sigsbase$Variable,],
                  Psychbase[Psychbase$Variable %in% sigsbase$Variable,],
                  Neurbase[Neurbase$Variable %in% sigsbase$Variable,],
                  Intbase[Intbase$Variable %in% sigsbase$Variable,])

sigsbase <- sigsbase %>%
  mutate(Category = ifelse(grepl('tlfb|path|isip|su_|caff|rules_|peer_dev', Variable) & 
                             !grepl('devhx', Variable), "Substance",
                           ifelse(grepl('crpbi|fes|prosocial|school|reshist|monitor|neighborhood|enviro|pmq|psb_|nsc_|srpf', Variable) & !grepl('profess|kbi', Variable), "Culture/Environment",
                                  ifelse(grepl('ksad|cbcl|prodrom|pps_|upps|bisbas|bis_|resiliency|kbi|gen_child|pgbi|bpm|ADHD', Variable) & !grepl('monitor|parent_rules|prosocial|fes_youth|asr_|famhx|fam_hist', Variable), "Child Mental Health",
                                                     ifelse(grepl('asr_|famhx|fam_hist|q1|q2|q4|q5|q6|q9', Variable) & !grepl('cbcl|ksads|bpm|parent_mon|parent_rul|fes_|prosocial', Variable), "Family Mental Health",
                                                            ifelse(grepl('medhx|devhx|tbi|pds|puber|sports|sai_|filtered_|anthro|child_|antidep_|sds_|sleep|weight|SSRI|antidep|hormon_sal|medicat', Variable) & !grepl('demo|gen_child', Variable), "Physical Health",
                                                                   ifelse(grepl('nihtbx|RAVLT|cash|lmt|wisc', Variable), "Cognition",
                                                                           ifelse(grepl('screen|stq', Variable), "Screen Time",
                                                                                  ifelse(grepl('demo|prnt_wor|prtnr_wor', Variable), "Demographics", 999))))))))) %>%
  
  mutate(Category = factor(Category, levels = c("Cognition", "Screentime", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health"))) %>%
  mutate(PRS = factor(PRS, levels = c("Compulsive", "Psychotic", "Neurodevel", "Internal")))

sigsbase <- sigsbase[order(sigsbase$Category),]

#fwrite(sigsbase, file = "sigsbase_12.23.txt", sep = "\t")
sigsbase <- fread("sigsbase_12.23_rename.txt", header = T, data.table = F)

factvar <- sapply(PheWAS_baseline, is.factor)
factbase <- PheWAS_baseline[, factvar]
factbase <- colnames(factbase)

sigsbase <- sigsbase %>%
  mutate(Category3 = factor(Category3, levels = c("Family History of Psychopathology", "Caregiver Behavior (ASR)", "Child Behavior (BPMT)", "Child Behavior (CBCL)", "Impulsive Personality Traits", "School Issues & Performance", "Substance Use & Attitudes", "Cognition", "Environment/Demographics", "KSADS DSM-5 Symptoms", "Mania & Psychosis Symptoms", "Other Child Mental Health", "Birth/Pregnancy", "Sleep", "Other Physical Health", "Screentime"))) %>%
  arrange(Category3, Variable_Rename) %>%
  mutate(PRS = factor(PRS, levels = c("Compulsive", "Psychotic", "Neurodevel", "Internal"))) %>%
  mutate(OR = ifelse(Variable %in% factbase, exp(Beta), NA)) %>%
  mutate(factor = ifelse(!is.na(OR), 1, 0))


sigsbasea <- sigsbase[1:492,]
sigsbaseb <- sigsbase[493:988,]

myPalette <- colorRampPalette(rev(brewer.pal(11, "RdYlBu")), space="rgb")
myPalette2 <- colorRampPalette(rev(brewer.pal(11, "PiYG")), space="rgb")

hmbase1 <- ggplot(sigsbasea, aes(x = PRS, y = Rename2, fill = OR)) +
  geom_tile(color = "white") +
  scale_fill_gradientn(colours = myPalette2(100), limits = c(.4, 1.6))+ 
  guides(fill = "none") + 
  new_scale_fill() +
  geom_tile(data = subset(sigsbasea, factor == 0), color = "white", aes(fill = Beta)) +
  scale_fill_gradientn(colours = myPalette(100), limits = c(-.5, .5))+ 
  scale_y_discrete(position = "left") +
  scale_x_discrete(expand = c(0,0)) +
  theme_minimal() +
  geom_text(aes(label = ifelse(Bonferroni < .05, "*", "")), size = 1.5, nudge_y = -.125) +
  theme(axis.text.x = element_text(size = 6, hjust = .5),
        axis.title.x = element_text(size = 8),
        axis.text.y = element_text(size = 4.8, hjust = 1),
        axis.title.y = element_blank(),
        axis.ticks.y = element_blank()) +
  ggforce::facet_col(facets = vars(Category3), 
                     scales = "free_y", 
                     space = "free") +
  theme(strip.text = element_text(hjust=.5,vjust = 1,size = 5, margin = margin(b = .1, t = .2), face = "bold"),
        strip.background = element_rect(fill = "white", color = "white"),
        panel.spacing=unit(0,'npc'),
        plot.margin = unit(c(1.18,.1,0,.1), "cm"),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        legend.direction = "horizontal", 
        legend.position = c(.5,1.04),
        legend.key.width = unit(1, 'cm'),
        legend.key.height = unit(.2, 'cm'),
        legend.margin=margin(0, 2, 0, 0),
        legend.title = element_text(size = 6),
        legend.text = element_text(size = 5)) +
  guides(fill = guide_colorbar(label.position = "top", 
            title.position = "right", title.vjust = 0.13)) 

hmbase2 <- ggplot(sigsbaseb, aes(x = PRS, y = Rename2, fill = Beta)) +
  geom_tile(color = "white") +
  scale_fill_gradientn(colours = myPalette(100),limits = c(-.5, .5))+
  guides(fill = "none") +
  new_scale_fill() +
  geom_tile(data = subset(sigsbaseb, factor == 1), color = "white", aes(fill = OR)) +
  scale_fill_gradientn(colours = myPalette2(100), limits = c(.4, 1.6))+ 
  scale_y_discrete(position = "right") +
  scale_x_discrete(expand = c(0,0)) +
  theme_minimal() +
  geom_text(aes(label = ifelse(Bonferroni < .05, "*", "")), size = 1.5, nudge_y = -.125) +
  theme(axis.text.x = element_text(size = 6, hjust = .5,),
        axis.title.x = element_text(size = 8),
        axis.text.y = element_text(size = 4.8, hjust = 0),
        axis.title.y = element_blank(),
        axis.ticks.y = element_blank()) +
  ggforce::facet_col(facets = vars(Category3), 
                     scales = "free_y", 
                     space = "free") +
  theme(strip.text = element_text(hjust=.5,vjust = 1,size = 5, margin = margin(b = .1, t = .2), face = "bold"),
        strip.background = element_rect(fill = "white", color = "white"),
        panel.spacing=unit(0,'npc'),
        plot.margin = unit(c(1.18,.1,0,.1), "cm"),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        legend.direction = "horizontal", 
        legend.position = c(.5,1.04),
        legend.key.width = unit(1, 'cm'),
        legend.key.height = unit(.2, 'cm'),
        legend.margin=margin(0, 0, 0, 2),
        legend.title = element_text(size = 6),
        legend.text = element_text(size = 5)) +
  guides(fill = guide_colorbar(label.position = "top", 
            title.position = "right", title.vjust = 0.13))
hm_baseline <- ggarrange(hmbase1, hmbase2, ncol = 2)
ggsave(hm_baseline, file = "baseline_heatmap_FINAL.png", width = 7, height = 8)




CompFU <- fread("Compulsive_results_FU_11_18.txt", header = T, data.table = F)
CompFU$PRS <- rep("Compulsive", 1694)
PsychFU <- fread("Psychotic_results_FU_11_18.txt", header = T, data.table = F)
PsychFU$PRS <- rep("Psychotic", 1694)
NeurFU <- fread("Neurodev_results_FU_11_18.txt", header = T, data.table = F)
NeurFU$PRS <- rep("Neurodevel", 1694)
IntFU <- fread("Internalizing_results_FU_11_18.txt", header = T, data.table = F)
IntFU$PRS <- rep("Internal", 1694)

sigsFU_neur <- NeurFU[NeurFU$Bonferroni < .05,]
sigsFU_int <- IntFU[IntFU$Bonferroni < .05,]
sigsFU <- merge(sigsFU_neur, sigsFU_int, by = "Variable", all = T)

sigsFU <- rbind(CompFU[CompFU$Variable %in% sigsFU$Variable,],
                  PsychFU[PsychFU$Variable %in% sigsFU$Variable,],
                  NeurFU[NeurFU$Variable %in% sigsFU$Variable,],
                  IntFU[IntFU$Variable %in% sigsFU$Variable,])

sigsFU <- sigsFU %>%
  mutate(Category = ifelse(grepl('tlfb|path|isip|su_|caff|rules_|peer_dev|ascq|ptu_|meeq|phs_|aeq_', Variable) & !grepl('caff_ago|caff_24', Variable), "Substance",
                           ifelse(grepl('crpbi|fes|prosocial|school|reshist|monitor|neighborhood|enviro|pmq|ple_|cybb|pnh_|nsc_|psb_|sag_|comc|srpf_|dim_mat|dim_y|pbp_|peq', Variable) & !grepl('profess|kbi|eatq|screen|mctq', Variable), "Culture/Environment",
                                  ifelse(grepl('ksad|cbcl|prodrom|pps_|upps|bisbas|bis_|resiliency|kbi|gen_child|pgbi|bpmt|bpm|sup_|eatq_|ssrs_|poa_|ksad', Variable) & !grepl('monitor|parent_rules|prosocial|fes_youth|asr_|famhx|fam_hist|abcl|screen|dim_matrix|dim_yes', Variable), "Child Mental Health",
                                         ifelse(grepl('asr_|famhx|fam_hist|q1|q2|q4|q5|q6|q9|abcl', Variable) & !grepl('cbcl|ksads|bpmt|parent|fes_|prosocial|screen|dim_matrix|dim_yes', Variable), "Family Mental Health",
                                                ifelse(grepl('medhx|devhx|tbi|pds|puber|sports|sai_|filtered_|anthro|child_|antidep_|sds_|sleep|weight|SSRI|antidepressant|bkfs|mctq|gish|physical_activity|pain_last|brought|blood_pressure|pain_|menstrual|biospec|fitbit|caff_ago|caff_24', Variable) & !grepl('demo|gen_child|screen|ksad', Variable), "Physical Health",
                                                                    ifelse(grepl('nihtbx|RAVLT|lmt', Variable), "Cognition",
                                                                          ifelse(grepl('screen|stq', Variable), "Screentime", "Demographics")))))))) %>%
  mutate(Category = factor(Category, levels = c("Cognition", "Screentime", "Demographics", "Substance", "Culture/Environment", "Physical Health", "Family Mental Health", "Child Mental Health"))) %>%
  mutate(PRS = factor(PRS, levels = c("Compulsive", "Psychotic", "Neurodevel", "Internal")))

sigsFU <- sigsFU[order(sigsFU$Category),]

#fwrite(sigsFU, file = "sigsFU_12.23.txt", sep = "\t")
sigsFU <- fread("sigsFU_12.23_rename.txt", header = T, data.table = F)

factvar <- sapply(PheWAS_FU, is.factor)
factFU <- PheWAS_FU[, factvar]
factFU <- colnames(factFU)

table(sigsFU$Category3)
sigsFU <- sigsFU %>%
  mutate(Category3 = factor(Category3, levels = c("Child Behavior (BPMT)", "Child Behavior (BPM)", "Child Behavior (CBCL)", "Child Behavior (EATQ)", "Impulsive Personality Traits", "Substance Use & Attitudes", "Cognition", "Diet", "Caregiver Behavior (ASR)", "School Issues & Performance",  "Environment/Demographics", "Life Events, Victimization", "Mania & Psychosis Symptoms", "Other Child Mental Health", "Puberty, Sexual & Gender Identity", "Sleep",  "Screentime"))) %>%
  arrange(Category3, Variable_Rename) %>%
  mutate(PRS = factor(PRS, levels = c("Compulsive", "Psychotic", "Neurodevel", "Internal"))) %>%
  mutate(OR = ifelse(Variable %in% factFU, exp(Beta), NA)) %>%
  mutate(factor = ifelse(!is.na(OR), 1, 0))


sigsFUa <- sigsFU[1:564,]
sigsFUb <- sigsFU[565:1144,]

myPalette <- colorRampPalette(rev(brewer.pal(11, "RdYlBu")), space="rgb")
myPalette2 <- colorRampPalette(rev(brewer.pal(11, "PiYG")), space="rgb")

hmFU1 <- ggplot(sigsFUa, aes(x = PRS, y = Variable_Rename, fill = OR)) +
  geom_tile(color = "white") +
  scale_fill_gradientn(colours = myPalette2(100), limits = c(.4, 1.6))+ 
  guides(fill = "none") + 
  new_scale_fill() +
  geom_tile(data = subset(sigsFUa, factor == 0), color = "white", aes(fill = Beta)) +
  scale_fill_gradientn(colours = myPalette(100), limits = c(-.5, .5))+ 
  scale_y_discrete(position = "left") +
  scale_x_discrete(expand = c(0,0)) +
  theme_minimal() +
  geom_text(aes(label = ifelse(Bonferroni < .05, "*", "")), size = 1.5, nudge_y = -.125) +
  theme(axis.text.x = element_text(size = 6, hjust = .5),
        axis.title.x = element_text(size = 8),
        axis.text.y = element_text(size = 4.8, hjust = 1),
        axis.title.y = element_blank(),
        axis.ticks.y = element_blank()) +
  ggforce::facet_col(facets = vars(Category3), 
                     scales = "free_y", 
                     space = "free") +
  theme(strip.text = element_text(hjust=.5,vjust = 1,size = 5, margin = margin(b = .1, t = .2), face = "bold"),
        strip.background = element_rect(fill = "white", color = "white"),
        panel.spacing=unit(0,'npc'),
        plot.margin = unit(c(1.18,.1,0,.1), "cm"),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        legend.direction = "horizontal", 
        legend.position = c(.5,1.04),
        legend.key.width = unit(1, 'cm'),
        legend.key.height = unit(.2, 'cm'),
        legend.margin=margin(0, 2, 0, 0),
        legend.title = element_text(size = 6),
        legend.text = element_text(size = 5)) +
  guides(fill = guide_colorbar(label.position = "top", 
            title.position = "right", title.vjust = 0.13)) 

hmFU2 <- ggplot(sigsFUb, aes(x = PRS, y = Variable_Rename, fill = Beta)) +
  geom_tile(color = "white") +
  scale_fill_gradientn(colours = myPalette(100),limits = c(-.5, .5))+
  guides(fill = "none") +
  new_scale_fill() +
  geom_tile(data = subset(sigsFUb, factor == 1), color = "white", aes(fill = OR)) +
  scale_fill_gradientn(colours = myPalette2(100), limits = c(.4, 1.6))+ 
  scale_y_discrete(position = "right") +
  scale_x_discrete(expand = c(0,0)) +
  theme_minimal() +
  geom_text(aes(label = ifelse(Bonferroni < .05, "*", "")), size = 1.5, nudge_y = -.125) +
  theme(axis.text.x = element_text(size = 6, hjust = .5,),
        axis.title.x = element_text(size = 8),
        axis.text.y = element_text(size = 4.8, hjust = 0),
        axis.title.y = element_blank(),
        axis.ticks.y = element_blank()) +
  ggforce::facet_col(facets = vars(Category3), 
                     scales = "free_y", 
                     space = "free") +
  theme(strip.text = element_text(hjust=.5,vjust = 1,size = 5, margin = margin(b = .1, t = .2), face = "bold"),
        strip.background = element_rect(fill = "white", color = "white"),
        panel.spacing=unit(0,'npc'),
        plot.margin = unit(c(1.18,.1,0,.1), "cm"),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        legend.direction = "horizontal", 
        legend.position = c(.5,1.04),
        legend.key.width = unit(1, 'cm'),
        legend.key.height = unit(.2, 'cm'),
        legend.margin=margin(0, 0, 0, 2),
        legend.title = element_text(size = 6),
        legend.text = element_text(size = 5)) +
  guides(fill = guide_colorbar(label.position = "top", 
            title.position = "right", title.vjust = 0.13))
hm_FU <- ggarrange(hmFU1, hmFU2, ncol = 2)
ggsave(hm_FU, file = "FU_heatmap_FINAL.png", width = 7, height = 8.5)


```

